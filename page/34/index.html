<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222 media="(prefers-color-scheme: light)"><meta name=theme-color content=#222 media="(prefers-color-scheme: dark)"><meta name=generator content="Hexo 6.2.0"><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preconnect href=https://cdnjs.cloudflare.com crossorigin><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon.ico><link rel=mask-icon href=/images/logo.svg color=#222><meta name=baidu-site-verification content=WIIeufYjj6><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Microsoft+YaHei:300,300italic,400,400italic,700,700italic%7Ccmmi10:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"winddoing.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.12.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content=失败缘于忽视细处，成功始于重视小事><meta property=og:type content=website><meta property=og:title content="Winddoing&#39;s Notes"><meta property=og:url content=https://winddoing.github.io/page/34/index.html><meta property=og:site_name content="Winddoing&#39;s Notes"><meta property=og:description content=失败缘于忽视细处，成功始于重视小事><meta property=og:locale content=zh_CN><meta property=article:author content=winddoing><meta property=article:tag content=winddoing,嵌入式,Linux,kernel,shell,C语言,网络,mips,arm,arm64,虚拟化><meta name=twitter:card content=summary><link rel=canonical href="https://winddoing.github.io/page/34/"><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/34/index.html","title":""}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Winddoing's Notes - Follow Excellent, Success will Chase you</title><script src=/js/third-party/analytics/baidu-analytics.js></script><script async src=https://hm.baidu.com/hm.js?b96a560ce0a6bfbeaaddc59dc5888b75></script><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href="/" class=brand rel=start><i class=logo-line></i><h1 class=site-title>Winddoing's Notes</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Follow Excellent, Success will Chase you</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel=section><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel=section><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel=section><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=winddoing src=/images/Winddoing.jpg><p class=site-author-name itemprop=name>winddoing</p><div class=site-description itemprop=description>失败缘于忽视细处，成功始于重视小事</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href="/archives/"><span class=site-state-item-count>358</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class=site-state-item-count>112</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class=site-state-item-count>284</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL1dpbmRkb2luZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing"><i class="fab fa-github fa-fw"></i>GitHub</span></span> <span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly9naXRlZS5jb20vd2luZGRvaW5n title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing"><i class="fab fa-codiepie fa-fw"></i>Gitee</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy85NTY3MzYxL3dpbmRkb2luZw==" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9hcHAudHJhdmlzLWNpLmNvbS9naXRodWIvV2luZGRvaW5nL3dpbmRkb2luZy5naXRodWIuaW8=" title="Travis CI → https:&#x2F;&#x2F;app.travis-ci.com&#x2F;github&#x2F;Winddoing&#x2F;winddoing.github.io"><i class="fas fa-terminal fa-fw"></i>Travis CI</span></span></div><div class="cc-license site-overview-item animated" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg alt="Creative Commons"></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="link fa-fw"></i> Links</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cHM6Ly93aW5kZG9pbmcuZ2l0Ym9vay5pby9lbWJlZGRlZF9saW51eF9ub3Rlcy8=" title=https:&#x2F;&#x2F;winddoing.gitbook.io&#x2F;embedded_linux_notes&#x2F;>嵌入式相关</span></li><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2RyZWFtcQ==" title=http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq>CSDN</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cDovL3d3dy53b3dvdGVjaC5uZXQv title=http:&#x2F;&#x2F;www.wowotech.net&#x2F;>蜗窝科技</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpb25neGlhbnpl title=https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze>xiongxianze</span></li></ul></div><div id=days></div><script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("02/26/2014 15:00:00");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
}
show_date_time();
</script></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/24681.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/24681.html class=post-title-link itemprop=url>MMC子系统</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-23 23:07:24" itemprop="dateCreated datePublished" datetime=2016-08-23T23:07:24+08:00>2016-08-23</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>设备驱动</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>驱动</span></a></span></span> <span id=/post/24681.html class="post-meta-item leancloud_visitors" data-flag-title=MMC子系统 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>3.4k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>3 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=MMC子系统><a href=#MMC子系统 class=headerlink title=MMC子系统></a>MMC子系统</h2><p>系统框架：</p><p><img data-src=/images/mmc_framework.png alt=mmc子系统></p><p>Linux MMC子系统主要分成三个部分：</p><ul><li>MMC核心层：完成不同协议和规范的实现，为host层和设备驱动层提供接口函数。MMC核心层由三个部分组成：MMC，SD和SDIO，分别为三类设备驱动提供接口函数；</li><li>Host 驱动层：针对不同主机端的SDHC、MMC控制器的驱动；</li><li>Client 驱动层：针对不同客户端的设备驱动程序。如SD卡、T-flash卡、SDIO接口的GPS和wi-fi等设备驱动。</li></ul><h2 id=代码结构><a href=#代码结构 class=headerlink title=代码结构></a>代码结构</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>.</span><br><span class=line>├── card</span><br><span class=line>├── core</span><br><span class=line>└── host</span><br></pre></td></tr></table></figure><p>MMC子系统代码主要在drivers&#x2F;mmc目录下，共有三个目录：</p><ul><li>Card：与块设备调用相关驱动，如MMC&#x2F;SD卡设备驱动，SDIOUART；</li><li>Core：整个MMC的核心层，这部分完成不同协议和规范的实现，为host层和设备驱动层提供接口函数。</li><li>Host：针对不同主机端的SDHC、MMC控制器的驱动，这部分需要由驱动工程师来完成；</li></ul><h2 id=注册流程><a href=#注册流程 class=headerlink title=注册流程></a>注册流程</h2><p>在linux系统中，系统启动时将加载相关配置的驱动模块，而各模块的加载将通过各自之间相应的结构关系进行先后顺序进行<a href=/posts/linux_kernel_initcall.md>设备注册</a>，下面是mmc子系统的注册流程</p><blockquote><p>core —&gt; host —&gt; card</p></blockquote><ol><li>core层的注册主要创建两条虚拟总线mmc_bus和sdio_bus，为host层</li><li>host注册主要为相关控制器的初始化及配置参数</li><li>card层主要用于与block设备进行绑定，为数据读写准备</li></ol><h2 id=MMC控制器驱动的软件框架><a href=#MMC控制器驱动的软件框架 class=headerlink title=MMC控制器驱动的软件框架></a>MMC控制器驱动的软件框架</h2><p>在这里主要以符合sdhci标准的mmc控制器为例，结合sdhci驱动说明mmc的工作流程。</p><p>驱动的总体框架：</p><p><img data-src=/images/mmc_software_struct.png alt=mmc驱动软件框架></p><h2 id=数据结构><a href=#数据结构 class=headerlink title=数据结构></a>数据结构</h2><p>mmc子系统是将msc（mobile storage controller）控制器及其该控制器适配的相关外设中的细节屏蔽掉而抽象出来的一种框架。<br>主要将控制器和卡抽象成为不同的结构mmc_host和mmc_card.</p><h3 id=mmc-host><a href=#mmc-host class=headerlink title=mmc_host></a>mmc_host</h3><p>该结构体主要为msc控制器所抽象化的一个对象，用于对当前控制器的描述。</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre></td><td class=code><pre><span class=line><span class=class><span class=keyword>struct</span> <span class=title>mmc_host</span> &#123;</span></span><br><span class=line><span class=class><span class=keyword>struct</span> <span class=title>device</span>		*<span class=title>parent</span>;</span></span><br><span class=line><span class=class><span class=keyword>struct</span> <span class=title>device</span>		<span class=title>class_dev</span>;</span></span><br><span class=line><span class=type>int</span>			index;</span><br><span class=line><span class=type>const</span> <span class=class><span class=keyword>struct</span> <span class=title>mmc_host_ops</span> *<span class=title>ops</span>;</span></span><br><span class=line></span><br><span class=line><span class=class><span class=keyword>struct</span> <span class=title>mmc_ios</span>		<span class=title>ios</span>;</span>		<span class=comment>/* current io bus settings */</span></span><br><span class=line></span><br><span class=line><span class=class><span class=keyword>struct</span> <span class=title>mmc_card</span>		*<span class=title>card</span>;</span>		<span class=comment>/* device attached to this host */</span></span><br><span class=line></span><br><span class=line><span class=type>const</span> <span class=class><span class=keyword>struct</span> <span class=title>mmc_bus_ops</span> *<span class=title>bus_ops</span>;</span>	<span class=comment>/* current bus driver */</span></span><br><span class=line>    .</span><br><span class=line>    .</span><br><span class=line>    .</span><br><span class=line><span class=type>unsigned</span> <span class=type>long</span>		private[<span class=number>0</span>] ____cacheline_aligned;</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p>以上为该结构体的主要成员（由于成员变量过多省略部分）</p><ol><li>struct mmc_host_ops *ops</li></ol><p>该接口主要为控制器的操作函数，用于控制器各种行为的控制，由于不同的控制器的设计和使用流程不同，mmc子系统将控制器的实际操作抽象出来，为驱动开发人员，根据实际要求进行功能实现。<br>主要功能：<br>1）request<br>为mmc子系统中的request请求进行数据处理，其中包含对cmd命令的发送和data数据的传输（PIO，DMA）<br>2）set_ios<br>主要设置控制器的各种参数，包括时钟，电压，总线宽度及驱动类型（驱动类型跟卡自身的属性相关）等。<br>3）get_sd<br>主要由于对卡的探测，实现热插拔功能（一般可能过gpio中断实现）</p><ol start=2><li>struct mmc_bus_ops</li></ol><p>主要为mmc子系统中的一条虚拟总线的操作接口函数，该接口的实现由mmc子系统自己完成。</p><ol start=3><li>struct mmc_ios ios</li></ol><p>主要为当前总线的设置参数，该总线指控制器和卡实际相接的数据线（cmd，lck，data），主要参数包含set_ios所设置的时钟，电压，总线宽度及驱动类型（驱动类型跟卡自身的属性相关）等参数。</p><h3 id=mmc-card><a href=#mmc-card class=headerlink title=mmc_card></a>mmc_card</h3><p>主要是与msc控制相连的相关卡的抽象对象，其中主要描述了卡自身的一些属性</p><h2 id=初始化控制器><a href=#初始化控制器 class=headerlink title=初始化控制器></a>初始化控制器</h2><h2 id=数据读写><a href=#数据读写 class=headerlink title=数据读写></a>数据读写</h2><p>在mmc驱动的核心是数据的读写，根据sd协议数据的读写流程基本一致。</p><blockquote><p>cmd + data<br>cmd_line 先发送读写命令<br>data_line 进行数据传输</p></blockquote><h3 id=读流程><a href=#读流程 class=headerlink title=读流程></a>读流程</h3><p>数据读命令:CMD17和CMD18（single block和multiple block）<br><img data-src=/images/mmc_single_read.png alt=数据读><br><strong>注</strong>:多个block和多根数据线读，流程基本一致，主要是在数据传输时，将读的数据分配给了4根数据线。</p><h3 id=写流程><a href=#写流程 class=headerlink title=写流程></a>写流程</h3><p>数据读命令:CMD24和CMD25（single block和multiple block）<br><img data-src=/images/mmc_single_write.png alt=数据写></p><p>注：</p><ul><li>S: start 起始位[0]</li><li>E: end 结束位[1]</li></ul><table><thead><tr><th>status</th><th>说明</th></tr></thead><tbody><tr><td>“010”</td><td>数据被接受写入卡中</td></tr><tr><td>“101”</td><td>由于CRC错误，数据不被卡接受</td></tr><tr><td>“110”</td><td>由于写错误，数据不被卡接受</td></tr></tbody></table><blockquote><p>在写的过程中由于控制器需要等到卡将数据全部写完，才视一次传输完成。而在卡写的过程中，<br>只有数据完全写入后，标志数据传输完成的busy位才会返回。同时返回的还有此次写数据后的状态status(CRC校验值)。<br>如果CRC的校验值大于”010”,将代表数据传输失败（如果status为“101”， 表示写数据出现CRC错误）</p></blockquote><h2 id=mmc中的request处理><a href=#mmc中的request处理 class=headerlink title=mmc中的request处理></a>mmc中的request处理</h2><p>在mmc子系统中将msc控制器和卡初始化完成后，进入数据传输阶段。在此阶段主要维护一个属于当前控制器的一个线程kthread_run(mmc_queue_thread, mq, “mmcqd&#x2F;%d%s”,host-&gt;index, subname ? subname : “”)，mmc_queue_thread线程在一个while(1)循环中现实对block层的request请求队列的数据处理。</p><h3 id=维护mmc-queue-thread线程状态><a href=#维护mmc-queue-thread线程状态 class=headerlink title=维护mmc_queue_thread线程状态></a>维护mmc_queue_thread线程状态</h3><ol><li>进入该线程将其设置为set_current_state(TASK_INTERRUPTIBLE)</li><li>处理request请求数据，set_current_state(TASK_RUNNING)</li><li>数据处理完毕后，如果没有需要处理的数据，调用schedule()</li></ol><h3 id=Block层的request请求队列><a href=#Block层的request请求队列 class=headerlink title=Block层的request请求队列></a>Block层的request请求队列</h3><p>请求队列的组成方式：<br><img data-src=/images/block_request_queue.png alt=request请求队列><br>具体的实现方式在block设备驱动继续。</p><h3 id=request请求队列的处理><a href=#request请求队列的处理 class=headerlink title=request请求队列的处理></a>request请求队列的处理</h3><ol><li>通过blk_fetch_request(q)从request请求队列中取出一个request请求。</li><li>如果request请求队列中有需要处理的数据，调用issue_fn(mq, req)的回调函数进行数据处理。</li></ol><h3 id=一个request请求的处理流程><a href=#一个request请求的处理流程 class=headerlink title=一个request请求的处理流程></a>一个request请求的处理流程</h3><p>这里以multiple block的读写为例进行说明：</p><h4 id=写数据的处理><a href=#写数据的处理 class=headerlink title=写数据的处理></a>写数据的处理</h4><p>在一个写操作中的request基本可以分为三类:</p><ul><li>a. 使用写命令CMD25写1024block的数据写操作</li><li>b. 先进行数据同步操作，接着使用cmd13获取卡的状态,判断没有错误后,再使用CMD25写1024block数据</li><li>c. 先进行数据同步操作，再单独发送cmd13命令检测卡的状态</li></ul><blockquote><p>注: 一次request请求所传输的数据量有block层设置.在注册card层初始化mmc_queue时,根据block的设置进行配置.<br>mmc_blk_probe-&gt;mmc_blk_alloc-&gt;mmc_blk_alloc_req-&gt;mmc_init_queue-&gt;blk_queue_max_hw_sectors-&gt;blk_limits_max_hw_sectors-&gt;BLK_DEF_MAX_SECTORS&#x3D;1024</p></blockquote><h4 id=读数据的处理><a href=#读数据的处理 class=headerlink title=读数据的处理></a>读数据的处理</h4><p>在进行读操作时的request,分为两类:</p><ul><li>a. 携带数据和读命令的request， 及CMD18 + data（512block）</li><li>b. 进行数据同步的request</li></ul><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><h2 id=附：相关简写><a href=#附：相关简写 class=headerlink title=附：相关简写></a>附：相关简写</h2><ol><li>mmc<br>mmc（Multi-Media Card）主要指mmc子系统</li><li>sd<br>sd（Secure Digital）拥有两层含义：一种指sd卡，另一种指sd卡协议</li><li>emmc<br>emmc（Embedded Multi Media Card)）同样一种指emmc卡，另一种指emmc协议，该卡的主要存储介质为nand flash，因此也称e-nand<br>3.sdio<br>sdio（Secure Digital Input and Output Card）一种在sd标准上定义的外设接口。不过其有自己的特有协议标准。主要由于sdio接口的wifi，蓝牙等</li></ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/22648.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/22648.html class=post-title-link itemprop=url>Markdown语法</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-20 06:18:39" itemprop="dateCreated datePublished" datetime=2016-08-20T06:18:39+08:00>2016-08-20</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop=url rel=index><span itemprop=name>工具</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E5%B7%A5%E5%85%B7/markdown/" itemprop=url rel=index><span itemprop=name>markdown</span></a></span></span> <span id=/post/22648.html class="post-meta-item leancloud_visitors" data-flag-title=Markdown语法 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>3.4k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>3 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>在这里主要记录makedown的使用语法，以备后续写作时的不时之需。</p><div class=post-button><a class=btn href=/post/22648.html#more rel=contents>阅读全文 &raquo;</a></div></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/27055.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/27055.html class=post-title-link itemprop=url>面试题</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-18 23:07:24" itemprop="dateCreated datePublished" datetime=2016-08-18T23:07:24+08:00>2016-08-18</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop=url rel=index><span itemprop=name>随笔</span></a></span></span> <span id=/post/27055.html class="post-meta-item leancloud_visitors" data-flag-title=面试题 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>4.7k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><span id=more></span><h2 id=union><a href=#union class=headerlink title=union></a>union</h2><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=class><span class=keyword>union</span> <span class=title>aa</span>&#123;</span></span><br><span class=line>        <span class=type>int</span> i;</span><br><span class=line>        <span class=type>char</span> a[<span class=number>2</span>];</span><br><span class=line>&#125;;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=class><span class=keyword>union</span> <span class=title>aa</span> <span class=title>b</span>;</span></span><br><span class=line>        b.i = <span class=number>0</span>; <span class=comment>//初始化内存空间，如果不清最后的b.i为随机值</span></span><br><span class=line>        b.a[<span class=number>0</span>] = <span class=number>10</span>;</span><br><span class=line>        b.a[<span class=number>1</span>] = <span class=number>1</span>;</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;%d\n&quot;</span>, b.i);</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;%d\n&quot;</span>, (<span class=number>1</span> &lt;&lt; <span class=number>8</span>) | (<span class=number>10</span>));</span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>结果： 266(256+10)</p></blockquote><ol><li>union 类型的特点是不同类型的数据共享同一段内存，union 结构体的大小为其所含占内存<code>最大成员大小</code>，但在同一时刻只能有一类成员存储于其中</li><li>计算机存储的大小端不同，最后的输出结果不一定。</li></ol><h2 id=大小端><a href=#大小端 class=headerlink title=大小端></a>大小端</h2><ol><li><code>Little endian</code>和<code>Big endian</code>是CPU存放数据的两种不同顺序</li><li><code>Big endian</code>第一个字节是最高位字节（按照从低地址到高地址的顺序存放数据的高位字节到低位字节）</li><li><code>Little endian</code>第一个字节是最低位字节（按照从低地址到高地址的顺序存放数据的低位字节到高位字节）</li></ol><ul><li><p>共同体所有数据共用同一块地址空间</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=class><span class=keyword>union</span> <span class=title>aa</span>&#123;</span></span><br><span class=line>        <span class=type>int</span> i;</span><br><span class=line>        <span class=type>char</span> j;</span><br><span class=line>&#125;;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=class><span class=keyword>union</span> <span class=title>aa</span> <span class=title>a</span>;</span></span><br><span class=line>        a.i = <span class=number>1</span>;</span><br><span class=line></span><br><span class=line>        <span class=keyword>if</span> ( a.j == <span class=number>1</span> )</span><br><span class=line>            <span class=built_in>printf</span>(<span class=string>&quot;little-endian\n&quot;</span>);</span><br><span class=line>        <span class=keyword>else</span></span><br><span class=line>            <span class=built_in>printf</span>(<span class=string>&quot;big-endian\n&quot;</span>);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure></li><li><p>指针强制类型转换</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>    <span class=type>int</span> a = <span class=number>1</span>;</span><br><span class=line>    <span class=type>char</span> * p = (<span class=type>char</span>*)&amp;a;</span><br><span class=line>    <span class=keyword>if</span> (*p == <span class=number>1</span>)</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;little-endian\n&quot;</span>);</span><br><span class=line>    <span class=keyword>else</span></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;big-endian\n&quot;</span>);</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id=宏><a href=#宏 class=headerlink title=宏></a>宏</h2><h3 id=取最大值><a href=#取最大值 class=headerlink title=取最大值></a>取最大值</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>#define PAD(v, p)  ((v + (p) - 1) &amp; (~((p) - 1)))</span><br></pre></td></tr></table></figure><h3 id=判断奇偶><a href=#判断奇偶 class=headerlink title=判断奇偶></a>判断奇偶</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>#define IS_POW2(x)  (((x) &amp; (x - 1)) == 0)</span><br></pre></td></tr></table></figure><h2 id=内存对齐><a href=#内存对齐 class=headerlink title=内存对齐></a>内存对齐</h2><ol><li>数据类型自身的对齐值：char型数据自身对齐值为1字节，short型数据为2字节，int&#x2F;float型为4字节，double型为8字节</li><li>结构体或类的自身对齐值：其成员中自身对齐值<code>最大</code>的那个值</li><li>指定对齐值：<code>#pragma pack (value)</code>时的指定对齐值value。</li><li>数据成员、结构体和类的有效对齐值：自身对齐值和指定对齐值中较小者，即有效对齐值&#x3D;min{自身对齐值，当前指定的pack值}</li></ol><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=class><span class=keyword>struct</span> <span class=title>std1</span>&#123;</span></span><br><span class=line>	<span class=type>int</span> a;     <span class=comment>//4</span></span><br><span class=line>	<span class=type>char</span> b;   <span class=comment>//1</span></span><br><span class=line>			  <span class=comment>//占空3</span></span><br><span class=line>	<span class=type>float</span> c;   <span class=comment>//4</span></span><br><span class=line>	<span class=type>char</span> d;   <span class=comment>//1</span></span><br><span class=line>			  <span class=comment>//占空3</span></span><br><span class=line>	<span class=type>double</span> e; <span class=comment>//8</span></span><br><span class=line>&#125;</span><br><span class=line><span class=keyword>sizeof</span>(std1) = <span class=number>24</span></span><br><span class=line></span><br><span class=line><span class=keyword>struct</span> std2&#123;</span><br><span class=line>	<span class=type>char</span> c;  <span class=comment>//1</span></span><br><span class=line>			 <span class=comment>//占空1</span></span><br><span class=line>	<span class=type>short</span> s;  <span class=comment>//2</span></span><br><span class=line>&#125;;</span><br><span class=line><span class=keyword>sizeof</span>(std2) = <span class=number>4</span></span><br></pre></td></tr></table></figure><h2 id=数据类型><a href=#数据类型 class=headerlink title=数据类型></a>数据类型</h2><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=type>int</span> *p = <span class=number>0</span>;</span><br><span class=line>        p += <span class=number>6</span>; <span class=comment>/*累加的是p指针类型的宽度(4*6)*/</span></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;%p\n&quot;</span>, p);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>输出： 0x18[24]</p></blockquote><h2 id=进程间通信><a href=#进程间通信 class=headerlink title=进程间通信></a>进程间通信</h2><ol><li>管道</li><li>消息队列：消息队列是由消息的链表，存放在内核中并由消息队列标识符标识，消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点</li><li>共享内存</li><li>信号量：信号量是一个计数器，可以用来控制多个进程对共享资源的访问。</li><li>socket</li><li>信号（sinal）：信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生</li></ol><blockquote><p><span class=exturl data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vTFVPNzcvcC81ODE2MzI2Lmh0bWw=">进程间通信的方式——信号、管道、消息队列、共享内存<i class="fa fa-external-link-alt"></i></span></p></blockquote><h2 id=字符串反转><a href=#字符串反转 class=headerlink title=字符串反转></a>字符串反转</h2><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=type>char</span>* <span class="title function_">revstr</span><span class=params>(<span class=type>char</span> *str)</span></span><br><span class=line>&#123;</span><br><span class=line>    <span class=type>char</span>    *start = str;</span><br><span class=line>    <span class=type>char</span>    *end = str + <span class=built_in>strlen</span>(str) - <span class=number>1</span>;</span><br><span class=line>    <span class=type>char</span>    ch;</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> (str != <span class=literal>NULL</span>) &#123;</span><br><span class=line>        <span class=keyword>while</span> (start &lt; end) &#123;</span><br><span class=line>            ch = *start;</span><br><span class=line>            *start++ = *end;</span><br><span class=line>            *end-- = ch;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>return</span> str;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line><span class=type>int</span> <span class="title function_">my_strlen</span><span class=params>(<span class=type>char</span> *str)</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=keyword>if</span>(*str == <span class=string>&#x27;\0&#x27;</span>)</span><br><span class=line>                <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>        <span class=keyword>else</span></span><br><span class=line>                <span class=keyword>return</span> my_strlen(str+<span class=number>1</span>) + <span class=number>1</span>;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">reverse_string</span><span class=params>(<span class=type>char</span> *<span class=built_in>string</span>)</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=type>int</span> len = my_strlen(<span class=built_in>string</span>);</span><br><span class=line>        <span class=keyword>if</span>(len &lt;= <span class=number>1</span>)</span><br><span class=line>                <span class=keyword>return</span> ;</span><br><span class=line>        <span class=keyword>else</span> &#123;</span><br><span class=line>                <span class=type>char</span> temp = <span class=built_in>string</span>[<span class=number>0</span>];</span><br><span class=line>                <span class=built_in>string</span>[<span class=number>0</span>] = <span class=built_in>string</span>[len<span class=number>-1</span>];</span><br><span class=line>                <span class=built_in>string</span>[len<span class=number>-1</span>] = <span class=string>&#x27;\0&#x27;</span>;</span><br><span class=line>                reverse_string(<span class=built_in>string</span>+<span class=number>1</span>);</span><br><span class=line>                <span class=built_in>string</span>[len<span class=number>-1</span>] = temp;</span><br><span class=line>        &#125;</span><br><span class=line>&#125;</span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span> &#123;</span><br><span class=line>        <span class=type>char</span> ch[] = <span class=string>&quot;abcdefghijklmno&quot;</span>;</span><br><span class=line></span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;0:%s\n&quot;</span>,ch);</span><br><span class=line>        reverse_string(ch);</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;1:%s\n&quot;</span>,ch);</span><br><span class=line></span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h2 id=指针与引用><a href=#指针与引用 class=headerlink title=指针与引用></a>指针与引用</h2><blockquote><p><code>C++</code></p></blockquote><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">change</span><span class=params>(<span class=type>int</span>*a, <span class=type>int</span> &amp;b, <span class=type>int</span> c)</span></span><br><span class=line>&#123;</span><br><span class=line>        c=*a;</span><br><span class=line>        b=<span class=number>30</span>;</span><br><span class=line>        *a=<span class=number>20</span>;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=type>int</span> a=<span class=number>10</span>, b=<span class=number>20</span>, c=<span class=number>30</span>;</span><br><span class=line>        <span class=comment>/*指针与引用*/</span></span><br><span class=line>        change(&amp;a,b,c);</span><br><span class=line>        <span class=built_in>printf</span>(<span class=string>&quot;%d,%d,%d\n&quot;</span>,a,b,c);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>结果：20,30,30</p></blockquote><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;iostream&gt;</span></span></span><br><span class=line><span class=meta>#<span class=keyword>include</span><span class=string>&lt;stdlib.h&gt;</span></span></span><br><span class=line></span><br><span class=line>using namespace <span class=built_in>std</span>;</span><br><span class=line><span class=type>void</span> <span class="title function_">test</span><span class=params>(<span class=type>int</span> &amp;a)</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=built_in>cout</span>&lt;&lt;&amp;a&lt;&lt;<span class=string>&quot; &quot;</span>&lt;&lt;a&lt;&lt;<span class=built_in>endl</span>&lt;&lt;<span class=built_in>endl</span>;</span><br><span class=line>&#125;</span><br><span class=line><span class=type>int</span> <span class="title function_">main</span><span class=params>(<span class=type>void</span>)</span></span><br><span class=line>&#123;</span><br><span class=line>        <span class=type>int</span> a=<span class=number>1</span>;</span><br><span class=line>        <span class=built_in>cout</span>&lt;&lt;&amp;a&lt;&lt;<span class=string>&quot; &quot;</span>&lt;&lt;a&lt;&lt;<span class=built_in>endl</span>&lt;&lt;<span class=built_in>endl</span>;</span><br><span class=line>        test(a);</span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>0x7fffc646494c 1<br>0x7fffc646494c 1</p></blockquote><ol><li>指针传递是一种<code>值传递</code>的方式，他<code>传递的只是地址值</code>，值传递的时候中我们可以知道被调函数的形参会被当做一个局部变量来出来，会在栈中去给其分配空间用 来存储主调函数传输过来的值，该值只不过是主调函数中实参值的一个拷贝，所以在被调函数中去修改传输过来的值并不会去影响主调函数中的实参值。</li><li>引用作为函数参数进行传递时，实质上<code>传递的是实参本身</code>，即传递进来的不是实参的一个拷贝，因此对形参的修改其实是对实参的修改，所以在用引用进行参数传递时，不仅节约时间，而且可以节约空间。</li><li>指针是一个实体，而引用仅是个别名；</li><li>引用不可以为空，当被创建的时候，必须初始化，而指针可以是空值，可以在任何时候被初始化。</li><li>可以有const指针，但是没有const引用；</li><li>指针可以有多级，但是引用只能是一级（int **p；合法 而 int &amp;&amp;a是不合法的）</li><li>指针和引用的自增(++)运算意义不一样；</li><li>如果返回动态内存分配的对象或者内存，必须使用指针，引用可能引起内存泄漏；</li></ol><h2 id=指针与数组><a href=#指针与数组 class=headerlink title=指针与数组></a>指针与数组</h2><h2 id=关键字static><a href=#关键字static class=headerlink title=关键字static></a>关键字static</h2><ol><li>在函数体，一个被声明为静态的变量在这一函数被调用过程中维持其值不变， 内存中的位置：<code>静态存储区</code>（<strong>静态存储区在整个程序运行期间都存在</strong>）</li><li>在模块内（但在函数体外），一个被声明为静态的变量可以被模块内所用函数访问，但不能被模块外其它函数访问。它是一个本地的全局变量。</li><li>在模块内，一个被声明为静态的函数只可被这一模块内的其它函数调用。那就是，这个函数被限制在声明它的模块的本地范围内使用。</li></ol><h2 id=关键字const><a href=#关键字const class=headerlink title=关键字const></a>关键字const</h2><blockquote><p>左<code>数</code>右<code>指</code></p></blockquote><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=type>const</span> <span class=type>int</span> a;    <span class=comment>//a：只读</span></span><br><span class=line><span class=type>int</span> <span class=type>const</span> a;    <span class=comment>//a：只读</span></span><br><span class=line><span class=type>const</span> <span class=type>int</span> *a;   <span class=comment>//&quot;左&quot;，指针a，数据不能变，数据只读</span></span><br><span class=line><span class=type>int</span> * <span class=type>const</span> a;  <span class=comment>//&quot;右&quot;，指针a，指针不能变，地址只读</span></span><br><span class=line><span class=type>int</span> <span class=type>const</span> * a <span class=type>const</span>;    <span class=comment>//数据指针均只读</span></span><br></pre></td></tr></table></figure><ol><li>关键字const的 作用是为给读你代码的人传达非常有用的信息，实际上，声明一个参数为常量是为了告诉了用户这个参数的应用目的。</li><li>通过给编译器一些附加的信息，使用关键字const也许能产生更紧凑的代码。</li><li>合理地使用关键字const可以使编译器很自然地保护那些不希望被改变的参数，防止其被无意的代码修改。简而言之，这样可以减少bug的出现。</li></ol><h2 id=关键字volatile><a href=#关键字volatile class=headerlink title=关键字volatile></a>关键字volatile</h2><ol><li>并行设备的硬件寄存器（如：状态寄存器），防止编译器的优化</li><li>一个中断服务子程序中会访问到的非自动变量(Non-automatic variables),(即，变量会在程序外被改变,每次都必须从内存中读取，而不能把他放在cache或寄存器中重复使用)</li><li>多线程应用中被几个任务共享的变量</li></ol><h2 id=float类型和0比较大小><a href=#float类型和0比较大小 class=headerlink title=float类型和0比较大小></a>float类型和0比较大小</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>const float EPSINON= 0.00001;</span><br><span class=line>if((x &gt;= -EPSINON) &amp;&amp; (x &lt;= EPSINON))&gt;))</span><br></pre></td></tr></table></figure><blockquote><p>不能直接用float类型的值与0进行“&#x3D;&#x3D;”或“!&#x3D;”比较</p></blockquote><p><strong>标准C语言中:</strong><br>单精度float浮点格式的符号位&#x3D;1，有效位&#x3D;23，指数未&#x3D;8，产生一个32位的表示。<br>双精度double浮点格式的符号位&#x3D;1，有效位&#x3D;52，指数位&#x3D;11，产生一个64位的表示。</p><p>转成数值即为:V&#x3D;(-1)^S * 1.M * 2^(E-127)</p><p>对于16.5转成二进制为00010000.1&#x3D;&#x3D;&gt;1.00001*2^4,<br>那么在内存的表示为:<br>符号位 指数4+127 &#x3D; 131 尾数<br>0 10000011 00001 000000000000000000</p><p>在转换过程中由于需要往右移位, 可见对于float数整数部分越大,小数部分的精度就越低<br>对float数来说有效数字约为7位(2^23约等于10^7),所以整数部分占的位数越多,小数部分<br>的精度就越低,当整数部分超过9999999后小数部分已经完全无精度了</p><h2 id=链表><a href=#链表 class=headerlink title=链表></a>链表</h2><h3 id=二分查找><a href=#二分查找 class=headerlink title=二分查找></a>二分查找</h3><h3 id=B-树-B-树><a href=#B-树-B-树 class=headerlink title=B-树(B+树)></a>B-树(B+树)</h3><h3 id=红黑树和AVL树><a href=#红黑树和AVL树 class=headerlink title=红黑树和AVL树></a>红黑树和AVL树</h3><h2 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h2><ol><li><span class=exturl data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veF93dWtvbmcvcC81NzEyMzQ1Lmh0bWw=">传指针和传指针引用的区别&#x2F;指针和引用的区别（本质）<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url=aHR0cDovL2Jsb2cuY2hpbmF1bml4Lm5ldC91aWQtMjQ2MTEzNDYtaWQtMzE5Mzg1Mi5odG1s>C语言中static变量详解 <i class="fa fa-external-link-alt"></i></span></li></ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/10323.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/10323.html class=post-title-link itemprop=url>Example</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-18 08:07:24" itemprop="dateCreated datePublished" datetime=2016-08-18T08:07:24+08:00>2016-08-18</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop=url rel=index><span itemprop=name>随笔</span></a></span></span> <span id=/post/10323.html class="post-meta-item leancloud_visitors" data-flag-title=Example title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>142</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=Test><a href=#Test class=headerlink title=Test></a>Test</h2><p>This is a test page!</p><div class=post-button><a class=btn href=/post/10323.html#more rel=contents>阅读全文 &raquo;</a></div></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/c6279e60.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/c6279e60.html class=post-title-link itemprop=url>一行代码的作用</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-18 08:07:24" itemprop="dateCreated datePublished" datetime=2016-08-18T08:07:24+08:00>2016-08-18</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop=url rel=index><span itemprop=name>随笔</span></a></span></span> <span id=/post/c6279e60.html class="post-meta-item leancloud_visitors" data-flag-title=一行代码的作用 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>269</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=网页自由编辑><a href=#网页自由编辑 class=headerlink title=网页自由编辑></a>网页自由编辑</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>document.body.contentEditable=`true`</span><br></pre></td></tr></table></figure><blockquote><ol><li>在任意需要编辑的网页中点击<code>F12</code></li><li>在调试面板选中<code>Console</code>，然后输入上面的这行代码，回车。</li><li>现在当前整个网页可以随便编辑了</li></ol></blockquote><h2 id=CSDN复制代码><a href=#CSDN复制代码 class=headerlink title=CSDN复制代码></a>CSDN复制代码</h2><ul><li>添加一个书签，名称随意设置，比如CSDN复制</li><li>设置URL为:<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>javascript:document.body.contentEditable=&#x27;true&#x27;;document.designMode=&#x27;on&#x27;; void 0</span><br></pre></td></tr></table></figure></li><li>在CSDN中遇到无法复制的代码，点击该书签后进行再复制即可</li></ul></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/16107.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/16107.html class=post-title-link itemprop=url>Hello World</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-16 23:07:24" itemprop="dateCreated datePublished" datetime=2016-08-16T23:07:24+08:00>2016-08-16</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop=url rel=index><span itemprop=name>随笔</span></a></span></span> <span id=/post/16107.html class="post-meta-item leancloud_visitors" data-flag-title="Hello World" title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>367</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>welcome to <a target=_blank rel=noopener href="https://hexo.io/">hexo</a>! this is your very first post. check <a target=_blank rel=noopener href="https://hexo.io/docs/">documentation</a> for more info. if you get any problems when using hexo, you can find the answer in <a target=_blank rel=noopener href=https://hexo.io/docs/troubleshooting.html>troubleshooting</a> or you can ask me on <a target=_blank rel=noopener href=https://github.com/hexojs/hexo/issues>github</a>.</p><div class=post-button><a class=btn href=/post/16107.html#more rel=contents>阅读全文 &raquo;</a></div></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/1644.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/1644.html class=post-title-link itemprop=url>常用的shell命令</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2015-06-18 01:49:00" itemprop="dateCreated datePublished" datetime=2015-06-18T01:49:00+08:00>2015-06-18</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/Shell/" itemprop=url rel=index><span itemprop=name>Shell</span></a></span></span> <span id=/post/1644.html class="post-meta-item leancloud_visitors" data-flag-title=常用的shell命令 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>11k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>10 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>常用的shell命令： <code>find</code>, <code>cat</code></p><div class=post-button><a class=btn href=/post/1644.html#more rel=contents>阅读全文 &raquo;</a></div></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/43508.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/43508.html class=post-title-link itemprop=url>linux下字符串操作常用函数</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2015-06-07 10:50:00" itemprop="dateCreated datePublished" datetime=2015-06-07T10:50:00+08:00>2015-06-07</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" itemprop=url rel=index><span itemprop=name>程序设计</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/C/" itemprop=url rel=index><span itemprop=name>C</span></a></span></span> <span id=/post/43508.html class="post-meta-item leancloud_visitors" data-flag-title=linux下字符串操作常用函数 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>535</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h3 id=字符串长度函数><a href=#字符串长度函数 class=headerlink title=字符串长度函数></a>字符串长度函数</h3><pre><code>    size_t strlen(const char *string);
</code></pre><h3 id=不受限制的字符串函数><a href=#不受限制的字符串函数 class=headerlink title=不受限制的字符串函数></a>不受限制的字符串函数</h3><pre><code>    char *strcpy(char *dst, const char *src);
    char *strcat(char *dst, const char *src);
    int strcmp(const char *s1, const char *s2);
</code></pre><h3 id=字符串查找><a href=#字符串查找 class=headerlink title=字符串查找></a>字符串查找</h3><pre><code>    /*
     + 功能：查找字符串s中首次出现字符c的位置
     + 说明：返回首次出现c的位置的指针，如果s中不存在c则返回NULL。
     */
    char *strchr(const char *str, int ch);
    //同上
    char *strrchr(const char *str, int ch);
</code></pre><h3 id=大小写字符转换函数><a href=#大小写字符转换函数 class=headerlink title=大小写字符转换函数></a>大小写字符转换函数</h3><pre><code>    int tolower(int ch);
    int toupper(int ch);
</code></pre><h3 id=内存操作函数><a href=#内存操作函数 class=headerlink title=内存操作函数></a>内存操作函数</h3><pre><code>    void *memcpy(void *dst, const void *src, size_t length);
    void *memmove(void *dst, const void *src, size_t length);
    void *memcmp(const void *a, const void *b, size_t length);
    void *memset(void *a, int ch, size_t length);
</code></pre><p><strong>不断更新</strong></p></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/15606.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/15606.html class=post-title-link itemprop=url>micro2440数据传输--串口通信</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2015-06-06 19:41:00" itemprop="dateCreated datePublished" datetime=2015-06-06T19:41:00+08:00>2015-06-06</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop=url rel=index><span itemprop=name>嵌入式</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/" itemprop=url rel=index><span itemprop=name>数据传输</span></a></span></span> <span id=/post/15606.html class="post-meta-item leancloud_visitors" data-flag-title=micro2440数据传输--串口通信 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>4.4k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>这段时间经过这次对比赛的准备，使用到了串口通信。或许这是最简单的通信方式吧，想弄清楚简单的数据传输协议。比较经典的i2c、CAN等数据传输，到以后的usb、ZigBee的数据传输。在这里先聊一聊串口的数据传输。</p><p>在Micro2440开发板上进行串口通信，要做的第一步便是串口驱动。这次我的开发板已经移植好了串口驱动。我只需进行操作，这里简单记录串口的基本操作 <strong>收数据</strong>、<strong>发数据</strong>以后用起来也方便，驱动下次分析。</p><h3 id=串口通信><a href=#串口通信 class=headerlink title=串口通信></a>串口通信</h3><p><strong>分类</strong>：同步串口通信（SPI）、异步串口通信（UART）</p><p>同步串行是指SPI（Serial Peripheral interface）的缩写，顾名思义就是串行外围设备接口。SPI总线系统是一种同步串行外设接口，它可以使MCU与各种外围设备以串行方式进行通信以交换信息，TRM450是SPI接口。</p><p>异步串行是指UART（Universal Asynchronous Receiver&#x2F;Transmitter），通用异步接收&#x2F;发送。UART是一个并行输入成为串行输出的芯片，通常集成在主板上。UART包含TTL电平的串口和RS232电平的串口。 TTL电平是3.3V的，而RS232是负逻辑电平，它定义+5<del>+12V为低电平，而-12</del>-5V为高电平，MDS2710、MDS SD4、EL805等是RS232接口，EL806有TTL接口。</p><h3 id=串口数据传输的特点><a href=#串口数据传输的特点 class=headerlink title=串口数据传输的特点></a>串口数据传输的特点</h3><p>1.传输速度慢，数据量不大，数据一位一位的顺序传输</p><p>2.支持双向通信，只需一对数据线,也可以一根单向通信</p><pre><code>    TXD  ---------&gt; RXD

    RXD  &lt;--------- TXD

    GND  &lt;--------&gt; GND
</code></pre><h3 id=串口的参数配置><a href=#串口的参数配置 class=headerlink title=串口的参数配置></a>串口的参数配置</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br></pre></td><td class=code><pre><span class=line>int set_opt(int fd, int nSpeed, int nBits, char nEvent, int nStop)</span><br><span class=line>&#123;</span><br><span class=line>    struct termios newtio;</span><br><span class=line>    struct termios oldtio;</span><br><span class=line></span><br><span class=line>    if(tcgetattr(fd,&amp;oldtio) != 0)</span><br><span class=line>    &#123;</span><br><span class=line>        perror(&quot;SetupSerial 2&quot;);</span><br><span class=line>        return -1;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    bzero(&amp;newtio,sizeof(newtio));</span><br><span class=line>    newtio.c_cflag |= CLOCAL |CREAD;</span><br><span class=line>    newtio.c_cflag &amp;= ~CSIZE;</span><br><span class=line></span><br><span class=line>    switch(nBits)</span><br><span class=line>    &#123;</span><br><span class=line>        case 7:</span><br><span class=line>            newtio.c_cflag |= CS7;</span><br><span class=line>            break;</span><br><span class=line>        case 8:</span><br><span class=line>            newtio.c_cflag |= CS8;</span><br><span class=line>            break;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    switch(nEvent)</span><br><span class=line>    &#123;</span><br><span class=line>        case &#x27;O&#x27;:</span><br><span class=line>            newtio.c_cflag |= PARENB;</span><br><span class=line>            newtio.c_cflag |= PARODD;</span><br><span class=line>            newtio.c_iflag |= (INPCK | ISTRIP);</span><br><span class=line>            break;</span><br><span class=line>        case &#x27;E&#x27;:</span><br><span class=line>            newtio.c_iflag |= (INPCK |ISTRIP);</span><br><span class=line>            newtio.c_cflag |= PARENB;</span><br><span class=line>            newtio.c_cflag &amp;= ~PARODD;</span><br><span class=line>            break;</span><br><span class=line>        case &#x27;N&#x27;:</span><br><span class=line>            newtio.c_cflag &amp;= ~PARENB;</span><br><span class=line>            break;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    switch(nSpeed)</span><br><span class=line>    &#123;</span><br><span class=line>        case 2400:</span><br><span class=line>            cfsetispeed(&amp;newtio,B2400);</span><br><span class=line>            cfsetospeed(&amp;newtio,B2400);</span><br><span class=line>            break;</span><br><span class=line>        case 4800:</span><br><span class=line>            cfsetispeed(&amp;newtio,B4800);</span><br><span class=line>            cfsetospeed(&amp;newtio,B4800);</span><br><span class=line>            break;</span><br><span class=line>        case 9600:</span><br><span class=line>            cfsetispeed(&amp;newtio,B9600);</span><br><span class=line>            cfsetospeed(&amp;newtio,B9600);</span><br><span class=line>            break;</span><br><span class=line>        case 115200:</span><br><span class=line>            cfsetispeed(&amp;newtio,B115200);</span><br><span class=line>            cfsetospeed(&amp;newtio,B115200);</span><br><span class=line>            break;</span><br><span class=line>        case 460800:</span><br><span class=line>            cfsetispeed(&amp;newtio,B460800);</span><br><span class=line>            cfsetospeed(&amp;newtio,B460800);</span><br><span class=line>            break;</span><br><span class=line>        default:</span><br><span class=line>            cfsetispeed(&amp;newtio,B9600);</span><br><span class=line>            cfsetospeed(&amp;newtio,B9600);</span><br><span class=line>            break;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    if(nStop == 1)&#123;</span><br><span class=line>        newtio.c_cflag &amp;= ~CSTOPB;</span><br><span class=line>    &#125;</span><br><span class=line>    else if(nStop ==2)&#123;</span><br><span class=line>        newtio.c_cflag |= CSTOPB;</span><br><span class=line>    &#125;</span><br><span class=line>    newtio.c_cc[VTIME] = 0;</span><br><span class=line>    newtio.c_cc[VMIN] = 0;</span><br><span class=line></span><br><span class=line>    tcflush(fd,TCIFLUSH);</span><br><span class=line>    if((tcsetattr(fd,TCSANOW,&amp;newtio)) != 0)</span><br><span class=line>    &#123;</span><br><span class=line>        perror(&quot;com set error&quot;);</span><br><span class=line>        return -1;</span><br><span class=line>    &#125;</span><br><span class=line>    printf(&quot;set done!\n&quot;);</span><br><span class=line>    return 0;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>int open_port(int fd,int comport)</span><br><span class=line>&#123;</span><br><span class=line>    char *dev[]=&#123;&quot;/dev/ttySAC0&quot;,&quot;/dev/ttySAC1&quot;,&quot;/dev/ttySAC2&quot;&#125;;</span><br><span class=line>    long vdisable;</span><br><span class=line>    if(comport == 1)</span><br><span class=line>    &#123;</span><br><span class=line>        fd = open(&quot;/dev/ttySAC0&quot;,O_RDWR|O_NOCTTY|O_NDELAY);</span><br><span class=line>        if(fd == -1)&#123;</span><br><span class=line>            perror(&quot;Can&#x27;t Open Serial Port&quot;);</span><br><span class=line>            return -1;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    else if(comport == 2)</span><br><span class=line>    &#123;</span><br><span class=line>        fd = open(&quot;/dev/ttySAC1&quot;,O_RDWR|O_NOCTTY|O_NDELAY);</span><br><span class=line>        if(fd == -1)&#123;</span><br><span class=line>            perror(&quot;Can&#x27;t Open Serial Port&quot;);</span><br><span class=line>            return -1;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    else if(comport == 3)</span><br><span class=line>    &#123;</span><br><span class=line>        fd = open(&quot;/dev/ttySAC2&quot;,O_RDWR|O_NOCTTY|O_NDELAY);</span><br><span class=line>        if(fd == -1)&#123;</span><br><span class=line>            perror(&quot;Can&#x27;t Open Serial Port&quot;);</span><br><span class=line>            return -1;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    if(fcntl(fd,F_SETFL,0) &lt; 0)&#123;</span><br><span class=line>        printf(&quot;fcntl failed\n&quot;);</span><br><span class=line>    &#125;</span><br><span class=line>    else&#123;</span><br><span class=line>        printf(&quot;fcntl=%d\n&quot;,fcntl(fd,F_SETFL,0));</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    if(isatty(STDIN_FILENO) == 0)&#123;</span><br><span class=line>        printf(&quot;standard input is not a terminal device\n&quot;);</span><br><span class=line>    &#125;</span><br><span class=line>    else&#123;</span><br><span class=line>        printf(&quot;isatty sucess!\n&quot;);</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    printf(&quot;fd-open=%d\n&quot;,fd);</span><br><span class=line>    return fd;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>###接收串口数据</p><pre><code>nread = read(fd,buff,n)；
</code></pre><h3 id=发送串口数据><a href=#发送串口数据 class=headerlink title=发送串口数据></a>发送串口数据</h3><pre><code>nwrite = write(fd,buff,length);
</code></pre><h3 id=实际应用><a href=#实际应用 class=headerlink title=实际应用></a>实际应用</h3><p>上面两个程序可以完成数据的收发，在具体的项目中在串口的数据传输中多种数据的传输时，会涉及到一些简单的数据处理，需要自定义一些协议。这时串口数据的收发必须精确的每个字符，不能多一个也不能少一个。</p><p>read、write函数，它们读写的字符必须精准，在write时写入数据的大小必须和字符串的大小一致。在送单一的数据时，对写数据大小不做要求可是在自定义协议中数据的大小关系到对方的解析。</p><p>这次使用的数据格式：FD 00 06 02 00 31 33 33 C8</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br></pre></td><td class=code><pre><span class=line>char Speaker(char CMD,char par,char * pString)</span><br><span class=line>&#123;</span><br><span class=line>    char headOfFrame[5];</span><br><span class=line>    char length;         //定义字符串长度</span><br><span class=line>    char ecc = 0;        //定义校验字节</span><br><span class=line>    int i = 0;</span><br><span class=line>    if (pString == NULL) //空字符串</span><br><span class=line>        return 1;</span><br><span class=line>    headOfFrame[0]=0XFD;       //构造帧头FD</span><br><span class=line>    headOfFrame[1]=0X00;       //构造数据区长度的高字节</span><br><span class=line>    length = strlen(pString);  //需要发送文本的长度</span><br><span class=line>    headOfFrame[2]=length+3;   //构造数据区长度的低字节</span><br><span class=line>    headOfFrame[3]=CMD;        //构造命令字：合成播放命令</span><br><span class=line>    headOfFrame[4]=par;        //构造命令参数：编码格式为GB2312</span><br><span class=line>    for(i=0;i&lt;5;i++)           //依次发送构造好的5个帧头字节</span><br><span class=line>    &#123;</span><br><span class=line>        ecc=ecc^(headOfFrame[i]); //对发送的字节进行异或校验</span><br><span class=line>        write(fd,&amp;headOfFrame[i],1);</span><br><span class=line>    &#125;</span><br><span class=line>    for(i=0;i&lt;length;i++)         //依次发送待合成的文本数据</span><br><span class=line>    &#123;</span><br><span class=line>        ecc=ecc^(*pString);</span><br><span class=line>        write(fd,pString,1);</span><br><span class=line>        pString ++;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    write(fd,&amp;ecc,1);    //最后发送校验和</span><br><span class=line>    return 0; //成功返回0</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/34196.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/34196.html class=post-title-link itemprop=url>url链接中汉字乱码转utf-8和gb2312</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2015-06-03 01:49:00" itemprop="dateCreated datePublished" datetime=2015-06-03T01:49:00+08:00>2015-06-03</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" itemprop=url rel=index><span itemprop=name>程序设计</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/C/" itemprop=url rel=index><span itemprop=name>C</span></a></span></span> <span id=/post/34196.html class="post-meta-item leancloud_visitors" data-flag-title=url链接中汉字乱码转utf-8和gb2312 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>2k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>在使用URL向服务器提交数据的时候，如果我们提交的数据中存在汉字，就会出现下列情况<br><span class=exturl data-url="aHR0cDovLzE5Mi4xNjguMTEuMjIvY2dpLWJpbi9zZXJpYWwuY2dpP3R5cGU9dGV4dCZ0ZXh0PSVFRiVCRiVCRCVFRiVCRiVCRCVFRiVCRiVCRCVFRiVCRiVCRCVDOCVBOA==">http://192.168.11.22/cgi-bin/serial.cgi?type=text&amp;text=%C9%DB%CD%FB%C8%A8<i class="fa fa-external-link-alt"></i></span></p><p>%C9%DB%CD%FB%C8%A8代表着什么，不是我们想要的数据，那它是什么呢？</p><p>去除所有%号：C9DBCDFBC8A8使用<a href=/src/%E6%B1%89%E5%AD%97%E5%86%85%E7%A0%81%E6%9F%A5%E8%AF%A2.exe_modify>汉字内码查询</a>可以看到<br><img data-src=/images/%E6%B1%89%E5%AD%97%E5%86%85%E7%A0%81.png alt=hanzi></p><h3 id=将汉字内码转成一个汉字><a href=#将汉字内码转成一个汉字 class=headerlink title=将汉字内码转成一个汉字></a>将汉字内码转成一个汉字</h3><ol><li><p>gb2312<br>两个字节表示一个汉字</p><pre><code> #include &lt;stdio.h&gt;
 #include &lt;string.h&gt;

 int main(void)
 &#123;
        char str[3];

        str[0]=201; /*201为C9的十进制值*/
        str[1]=219; /*219为DB的十进制值*/
        str[2]=&#39;\0&#39;;
        printf(&quot;C9DB的汉字的值为:%s&quot;,str);
        return 0;
 &#125;
</code></pre></li></ol><p>注：在终端先可以正确输出‘邵’，（使用gb2312编码，在linux下输出乱码，Windows下正常输出）<br>2. utf-8<br>三个字节表示一个汉字</p><h3 id=多个汉字输出><a href=#多个汉字输出 class=headerlink title=多个汉字输出></a>多个汉字输出</h3><pre><code>    /*将十六进制数转为十进制*/
    int hex_to_decade(char * s)
    &#123;
        char *digits=&quot;0123456789ABCDEF&quot;;

        /*判断大小写，小写的话转为大写，达到统一*/
        if (islower (s[0]))
            s[0]=toupper(s[0]);
        if (islower (s[1]))
            s[1]=toupper(s[1]);

        return 16*(strchr(digits,s[0])-strchr(digits,&#39;0&#39;))+(strchr(digits,s[1])-strchr(digits,&#39;0&#39;));
    &#125;
    void url_to_gb_or_utf(char *get_url, char *return_gb_or_utf)
    &#123;
        int url_position;/*用来保存get_url的位置*/
        int return_position;/*用来保存解码后的字符串的位置*/
        int url_len;/*用来保存get_url的长度*/
        char tmp[2];/*保存%后面的十六进制字符*/
        url_len = strlen(get_url);
        return_position = 0;

        fprintf(stdout, &quot;length=%d\n&quot;, url_len);
        for ( url_position = 0; url_position &lt; url_len; )
        &#123;
            /*如果是%将它后面的十六进制字符考到数组里*/
            if ( get_url[url_position] == &#39;%&#39; )&#123;
                tmp[0] = get_url[url_position+1];/*第一个十六进制字符*/
                tmp[1] = get_url[url_position+2];/*第二个*/
            //  tmp[2] = &#39;\0&#39;;  **串口通信中会出现乱码，结尾必须不能有其他字符**

                url_position+= 3; /*使url_position跳到的下一个%*/
                /*将十六进制数转为十进制后考入要返回的数组里*/

                return_gb_or_utf[return_position] = hex_to_decade(tmp);
                fprintf(stdout, &quot;------%d\n&quot;, return_gb_or_utf[return_position] );
            &#125;
            /*如果不是特殊字符，如英文，数字那么直接返回*/
            else&#123;
                return_gb_or_utf[return_position] = get_url[url_position];
                url_position++;
            &#125;
            return_position++;
        &#125;

        return_gb_or_utf[return_position] = 0;
    &#125;
</code></pre><p>***<em><strong>十六进制转十进制可使用：</strong>strtol函数</em>*</p><h3 id=汉字编码><a href=#汉字编码 class=headerlink title=汉字编码></a>汉字编码</h3><ol><li>UTF-8：Unicode TransformationFormat-8bit，允许含BOM，但通常不含BOM。是用以解决国际上字符的一种多字节编码，它对英文使用8位（即一个字节），中文使用24为（三个字节）来编码。</li><li>GBK是国家标准GB2312基础上扩容后兼容GB2312的标准。GBK的文字编码是用双字节来表示的，即不论中、英文字符均使用双字节来表示，为了区分中文，将其最高位都设定成1。GBK包含全部中文字符，是国家编码，通用性比UTF8差，不过UTF8占用的数据库比GBD大。</li></ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" rel=prev href="/page/33/"><i class="fa fa-angle-left" aria-label=上一页></i></a><a class=page-number href="/">1</a><span class=space>&hellip;</span><a class=page-number href="/page/33/">33</a><span class="page-number current">34</span><a class=page-number href="/page/35/">35</a><a class=page-number href="/page/36/">36</a><a class="extend next" rel=next href="/page/35/"><i class="fa fa-angle-right" aria-label=下一页></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2014 – <span itemprop=copyrightYear>2023</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>winddoing</span></div><div class=wordcount><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-chart-line"></i></span> <span title=站点总字数>1.1m</span></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-coffee"></i></span> <span title=站点阅读时长>16:21</span></span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv><span class=post-meta-item-icon><i class="fa fa-users"></i></span> <span class=site-uv title=总访客量><span id=busuanzi_value_site_uv></span></span></span> <span class=post-meta-item id=busuanzi_container_site_pv><span class=post-meta-item-icon><i class="fa fa-eye"></i></span> <span class=site-pv title=总访问量><span id=busuanzi_value_site_pv></span></span></span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 强力驱动</div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/muse.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src=/js/third-party/tags/pdf.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script><script src=/js/third-party/tags/mermaid.js></script><script src=/js/third-party/fancybox.js></script><script data-pjax async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=leancloud_visitors type=application/json>{"enable":true,"app_id":"Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz","app_key":"tgUTq5bX3fVmn916EMRe65eJ","server_url":null,"security":false}</script><script src=/js/third-party/statistics/lean-analytics.js></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script><script src=/js/third-party/math/mathjax.js></script><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"Winddoing/winddoing.github.io","issue_term":"title","theme":"github-light"}</script><script src=/js/third-party/comments/utterances.js></script></body></html>