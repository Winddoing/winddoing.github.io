<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222 media="(prefers-color-scheme: light)"><meta name=theme-color content=#222 media="(prefers-color-scheme: dark)"><meta name=generator content="Hexo 6.2.0"><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preconnect href=https://cdnjs.cloudflare.com crossorigin><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon.ico><link rel=mask-icon href=/images/logo.svg color=#222><meta name=baidu-site-verification content=WIIeufYjj6><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Microsoft+YaHei:300,300italic,400,400italic,700,700italic%7Ccmmi10:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"winddoing.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.12.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content=失败缘于忽视细处，成功始于重视小事><meta property=og:type content=website><meta property=og:title content="Winddoing&#39;s Notes"><meta property=og:url content=https://winddoing.github.io/page/33/index.html><meta property=og:site_name content="Winddoing&#39;s Notes"><meta property=og:description content=失败缘于忽视细处，成功始于重视小事><meta property=og:locale content=zh_CN><meta property=article:author content=winddoing><meta property=article:tag content=winddoing,嵌入式,Linux,kernel,shell,C语言,网络,mips,arm,arm64,虚拟化><meta name=twitter:card content=summary><link rel=canonical href="https://winddoing.github.io/page/33/"><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/33/index.html","title":""}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Winddoing's Notes - Follow Excellent, Success will Chase you</title><script src=/js/third-party/analytics/baidu-analytics.js></script><script async src=https://hm.baidu.com/hm.js?b96a560ce0a6bfbeaaddc59dc5888b75></script><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href="/" class=brand rel=start><i class=logo-line></i><h1 class=site-title>Winddoing's Notes</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Follow Excellent, Success will Chase you</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel=section><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel=section><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel=section><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=winddoing src=/images/Winddoing.jpg><p class=site-author-name itemprop=name>winddoing</p><div class=site-description itemprop=description>失败缘于忽视细处，成功始于重视小事</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href="/archives/"><span class=site-state-item-count>358</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class=site-state-item-count>112</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class=site-state-item-count>284</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL1dpbmRkb2luZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing"><i class="fab fa-github fa-fw"></i>GitHub</span></span> <span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly9naXRlZS5jb20vd2luZGRvaW5n title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing"><i class="fab fa-codiepie fa-fw"></i>Gitee</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy85NTY3MzYxL3dpbmRkb2luZw==" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9hcHAudHJhdmlzLWNpLmNvbS9naXRodWIvV2luZGRvaW5nL3dpbmRkb2luZy5naXRodWIuaW8=" title="Travis CI → https:&#x2F;&#x2F;app.travis-ci.com&#x2F;github&#x2F;Winddoing&#x2F;winddoing.github.io"><i class="fas fa-terminal fa-fw"></i>Travis CI</span></span></div><div class="cc-license site-overview-item animated" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg alt="Creative Commons"></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="link fa-fw"></i> Links</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cHM6Ly93aW5kZG9pbmcuZ2l0Ym9vay5pby9lbWJlZGRlZF9saW51eF9ub3Rlcy8=" title=https:&#x2F;&#x2F;winddoing.gitbook.io&#x2F;embedded_linux_notes&#x2F;>嵌入式相关</span></li><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2RyZWFtcQ==" title=http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq>CSDN</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cDovL3d3dy53b3dvdGVjaC5uZXQv title=http:&#x2F;&#x2F;www.wowotech.net&#x2F;>蜗窝科技</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpb25neGlhbnpl title=https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze>xiongxianze</span></li></ul></div><div id=days></div><script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("02/26/2014 15:00:00");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
}
show_date_time();
</script></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/60233.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/60233.html class=post-title-link itemprop=url>python数据处理</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-11-18 23:07:24" itemprop="dateCreated datePublished" datetime=2016-11-18T23:07:24+08:00>2016-11-18</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/Python/" itemprop=url rel=index><span itemprop=name>Python</span></a></span></span> <span id=/post/60233.html class="post-meta-item leancloud_visitors" data-flag-title=python数据处理 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>73</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p><span class=exturl data-url="aHR0cHM6Ly9zdXBlcmdpcy5naXRib29rcy5pby9naXRfbm90ZWJvb2svY29udGVudC9kb2Mvb3BlbmRhdGFzb3VyY2UuaHRtbA==">https://supergis.gitbooks.io/git_notebook/content/doc/opendatasource.html<i class="fa fa-external-link-alt"></i></span></p></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/47964.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/47964.html class=post-title-link itemprop=url>SD卡的硬件电路及相关属性</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-10-21 23:07:24" itemprop="dateCreated datePublished" datetime=2016-10-21T23:07:24+08:00>2016-10-21</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>设备驱动</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/sd/" itemprop=url rel=index><span itemprop=name>sd</span></a></span></span> <span id=/post/47964.html class="post-meta-item leancloud_visitors" data-flag-title=SD卡的硬件电路及相关属性 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>29</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=class><a href=#class class=headerlink title=class></a>class</h2><h2 id=电路连接><a href=#电路连接 class=headerlink title=电路连接></a>电路连接</h2><h2 id=相关属性><a href=#相关属性 class=headerlink title=相关属性></a>相关属性</h2><h2 id=总线信号的变化><a href=#总线信号的变化 class=headerlink title=总线信号的变化></a>总线信号的变化</h2><h2 id=CMD线的数据传输><a href=#CMD线的数据传输 class=headerlink title=CMD线的数据传输></a>CMD线的数据传输</h2></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/36894.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/36894.html class=post-title-link itemprop=url>等待队列</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-10-20 23:07:24" itemprop="dateCreated datePublished" datetime=2016-10-20T23:07:24+08:00>2016-10-20</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/Linux%E5%86%85%E6%A0%B8/" itemprop=url rel=index><span itemprop=name>Linux内核</span></a></span></span> <span id=/post/36894.html class="post-meta-item leancloud_visitors" data-flag-title=等待队列 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>94</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h3 id=等待队列><a href=#等待队列 class=headerlink title=等待队列></a>等待队列</h3><p>由循环链表实现，其元素包括指向进程描述符的指针。每个等待队列都有一个等待队列头(wait queue head),等待队列头是一个类型为wait_queue_head_t的数据结构</p><h3 id=用途><a href=#用途 class=headerlink title=用途></a>用途</h3></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/11560.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/11560.html class=post-title-link itemprop=url>sd卡测速</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-10-12 23:07:24" itemprop="dateCreated datePublished" datetime=2016-10-12T23:07:24+08:00>2016-10-12</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>设备驱动</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/mmc/" itemprop=url rel=index><span itemprop=name>mmc</span></a></span></span> <span id=/post/11560.html class="post-meta-item leancloud_visitors" data-flag-title=sd卡测速 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>3.3k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>3 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>测试sd卡的读写速度</p><h2 id=mmc驱动测速><a href=#mmc驱动测速 class=headerlink title=mmc驱动测速></a>mmc驱动测速</h2><p>结合mmc子系统提供的测试列表进行速度测试和其他相关测试。</p><h3 id=添加配置><a href=#添加配置 class=headerlink title=添加配置></a>添加配置</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>-&gt;DeviceDriver</span><br><span class=line>    -&gt; MMC/SD/SDIO card support (MMC [=y])</span><br><span class=line>    [*]MMC host test driver</span><br></pre></td></tr></table></figure><h3 id=绑定><a href=#绑定 class=headerlink title=绑定></a>绑定</h3><p>编译并启动新编译的linux内核，进入文件系统。</p><ul><li>进入mmcblk解除绑定</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>cd sys/bus/mmc/drivers/mmcblk</span><br><span class=line>echo mmc0:e624 &gt; unbind</span><br></pre></td></tr></table></figure><ul><li>绑定测试</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>cd sys/bus/mmc/drivers/mmc_test</span><br><span class=line>echo mmc0:e624 &gt; bind</span><br><span class=line>[  17.243808] mmc_test mmc0:e624: Card claimed for testing.</span><br></pre></td></tr></table></figure><h3 id=挂载debugfs><a href=#挂载debugfs class=headerlink title=挂载debugfs></a>挂载debugfs</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line># mount -t debugfs none /mnt</span><br></pre></td></tr></table></figure><h3 id=测试><a href=#测试 class=headerlink title=测试></a>测试</h3><ul><li>进入测试目录mmc0:e624</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cd /mnt/mmc0/mmc0:e624</span><br></pre></td></tr></table></figure><ul><li>查看测试列表</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br></pre></td><td class=code><pre><span class=line>#cat testlist</span><br><span class=line>	1:      Basic write (no data verification)</span><br><span class=line>	2:      Basic read (no data verification)</span><br><span class=line>	3:      Basic write (with data verification)</span><br><span class=line>	4:      Basic read (with data verification)</span><br><span class=line>	5:      Multi-block write</span><br><span class=line>	6:      Multi-block read</span><br><span class=line>	7:      Power of two block writes</span><br><span class=line>	8:      Power of two block reads</span><br><span class=line>	9:      Weird sized block writes</span><br><span class=line>	10:     Weird sized block reads</span><br><span class=line>	11:     Badly aligned write</span><br><span class=line>	12:     Badly aligned read</span><br><span class=line>	13:     Badly aligned multi-block write</span><br><span class=line>	14:     Badly aligned multi-block read</span><br><span class=line>	15:     Correct xfer_size at write (start failure)</span><br><span class=line>	16:     Correct xfer_size at read (start failure)</span><br><span class=line>	17:     Correct xfer_size at write (midway failure)</span><br><span class=line>	18:     Correct xfer_size at read (midway failure)</span><br><span class=line>	19:     Highmem write</span><br><span class=line>	20:     Highmem read</span><br><span class=line>	21:     Multi-block highmem write</span><br><span class=line>	22:     Multi-block highmem read</span><br><span class=line>	23:     Best-case read performance</span><br><span class=line>	24:     Best-case write performance</span><br><span class=line>	25:     Best-case read performance into scattered pages</span><br><span class=line>	26:     Best-case write performance from scattered pages</span><br><span class=line>	27:     Single read performance by transfer size</span><br><span class=line>	28:     Single write performance by transfer size</span><br><span class=line>	29:     Single trim performance by transfer size</span><br><span class=line>	30:     Consecutive read performance by transfer size</span><br><span class=line>	31:     Consecutive write performance by transfer size</span><br><span class=line>	32:     Consecutive trim performance by transfer size</span><br><span class=line>	33:     Random read performance by transfer size</span><br><span class=line>	34:     Random write performance by transfer size</span><br><span class=line>	35:     Large sequential read into scattered pages</span><br><span class=line>	36:     Large sequential write from scattered pages</span><br><span class=line>	37:     Write performance with blocking req 4k to 4MB</span><br><span class=line>	38:     Write performance with non-blocking req 4k to 4MB</span><br><span class=line>	39:     Read performance with blocking req 4k to 4MB</span><br><span class=line>	40:     Read performance with non-blocking req 4k to 4MB</span><br><span class=line>	41:     Write performance blocking req 1 to 512 sg elems</span><br><span class=line>	42:     Write performance non-blocking req 1 to 512 sg elems</span><br><span class=line>	43:     Read performance blocking req 1 to 512 sg elems</span><br><span class=line>	44:     Read performance non-blocking req 1 to 512 sg elems</span><br><span class=line>	45:     eMMC hardware reset</span><br></pre></td></tr></table></figure><ul><li>执行测试</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>echo 34 &gt; test</span><br></pre></td></tr></table></figure><h2 id=测试命令-dd><a href=#测试命令-dd class=headerlink title="测试命令 dd"></a>测试命令 dd</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>dd if=/dev/zero of=/dev/null</span><br></pre></td></tr></table></figure><ul><li>输入或输出</li></ul><blockquote><p>dd if&#x3D;[STDIN] of&#x3D;[STDOUT]</p></blockquote><ul><li>强迫输入或输出的Size为多少Bytes</li></ul><blockquote><p>bs: dd -ibs&#x3D;[BYTE] -obs&#x3D;[SIZE]</p></blockquote><ul><li>强迫一次只做多少个 Bytes</li></ul><blockquote><p>bs&#x3D;BYTES</p></blockquote><ul><li>跳过一段以后才输出</li></ul><blockquote><p>seek&#x3D;BLOCKS</p></blockquote><ul><li>跳过一段以后才输入</li></ul><blockquote><p>skip&#x3D;BLOCKS</p></blockquote><h3 id=写测试><a href=#写测试 class=headerlink title=写测试></a>写测试</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>dd if=/dev/zero of=/mnt/sd/test.txt bs=512 count=100</span><br><span class=line></span><br></pre></td></tr></table></figure><p>写数据量：512*100 &#x2F; 1024 &#x3D; 50Kb</p><h3 id=读测试><a href=#读测试 class=headerlink title=读测试></a>读测试</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>dd if=/mnt/sd/test.txt of=/dev/null bs=512 count=100</span><br><span class=line></span><br></pre></td></tr></table></figure><p>读数据量：512*100 &#x2F; 1024 &#x3D; 50Kb</p><h2 id=PC测试><a href=#PC测试 class=headerlink title=PC测试></a>PC测试</h2><p>在pc上使用以上命令，将读写的目标改为（&#x2F;dev&#x2F;sdb）即可得到当前的读写速度</p><h2 id=开发板测试><a href=#开发板测试 class=headerlink title=开发板测试></a>开发板测试</h2><p>由于在开发板中的文件系统使用busybox编译生成，其中的dd命令无法直接得到读写速度，因此需要结合time命令</p><h3 id=写测试-1><a href=#写测试-1 class=headerlink title=写测试></a>写测试</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>time dd if=/dev/zero of=/mnt/sd/test.txt bs=512 count=100</span><br><span class=line></span><br></pre></td></tr></table></figure><p>写数据量：512*100 &#x2F; 1024 &#x3D; 50Kb</p><h3 id=读测试-1><a href=#读测试-1 class=headerlink title=读测试></a>读测试</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>time dd if=/mnt/sd/test.txt of=/dev/null bs=512 count=100</span><br><span class=line></span><br></pre></td></tr></table></figure><p>读数据量：512*100 &#x2F; 1024 &#x3D; 50Kb</p><h3 id=注意事项><a href=#注意事项 class=headerlink title=注意事项></a>注意事项</h3><ol><li>在对sd进行测速时，使用以上命令进行读写操作，文件系统会将该数据块进行一定大小（128个block为一个单元，即一个request请求）的分割，并将其传入sd驱动。在mmc驱动中配置msc控制器的block count大小时，其值为VFS层传入的128blk。</li></ol><p>也就是说一个大于128个block数据块的读写，在mmc驱动中使用若干个request请求进行读写操作完成。</p><ol start=2><li>写测试增加conv&#x3D;fsync参数</li></ol><p>该参数可通过dd -h查看，作用将写的数据完全写入到sd完成返回，但是使用后根据写操作所得到的时间计算的写速度将降低<br>主要原因是，使用fsync后文件系统会将写的数据块根据bs的大小进行分割，也就是将其分割成count个bs。如果bs为512时，一次request请求的block count为512，加大了request请求次数，同时将增加sd驱动中的中断次数和读及等状态的次数，继而增大了写操作的时间，最后计算的写速度将降低。</p><h2 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h2><p>读写速率和以下情况有关：</p><ol><li>外部通信时钟；</li><li>DDR时钟，</li><li>代码运行速率，和CPU时钟、L2CACHE时钟有关</li><li>当前系统负荷</li><li>内部的总线时钟，比如MMC控制器所在的APB总线等</li><li>MMC控制器的DMA工作时钟</li><li>读写代码的流程</li><li>MSC的通信数据线的位数</li><li>读写的位置是否连续。</li></ol><p>其中瓶颈是在（1）SD的通信速率（7）代码的流程（8）SD卡通信所占用的数据线（9）读写的位置是否连续</p></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/53101.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/53101.html class=post-title-link itemprop=url>Git操作</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-10-07 23:07:24" itemprop="dateCreated datePublished" datetime=2016-10-07T23:07:24+08:00>2016-10-07</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop=url rel=index><span itemprop=name>工具</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E5%B7%A5%E5%85%B7/git/" itemprop=url rel=index><span itemprop=name>git</span></a></span></span> <span id=/post/53101.html class="post-meta-item leancloud_visitors" data-flag-title=Git操作 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>8.4k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>8 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>记录平时对git的使用方法和技巧</p><h2 id=创建本地git库><a href=#创建本地git库 class=headerlink title=创建本地git库></a>创建本地git库</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>mkdir test.git</span><br></pre></td></tr></table></figure><p>进入test.git</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git init --bare --shared</span><br></pre></td></tr></table></figure><blockquote><p>Window下进行跨平台的clone操作，下载链接前需要添加<code>ssh</code></p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git remote add origin ssh://hostname@192.168.1.1:/test.git</span><br></pre></td></tr></table></figure><p>Linux:</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git remote add origin hostname@192.168.1.1:/test.git</span><br></pre></td></tr></table></figure></blockquote><p>新建单独用户下载：</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class="meta prompt_"># </span><span class=language-bash>为了禁止登录将shell，修改为git-shell或者/bin/false将禁止登录</span></span><br><span class=line>sudo useradd -c &#x27;git version control&#x27; -s /usr/bin/git-shell -M git -d /git</span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>设置密码</span></span><br><span class=line>sudo passwd git</span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>创建home目录</span></span><br><span class=line>sudo mkdir /git</span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>修改所属权限</span></span><br><span class=line>sudo chown -R git:git /git/</span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>测试仓库</span></span><br><span class=line>sudo git init --bare --shared  /git/123.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>sudo adduser git</span><br><span class=line>sudo usermod -G sudo -a git</span><br></pre></td></tr></table></figure><h2 id=创建分支><a href=#创建分支 class=headerlink title=创建分支></a>创建分支</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git branch branch_name</span><br></pre></td></tr></table></figure><p>删除本地分支：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git branch -d branch_name</span><br></pre></td></tr></table></figure><h2 id=切换分支><a href=#切换分支 class=headerlink title=切换分支></a>切换分支</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git checkout  branch_name</span><br></pre></td></tr></table></figure><h2 id=下载><a href=#下载 class=headerlink title=下载></a>下载</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git clone  URL</span><br></pre></td></tr></table></figure><p>下载较大工程：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git clone --depth=1 URL</span><br></pre></td></tr></table></figure><blockquote><p>depth用于指定克隆深度，为1即表示只克隆最近一次commit.</p></blockquote><h2 id=创建本地镜像仓库><a href=#创建本地镜像仓库 class=headerlink title=创建本地镜像仓库></a>创建本地镜像仓库</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git clone --mirror &lt;URL&gt;</span><br></pre></td></tr></table></figure><ul><li>更新镜像库<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git remote update</span><br></pre></td></tr></table></figure></li></ul><h2 id=日志><a href=#日志 class=headerlink title=日志></a>日志</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git commit</span><br></pre></td></tr></table></figure><h3 id=日志规范><a href=#日志规范 class=headerlink title=日志规范></a>日志规范</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class=line>// 空一行</span><br><span class=line>&lt;body&gt;</span><br><span class=line>// 空一行</span><br><span class=line>&lt;footer&gt;</span><br></pre></td></tr></table></figure><h4 id=type><a href=#type class=headerlink title=type></a>type</h4><ul><li><code>feat</code>：新功能（feature）</li><li><code>fix</code>：修补bug</li><li><code>docs</code>：文档（documentation）</li><li><code>style</code>： 格式（不影响代码运行的变动）</li><li><code>refactor</code>：重构（即不是新增功能，也不是修改bug的代码变动）</li><li><code>test</code>：增加测试</li><li><code>chore</code>：构建过程或辅助工具的变动</li></ul><h4 id=scope><a href=#scope class=headerlink title=scope></a>scope</h4><p><code>scope</code>用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p><h4 id=subject><a href=#subject class=headerlink title=subject></a>subject</h4><p>subject是 commit 目的的简短描述，不超过50个字符。填写要求：以动词开头</p><h2 id=提交><a href=#提交 class=headerlink title=提交></a>提交</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git push 远程库名  分支名</span><br></pre></td></tr></table></figure><h2 id=更新><a href=#更新 class=headerlink title=更新></a>更新</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git pull 远程库名  分支名</span><br></pre></td></tr></table></figure><h2 id=添加代码><a href=#添加代码 class=headerlink title=添加代码></a>添加代码</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>git add &lt;filename&gt;</span><br><span class=line>git add -A    #添加所有修改</span><br></pre></td></tr></table></figure><h2 id=查看日志><a href=#查看日志 class=headerlink title=查看日志></a>查看日志</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>git log</span><br><span class=line>git log -n     #查看前n条日志</span><br><span class=line>git log --stat  #查看日志的修改情况</span><br><span class=line>git log -p       #查看日志的具体修改</span><br><span class=line>git log &lt;filename/dirname&gt;  #查看该文件或目录的修改日志</span><br><span class=line>git log -S [keyword]  #在提交log中搜索关键词</span><br></pre></td></tr></table></figure><h3 id=tig><a href=#tig class=headerlink title=tig></a>tig</h3><blockquote><p>命令行下查看git历史提交记录的工具</p></blockquote><h2 id=回退><a href=#回退 class=headerlink title=回退></a>回退</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git reset HEAD &lt;filename&gt; #将该文件从缓冲区撤回</span><br></pre></td></tr></table></figure><h2 id=查看远程库><a href=#查看远程库 class=headerlink title=查看远程库></a>查看远程库</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git remote -v</span><br></pre></td></tr></table></figure><p>添加远程库：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git remote add &lt;name&gt; &lt;url&gt;</span><br></pre></td></tr></table></figure><h2 id=获取远程库中的最新版本，但与git-pull-不同它不会merge><a href=#获取远程库中的最新版本，但与git-pull-不同它不会merge class=headerlink title="获取远程库中的最新版本，但与git pull 不同它不会merge"></a>获取远程库中的最新版本，但与git pull 不同它不会merge</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git  fetch  远程库名  分支名</span><br></pre></td></tr></table></figure><p>作用：可以对比远程库与当前本地的差异。</p><h2 id=查看标签><a href=#查看标签 class=headerlink title=查看标签></a>查看标签</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git tag</span><br></pre></td></tr></table></figure><p>作用：一个稳定的版本或者完成一个功能，为了发布或者保存而打的标签，主要是发布</p><h2 id=切换标签><a href=#切换标签 class=headerlink title=切换标签></a>切换标签</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git checkout &lt;Tag&gt;</span><br></pre></td></tr></table></figure><h2 id=暂存当前改动><a href=#暂存当前改动 class=headerlink title=暂存当前改动></a>暂存当前改动</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git stash</span><br></pre></td></tr></table></figure><blockquote><p>保存当前工作进度，会把暂存区和工作区的改动保存起来。执行完这个命令后，在运行git status命令，就会发现当前是一个干净的工作区，没有任何改动。使用git stash save ‘message…’可以添加一些注释</p></blockquote><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git stash list</span><br></pre></td></tr></table></figure><blockquote><p>显示保存进度的列表。也就意味着，git stash命令可以多次执行。</p></blockquote><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git stash pop [–index] [stash_id]</span><br></pre></td></tr></table></figure><blockquote><p>git stash pop 恢复最新的进度到工作区。git默认会把工作区和暂存区的改动都恢复到工作区。</p></blockquote><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git stash apply [–index] [stash_id]</span><br></pre></td></tr></table></figure><blockquote><p>除了不删除恢复的进度之外，其余和git stash pop 命令一样。</p></blockquote><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git stash drop [stash_id]</span><br></pre></td></tr></table></figure><blockquote><p>删除一个存储的进度。如果不指定stash_id，则默认删除最新的存储进度。</p></blockquote><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git stash clear</span><br></pre></td></tr></table></figure><blockquote><p>删除所有存储的进度。</p></blockquote><h2 id=恢复本地错误操作><a href=#恢复本地错误操作 class=headerlink title=恢复本地错误操作></a>恢复本地错误操作</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git reflog</span><br></pre></td></tr></table></figure><blockquote><p>查看所有分支的所有操作记录（包括已经被删除的 commit 记录和 reset 的操作）</p></blockquote><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>$git reflog -h</span><br><span class=line>usage: git reflog [ show | expire | delete ]</span><br></pre></td></tr></table></figure><blockquote><ul><li><code>show</code>: 显示所有条目,缺省值</li><li><code>expire</code>: 删除掉更老的reflog条目</li><li><code>delete</code>: 从reflog中删除一个条目</li></ul></blockquote><h2 id=模块管理><a href=#模块管理 class=headerlink title=模块管理></a>模块管理</h2><ol><li><p>添加模块</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git submodule add projectB.git projectB</span><br></pre></td></tr></table></figure></li><li><p>使用子模块</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>git submodule init</span><br><span class=line>git submodule update</span><br></pre></td></tr></table></figure><blockquote><p>克隆项目后，默认子模块目录下无任何内容。需要在项目根目录执行此命令完成子模块的下载</p><p><strong>在clone整个项目时添加递归参数:<code>--recurse-submodules</code></strong></p></blockquote></li><li><p>删除子模块</p><ol><li><code>rm -rf 子模块目录</code> 删除子模块目录及源码</li><li><code>vi .gitmodules</code> 删除项目目录下.gitmodules文件中子模块相关条目</li><li><code>vi .git/config</code> 删除配置项中子模块相关条目</li><li><code>rm .git/module/*</code> 删除模块下的子模块目录，每个子模块对应一个目录，注意只删除对应的子模块目录即可</li></ol></li></ol><p>执行完成后，再执行添加子模块命令即可，如果仍然报错，执行如下：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git rm --cached 子模块名称</span><br></pre></td></tr></table></figure><h2 id=commit统计><a href=#commit统计 class=headerlink title=commit统计></a>commit统计</h2><p>可以大致了解一下每个人对这个项目提交的commit数量和大致的贡献度</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git summary</span><br></pre></td></tr></table></figure><h2 id=git获取最近一次提交的commit-id><a href=#git获取最近一次提交的commit-id class=headerlink title=git获取最近一次提交的commit-id></a>git获取最近一次提交的commit-id</h2><ul><li><p>获取完整commit id</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git rev-parse HEAD</span><br></pre></td></tr></table></figure></li><li><p>获取short commit id</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git rev-parse --short HEAD</span><br></pre></td></tr></table></figure></li></ul><h2 id=git无法忽略target-或者不生效的情况><a href=#git无法忽略target-或者不生效的情况 class=headerlink title=.git无法忽略target,或者不生效的情况></a>.git无法忽略target,或者不生效的情况</h2><p><code>.gitignore</code>未生效，原因是.gitignore只能忽略那些原来没有被track的文件，如果某些文件已经被纳入了版本管理中，则修改.gitignore是无效的。那么解决方法就是先把本地缓存删除（改变成未track状态），然后再提交</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>git rm -r --cached .</span><br><span class=line>git add .</span><br><span class=line>git commit -m &#x27;update .gitignore&#x27;</span><br></pre></td></tr></table></figure><h2 id=强制更新代码><a href=#强制更新代码 class=headerlink title=强制更新代码></a>强制更新代码</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git push origin master --force</span><br></pre></td></tr></table></figure><ul><li>错误：<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>remote: error: denying non-fast-forward refs/heads/master (you should pull first)</span><br></pre></td></tr></table></figure><blockquote><p>该消息表示您不允许进行非快进推送, 远程存储库很可能在其配置中<code>denyNonFastforwards = true</code>, 要更改设置，请执行<code>git config receive.denynonfastforwards false</code></p></blockquote></li></ul><h2 id=从git中打包代码><a href=#从git中打包代码 class=headerlink title=从git中打包代码></a>从git中打包代码</h2><ul><li>打包某一个分支<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git archive --format=tar.gz --output &quot;output.tar.gz&quot; master</span><br></pre></td></tr></table></figure></li><li>打包某一个commit<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git archive --format=tar.gz --output &quot;output.tar.gz&quot; ac1c53d</span><br></pre></td></tr></table></figure></li><li>打包某些目录<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git archive --format=tar.gz --output &quot;output.tar.gz&quot; master dir1 dir2</span><br></pre></td></tr></table></figure></li></ul><h2 id=合并代码><a href=#合并代码 class=headerlink title=合并代码></a>合并代码</h2><ul><li><p>合并指定分支到当前分支</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git merge [branch_name]</span><br></pre></td></tr></table></figure></li><li><p>选择一个commit，合并到当前分支</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git cherry-pick [branch_name]</span><br></pre></td></tr></table></figure></li></ul><h2 id=查看信息><a href=#查看信息 class=headerlink title=查看信息></a>查看信息</h2><ul><li>查看指定文件什么人在什么时间修改过<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git blame [filename]</span><br></pre></td></tr></table></figure></li></ul><h2 id=git服务器><a href=#git服务器 class=headerlink title=git服务器></a>git服务器</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git daemon --export-all --verbose --base-path=.</span><br></pre></td></tr></table></figure><ul><li><code>--export-all</code>: “–base-path”下所有的repo仓库</li><li><code>--base-path=.</code>: 定义为当前目录</li><li><code>--verbose</code>: 任何操作都会给当前repo通知</li></ul><h2 id=svn仓库迁移至git><a href=#svn仓库迁移至git class=headerlink title=svn仓库迁移至git></a>svn仓库迁移至git</h2><ul><li>svn的日志提交者与git相关用户进行绑定<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>svn log -q | awk -F &#x27;|&#x27; &#x27;/^r/ &#123;sub(&quot;^ &quot;, &quot;&quot;, $2); sub(&quot; $&quot;, &quot;&quot;, $2); print $2&quot; = &quot;$2&quot; &lt;&quot;$2&quot;&gt;&quot;&#125;&#x27; | sort -u &gt; users.txt</span><br></pre></td></tr></table></figure><blockquote><p><code>users.txt</code>的意义仅在于，将svn里面的提交者日志，注意是提交者，不是svn里面所有的用户信息都得关联</p></blockquote></li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>aaa = git-aaa &lt;aaa@xx.com&gt; #用户名 邮件地址</span><br><span class=line>bbb = git-bbb &lt;bbb@xx.com&gt;</span><br></pre></td></tr></table></figure><ul><li>使用<code>git-svn</code>进行下载并提交</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>sudo apt install git-svn</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git svn clone &lt;SVN_URL&gt; --no-metadata --trunk=&quot;svnproject&quot; --tags=&quot;tags&quot; --branches=&quot;svnbranches&quot; --authors-file=users.txt --preserve-empty-dirs project-dir</span><br></pre></td></tr></table></figure><ul><li><code>--no-metadata</code>: 阻止git导出SVN包含的一些无用信息</li><li><code>--trunk=&quot;svnproject&quot;</code>: 指定导出仓库的主干项目路径，默认trunk</li><li><code>--tags=&quot;tags&quot;</code>: 日志标记</li><li><code>--branches=&quot;svnbranches&quot;</code>: 指定svn的分支项目路径</li><li><code>--authors-file=users.txt</code>: 指定svn帐号在git中的映射</li><li><code>--preserve-empty-dirs</code>: 保留原SVN项目中的空目录</li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git remote add origin &lt;GIT-URL&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git push origin master #--all</span><br></pre></td></tr></table></figure><h2 id=修改已提交的用户名和邮箱><a href=#修改已提交的用户名和邮箱 class=headerlink title=修改已提交的用户名和邮箱></a>修改已提交的用户名和邮箱</h2><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>git filter-branch --commit-filter &#x27;</span><br><span class=line>if [ &quot;$GIT_AUTHOR_EMAIL&quot; = &quot;old_email@email.com&quot; ];</span><br><span class=line>then</span><br><span class=line>    GIT_AUTHOR_NAME=&quot;new_name&quot;;</span><br><span class=line>    GIT_AUTHOR_EMAIL=&quot;new_email@email.com&quot;;</span><br><span class=line>    git commit-tree &quot;$@&quot;;</span><br><span class=line>else</span><br><span class=line>    git commit-tree &quot;$@&quot;;</span><br><span class=line>    fi&#x27; HEAD</span><br></pre></td></tr></table></figure><blockquote><p><strong>注</strong>:可以修改但是在github中还是可以看到之前的用户名,效果不太好</p></blockquote><ul><li><span class=exturl data-url=aHR0cHM6Ly9naXQtc2NtLmNvbS9ib29rL3poL3YyL0dpdC0lRTUlQjclQTUlRTUlODUlQjctJUU5JTg3JThEJUU1JTg2JTk5JUU1JThFJTg2JUU1JThGJUIy>7.6 Git 工具 - 重写历史<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id=命令行工具——tig><a href=#命令行工具——tig class=headerlink title=命令行工具——tig></a>命令行工具——tig</h2><ul><li>commit操作： <code>上/下键</code>可以选择log中的commit</li><li>查看修改信息： <code>j/k</code></li><li>展示commit-id： <code>shift+x</code></li></ul><h2 id=删除已删除文件或目录的所以历史记录><a href=#删除已删除文件或目录的所以历史记录 class=headerlink title=删除已删除文件或目录的所以历史记录></a>删除已删除文件或目录的所以历史记录</h2><ul><li><p>查找大文件</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class="meta prompt_"># </span><span class=language-bash>列出前5个大文件</span></span><br><span class=line>git verify-pack -v .git/objects/pack/pack-*.idx | sort -k 3 -g | tail -5</span><br><span class=line><span class="meta prompt_"></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>查看大文件路径</span></span><br><span class=line>git rev-list --objects --all | grep 8f10eff91bb6aa2de1f5d096ee2e1687b0eab007</span><br></pre></td></tr></table></figure></li><li><p>删除文件</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git filter-branch --force --index-filter &#x27;git rm --cached --ignore-unmatch pom.xml&#x27; --prune-empty --tag-name-filter cat -- --all</span><br></pre></td></tr></table></figure></li><li><p>删除目录</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git filter-branch --force --index-filter &#x27;git rm --cached -r --ignore-unmatch qemu/qemu-4.2.0/&#x27; --prune-empty --tag-name-filter cat -- --all</span><br></pre></td></tr></table></figure></li><li><p>删除回收</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>rm -rf .git/refs/original/</span><br><span class=line>git reflog expire --expire=now --all</span><br><span class=line>git gc --prune=now</span><br><span class=line>git gc --aggressive --prune=now</span><br></pre></td></tr></table></figure></li></ul><h2 id=rebase方式合并分支，分支在一条线><a href=#rebase方式合并分支，分支在一条线 class=headerlink title=rebase方式合并分支，分支在一条线></a>rebase方式合并分支，分支在一条线</h2><ol><li>checkout到需要合并的分支feature<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git checkout feature</span><br></pre></td></tr></table></figure></li><li>在feature分支上合并master分支的修改，生成一个新的分支版本<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git rebase master</span><br></pre></td></tr></table></figure></li><li>如果存在冲突解决冲突<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>git mergetool</span><br><span class=line>git rebase —continue</span><br></pre></td></tr></table></figure></li><li>checkout到master分支<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git checkout master</span><br></pre></td></tr></table></figure></li><li>合并新的feature分支到master分支<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git merge feature</span><br></pre></td></tr></table></figure></li><li>合并完毕，可以删除feature分支<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git branch --delete feature</span><br></pre></td></tr></table></figure></li><li>提交更新<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git push origin master --force</span><br></pre></td></tr></table></figure></li></ol><h2 id=删除已提交的commit><a href=#删除已提交的commit class=headerlink title=删除已提交的commit></a>删除已提交的commit</h2><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git rebase -i [commit-id]</span><br></pre></td></tr></table></figure><blockquote><p>commit-id: 为要删除的commit的下一个commit号</p></blockquote><p>示例：</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br></pre></td><td class=code><pre><span class=line>pick 1821834 add gnuplot test</span><br><span class=line>pick 5522ce1 add gnuplot test shell</span><br><span class=line><span class="meta prompt_"></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>Rebase e6fcac3..5522ce1 onto e6fcac3 (2 commands)</span></span><br><span class=line><span class="meta prompt_">#</span><span class=language-bash></span></span><br><span class=line><span class=language-bash><span class=comment># Commands:</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>p, pick &lt;commit&gt; = use commit</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>r, reword &lt;commit&gt; = use commit, but edit the commit message</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>e, edit &lt;commit&gt; = use commit, but stop <span class=keyword>for</span> amending</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>s, squash &lt;commit&gt; = use commit, but meld into previous commit</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>f, fixup &lt;commit&gt; = like <span class=string>&quot;squash&quot;</span>, but discard this commit<span class=string>&#x27;s log message</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>x, exec &lt;command&gt; = run command (the rest of the line) using shell</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>b, break = stop here (continue rebase later with &#x27;</span>git rebase --<span class=built_in>continue</span><span class=string>&#x27;)</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>d, drop &lt;commit&gt; = remove commit</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>l, label &lt;label&gt; = label current HEAD with a name</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>t, reset &lt;label&gt; = reset HEAD to a label</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [# &lt;oneline&gt;]</span></span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash><span class=string>.       create a merge commit using the original merge commit&#x27;</span>s</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>.       message (or the oneline, <span class=keyword>if</span> no original merge commit was</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>.       specified). Use -c &lt;commit&gt; to reword the commit message.</span></span><br><span class=line><span class="meta prompt_">#</span><span class=language-bash></span></span><br><span class=line><span class=language-bash><span class=comment># These lines can be re-ordered; they are executed from top to bottom.</span></span></span><br><span class=line><span class="meta prompt_">#</span><span class=language-bash></span></span><br><span class=line><span class=language-bash><span class=comment># If you remove a line here THAT COMMIT WILL BE LOST.</span></span></span><br><span class=line><span class="meta prompt_">#</span><span class=language-bash></span></span><br><span class=line><span class=language-bash><span class=comment># However, if you remove everything, the rebase will be aborted.</span></span></span><br><span class=line><span class="meta prompt_">#</span><span class=language-bash></span></span><br><span class=line><span class=language-bash><span class=comment># Note that empty commits are commented out</span></span></span><br></pre></td></tr></table></figure><blockquote><p>将需要删除的commit前面的<code>pick</code>改写为<code>drop</code>后，保存退出</p></blockquote><ul><li>退出后，可能存在冲突通过<code>git mergetool</code>解决掉冲突后，使用<code>git rebase —continue</code>继续直到解决完所有冲突提示rebase成功，删除完成。</li><li>如果中途不想删除后，可以通过<code>git rebase --abort</code>终止删除动作</li></ul><h2 id=仓库地址为http时-用户名密码保存><a href=#仓库地址为http时-用户名密码保存 class=headerlink title=仓库地址为http时,用户名密码保存></a>仓库地址为http时,用户名密码保存</h2><ul><li>临时生效</li></ul><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git config --global credential.helper cache</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git config --global credential.helper store</span><br></pre></td></tr></table></figure><blockquote><p>需要在第一次使用该仓库时,输入用户名密码后,会以配置文件(.git-credentials)保存到本地,后期使用不再需要输入用户名密码</p></blockquote><p>删除保存的用户名密码配置文件:<code>rm ~/.git-credentials</code></p><h2 id=当前仓库信息><a href=#当前仓库信息 class=headerlink title=当前仓库信息></a>当前仓库信息</h2><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line>remote=$(git remote -v | grep fetch | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class=line>branch=$(git symbolic-ref --short -q HEAD)</span><br><span class=line>tag=$(git log -1 --decorate=short --oneline|grep -Eo &#x27;tag: (.*)[,)]+&#x27;|awk &#x27;&#123;print $2&#125;&#x27;|sed &#x27;s/)//g&#x27;|sed &#x27;s/,//g&#x27;)</span><br><span class=line>commit=$(git rev-parse --short HEAD)</span><br><span class=line>mesg=$(git log -1 --pretty=format:%B)</span><br><span class=line></span><br><span class=line>echo &quot;$lib info: branch=$branch, tag=$tag, commit=$commit, mesg=$mesg&quot;</span><br></pre></td></tr></table></figure><h2 id=git-show-x2F-diff-tab显示宽度><a href=#git-show-x2F-diff-tab显示宽度 class=headerlink title="git show&#x2F;diff tab显示宽度"></a>git show&#x2F;diff tab显示宽度</h2><p>设置Tab显示为4个字符的宽度</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git config --global core.pager &#x27;less -x1,5&#x27;</span><br></pre></td></tr></table></figure><p>设置Tab显示为8个字符的宽度（默认）</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git config --global core.pager &#x27;less&#x27;</span><br></pre></td></tr></table></figure><h2 id=gitattributes><a href=#gitattributes class=headerlink title=.gitattributes></a>.gitattributes</h2><p>当执行 git 动作时，.gitattributes 文件允许你指定由 git 使用的文件和路径的属性</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line># Declare files that always have LF line endings on checkout</span><br><span class=line>* text eol=lf</span><br><span class=line># Denote all files that are truly binary and should not be modified</span><br><span class=line>*.bmp binary</span><br><span class=line>*.ttf binar</span><br></pre></td></tr></table></figure><ul><li><code>* text eol=lf</code>：所有文件上传仓库时将windows下的<code>eol</code>转换为linux下的<code>lf</code></li></ul><blockquote><p>开发者使用不同的操作系统，默认的文件结尾行就会不同。在 Windows 上默认的是回车换行（Carriage Return Line Feed, CRLF），然而，在 Linux&#x2F;MacOS 上则是换行（Line Feed, LF）。</p></blockquote><h2 id=错误处理><a href=#错误处理 class=headerlink title=错误处理></a>错误处理</h2><h3 id=git-clone><a href=#git-clone class=headerlink title="git clone"></a>git clone</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>fatal: The remote end hung up unexpectedly</span><br><span class=line>fatal: early EOF</span><br><span class=line>fatal: index-pack failed</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>git config --add core.compression -1</span><br></pre></td></tr></table></figure><blockquote><p>compression 是压缩的意思，从clone的终端输出就知道，服务器会压缩目标文件，然后传输到客户端，客户端再解压。取值为 [-1, 9]，-1 以 zlib 为默认压缩库，0 表示不进行压缩，1..9 是压缩速度与最终获得文件大小的不同程度的权衡，数字越大，压缩越慢，当然得到的文件会越小。</p></blockquote><h2 id=DoTo><a href=#DoTo class=headerlink title=DoTo></a>DoTo</h2><ol><li><span class=exturl data-url="aHR0cDovL2Jsb2cuam9iYm9sZS5jb20vMTA5NDY2Lw==">Git 最佳实践：分支管理<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9taXJyb3JzLmVkZ2Uua2VybmVsLm9yZy9wdWIvc29mdHdhcmUvc2NtL2dpdC9kb2NzL2dpdC1jb25maWcuaHRtbA==">git-config(1) Manual Page<i class="fa fa-external-link-alt"></i></span></li></ol></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/64642.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/64642.html class=post-title-link itemprop=url>arm交叉编译工具</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-09-17 23:07:24" itemprop="dateCreated datePublished" datetime=2016-09-17T23:07:24+08:00>2016-09-17</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7/" itemprop=url rel=index><span itemprop=name>编译工具</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7/arm/" itemprop=url rel=index><span itemprop=name>arm</span></a></span></span> <span id=/post/64642.html class="post-meta-item leancloud_visitors" data-flag-title=arm交叉编译工具 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>1.2k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=编译工具命名规则><a href=#编译工具命名规则 class=headerlink title=编译工具命名规则></a>编译工具命名规则</h2><blockquote><p>交叉编译工具链的命名规则为：arch [-vendor] [-os] [-(gnu)eabi]</p></blockquote><ul><li>arch - 体系架构，如ARM，MIPS</li><li>vendor - 工具链提供商</li><li>os - 目标操作系统</li><li>eabi - 嵌入式应用二进制接口（Embedded Application Binary Interface）</li></ul><p>根据对操作系统的支持与否，ARM GCC可分为支持和不支持操作系统，如</p><h3 id=arm-none-eabi：><a href=#arm-none-eabi： class=headerlink title=arm-none-eabi：></a>arm-none-eabi：</h3><p>这个是没有操作系统的，自然不可能支持那些跟操作系统关系密切的函数，比如fork(2)。他使用的是newlib这个专用于嵌入式系统的C库。<br>arm-none-linux-eabi：用于Linux的，使用Glibc</p><h2 id=示例><a href=#示例 class=headerlink title=示例></a>示例</h2><h3 id=arm-none-eabi-gcc><a href=#arm-none-eabi-gcc class=headerlink title=arm-none-eabi-gcc></a>arm-none-eabi-gcc</h3><p>（ARM architecture，no vendor，not target an operating system，complies with the ARM EABI）<br>用于编译 ARM 架构的裸机系统（包括 ARM Linux 的 boot、kernel，不适用编译 Linux 应用 Application），一般适合 ARM7、Cortex-M 和 Cortex-R 内核的芯片使用，所以不支持那些跟操作系统关系密切的函数，比如fork(2)，他使用的是 newlib 这个专用于嵌入式系统的C库。</p><h3 id=arm-none-linux-gnueabi-gcc><a href=#arm-none-linux-gnueabi-gcc class=headerlink title=arm-none-linux-gnueabi-gcc></a>arm-none-linux-gnueabi-gcc</h3><p>(ARM architecture, no vendor, creates binaries that run on the Linux operating system, and uses the GNU EABI)<br>主要用于基于ARM架构的Linux系统，可用于编译 ARM 架构的 u-boot、Linux内核、linux应用等。arm-none-linux-gnueabi基于GCC，使用Glibc库，经过 Codesourcery 公司优化过推出的编译器。arm-none-linux-gnueabi-xxx 交叉编译工具的浮点运算非常优秀。一般ARM9、ARM11、Cortex-A 内核，带有 Linux 操作系统的会用到。</p><h2 id=下载><a href=#下载 class=headerlink title=下载></a>下载</h2><h3 id=arm-none-eabi-gcc-1><a href=#arm-none-eabi-gcc-1 class=headerlink title=arm-none-eabi-gcc></a>arm-none-eabi-gcc</h3><p>地址：<span class=exturl data-url="aHR0cHM6Ly9sYXVuY2hwYWQubmV0L2djYy1hcm0tZW1iZWRkZWQ=">https://launchpad.net/gcc-arm-embedded<i class="fa fa-external-link-alt"></i></span><br><strong>注</strong>:在a8中使用该编译工具（gcc-arm-none-eabi-5_4-2016q2），编译uboot在uboot启动时，对nand进行初始化无法成功。</p><h3 id=arm-none-linux-gnueabi-gcc-1><a href=#arm-none-linux-gnueabi-gcc-1 class=headerlink title=arm-none-linux-gnueabi-gcc></a>arm-none-linux-gnueabi-gcc</h3><p>Mentor官方下载地址（需要注册，注册之后官方会发送一个下载地址到邮箱里面）<br>地址：<span class=exturl data-url="aHR0cDovL3d3dy5tZW50b3IuY29tL2VtYmVkZGVkLXNvZnR3YXJlL3NvdXJjZXJ5LXRvb2xzL3NvdXJjZXJ5LWNvZGViZW5jaC9ldmFsdWF0aW9ucy8=">http://www.mentor.com/embedded-software/sourcery-tools/sourcery-codebench/evaluations<i class="fa fa-external-link-alt"></i></span><br>网盘下载：<span class=exturl data-url="aHR0cDovL3d3dy52ZXJ5YXJtLmNvbS9hcm0tbm9uZS1saW51eC1nbnVlYWJpLWdjYw==">http://www.veryarm.com/arm-none-linux-gnueabi-gcc<i class="fa fa-external-link-alt"></i></span></p></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/36419.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/36419.html class=post-title-link itemprop=url>Cortex-A8平台实验</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-09-11 23:07:24" itemprop="dateCreated datePublished" datetime=2016-09-11T23:07:24+08:00>2016-09-11</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/Cortex-A8/" itemprop=url rel=index><span itemprop=name>Cortex-A8</span></a></span></span> <span id=/post/36419.html class="post-meta-item leancloud_visitors" data-flag-title=Cortex-A8平台实验 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>14k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>13 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>毕业的时候有把A8板子拿了过来，之前由于没有源程序（光盘丢失找不到资料）对它的开发和实验都一直没有做过，它上面的资源很多不想让它就静静的放着浪费。虽然已经很久没有接触ARM平台了，但是它与MIPS的上层基本原理相似，所以最近想倒腾它，希望可以把linux系统跑起来，也不枉失去它在我手中的价值嘿嘿嘿。在这里简单记录实验的过程和中间的少许思考吧。</p><h1 id=开篇——flag><a href=#开篇——flag class=headerlink title=开篇——flag></a>开篇——flag</h1><h2 id=实验环境：><a href=#实验环境： class=headerlink title=实验环境：></a>实验环境：</h2><ul><li>开发板：Cortex-A8</li><li>开发系统：Linux machine 4.2.0-27-generic #32~14.04.1-Ubuntu SMP</li><li><del>uboot：u-boot-2016-07</del></li><li>uboot：u-boot-v2014.07-rc4</li><li>linux：linux-4.0.9</li><li>文件系统：buildroot<blockquote><p>在实际的操作中可能会有所变动，不断更新 <span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL0VtRGVwVGVhbQ==">DebugCode<i class="fa fa-external-link-alt"></i></span></p></blockquote></li></ul><h2 id=交叉编译工具><a href=#交叉编译工具 class=headerlink title=交叉编译工具></a>交叉编译工具</h2><p>作为嵌入式开发交叉编译工具链是必不可少的，主要是为了在宿主机（PC）上，开发目标机（arm开发板）中可以运行的程序。</p><h3 id=下载><a href=#下载 class=headerlink title=下载></a>下载</h3><p>这里选择<span class=exturl data-url="aHR0cHM6Ly9sYXVuY2hwYWRsaWJyYXJpYW4ubmV0LzI2ODMzMDUwMy9nY2MtYXJtLW5vbmUtZWFiaS01XzQtMjAxNnEyLTIwMTYwNjIyLWxpbnV4LnRhci5iejI=">gcc-arm-none-eabi-5_4-2016q2-20160622-linux.tar.bz2<i class="fa fa-external-link-alt"></i></span></p><h3 id=配置><a href=#配置 class=headerlink title=配置></a>配置</h3><p>由于PC中从在多个交叉编译工具链，这里采用脚本envsetup.sh设置，每进入一个终端需要运行其脚本进行配置，方可使用该编译工具链。</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line><span class="meta prompt_">#</span><span class=language-bash>!/bin/bash</span></span><br><span class=line>MY_PWD=`pwd`</span><br><span class=line></span><br><span class=line>PATH=$PATH:$MY_PWD/gcc-arm-none-eabi-5_4-2016q2/bin</span><br><span class=line>CROSS_COMPILE=arm-none-eabi-</span><br><span class=line></span><br><span class=line>export PATH CROSS_COMPILE</span><br><span class=line></span><br><span class=line>echo $PATH</span><br><span class=line>echo $CROSS_COMPILE</span><br></pre></td></tr></table></figure><p>设置：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>source envsetup.sh</span><br></pre></td></tr></table></figure><h2 id=uboot移植><a href=#uboot移植 class=headerlink title=uboot移植></a>uboot移植</h2><h3 id=编译><a href=#编译 class=headerlink title=编译></a>编译</h3><ol><li>查找Cortex-A8相关的README，进行参考，全局搜索</li></ol><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>grep &quot;Cortex-A8&quot; . -rn</span><br></pre></td></tr></table></figure><p>.&#x2F;doc&#x2F;README.s5pc1xx中有Cortex-A8的相关说明，结合该文档进行最初的编译。</p><p><del>2. 根据README.s5pc1xx的步骤配置编译</del></p><p>将出现以下错误：</p><blockquote><p>lib&#x2F;asm-offsets.c:1:0: error: bad value (armv5) for -march&#x3D; switch</p></blockquote><p>出现这个错误的原因是我们没有为uboot指定交叉编译工具链，它依然用自己默认的gcc进行编译，有怎么会找到armv5呢。</p><p><del>3. 指定交叉编译工具链</del></p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>CROSS_COMPILE=arm-none-eabi-</span><br><span class=line>export CROSS_COMPILE</span><br></pre></td></tr></table></figure><p>为了以后方便使用可将以上两句命令添加到envsetup.sh脚本中。<br>参考：.&#x2F;README — 4963 Building the Software:</p><h4 id=改变uboot版本><a href=#改变uboot版本 class=headerlink title=改变uboot版本></a>改变uboot版本</h4><blockquote><p>最新的uboot采用图形界面的配置方式及增加了设备树的配置，由于对这两方面都不太了解尤其设备树，根据自己比较熟悉的使用方式，选择u-boot-v2014.07-rc4。设备树等uboot可以正常启动后在深入学习添加。</p></blockquote><h4 id=选择默认配置编译><a href=#选择默认配置编译 class=headerlink title=选择默认配置编译></a>选择默认配置编译</h4><ol><li>选择配置</li></ol><p>根据README在boards.cfg选择smdkc100，后续在此基础上进行移植<br>2. 指定编译器</p><p>根据上文（3. 指定交叉编译工具链）即可<br>3. 编译</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>make smdkc100_config</span><br><span class=line>make</span><br></pre></td></tr></table></figure><p>顺利编译通过，接下来将添加spl和uboot</p><h4 id=添加自己配置><a href=#添加自己配置 class=headerlink title=添加自己配置></a>添加自己配置</h4><ol><li><p>添加配置文件s5pv210.h<br>cp include&#x2F;configs&#x2F;smdkc100.h include&#x2F;configs&#x2F;s5pv210.h</p></li><li><p>添加编译配置boards.cfg<br>Active arm armv7 s5pc1xx samsung smdkc100 s5pv210 Winddoing <span class=exturl data-url=bWFpbHRvOiYjeDc3OyYjMTA1OyYjeDZlOyYjMTAwOyYjMTAwOyYjeDZmOyYjeDY5OyYjeDZlOyYjMTAzOyYjeDQwOyYjeDczOyYjMTA1OyYjeDZlOyYjeDYxOyYjeDJlOyYjOTk7JiN4NmU7>&#x77;&#105;&#x6e;&#100;&#100;&#x6f;&#x69;&#x6e;&#103;&#x40;&#x73;&#105;&#x6e;&#x61;&#x2e;&#99;&#x6e;<i class="fa fa-external-link-alt"></i></span></p></li></ol><h3 id=添加SPL阶段><a href=#添加SPL阶段 class=headerlink title=添加SPL阶段></a>添加SPL阶段</h3><p>在uboot中SPL阶段的控制是通过spl&#x2F;Makefile中的CONFIG_SPL_BUILD宏控制</p><h2 id=使用最新的uboot><a href=#使用最新的uboot class=headerlink title=使用最新的uboot></a>使用最新的uboot</h2><h3 id=环境><a href=#环境 class=headerlink title=环境></a>环境</h3><ol><li>指定编译工具链<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>export CROSS_COMPILE</span><br></pre></td></tr></table></figure></li><li>使用相关配置测试工具链<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>$make s5pc210_universal_defconfig</span><br><span class=line>$make -j12</span><br></pre></td></tr></table></figure></li></ol><h3 id=添加自定义配置><a href=#添加自定义配置 class=headerlink title=添加自定义配置></a>添加自定义配置</h3><p>在<code>s5pc210_universal_defconfig</code>配置基础上修改。</p><h4 id=添加配置文件><a href=#添加配置文件 class=headerlink title=添加配置文件></a>添加配置文件</h4><ol><li>拷贝现有相关配置<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>$cp include/configs/s5pc210_universal.h include/configs/s5pc210_a8.h</span><br><span class=line>$cp configs/s5pc210_universal_defconfig configs/s5pc210_a8_defconfig</span><br></pre></td></tr></table></figure>2.添加板级<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>board/samsung/cortex-a8/</span><br><span class=line>configs/s5pc210_a8_defconfig</span><br><span class=line>include/configs/s5pc210_a8.h</span><br></pre></td></tr></table></figure><h4 id=添加SPL><a href=#添加SPL class=headerlink title=添加SPL></a>添加SPL</h4></li></ol><h3 id=错误><a href=#错误 class=headerlink title=错误></a>错误</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>./tools/mkexynosspl  spl/u-boot-spl.bin spl/qt210-spl.bin</span><br><span class=line>make[1]: ./tools/mkexynosspl: Command not found</span><br><span class=line>scripts/Makefile.spl:283: recipe for target &#x27;spl/qt210-spl.bin&#x27; failed</span><br><span class=line>make[1]: *** [spl/qt210-spl.bin] Error 127</span><br><span class=line>Makefile:1508: recipe for target &#x27;spl/u-boot-spl&#x27; failed</span><br><span class=line>make: *** [spl/u-boot-spl] Error 2</span><br></pre></td></tr></table></figure><p>这是个可执行文件是在make时自动增加头信息用的</p><h3 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h3><ul><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2dqaWFudzIxNy9hcnRpY2xlL2RldGFpbHMvNzk5Mzk4ODk=">【u-boot-2016到s5pv210】1.1 自定义板卡ok210<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2tleXVlMTIzL2FydGljbGUvZGV0YWlscy81MzA3MjE2NA==">u-boot-2016.09移植(3)-u-boot-spl.bin<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0NvbmZpZ19pbml0L2FydGljbGUvZGV0YWlscy81MzM3MzQyMw==">u-boot-2016.11移植uboot-spl.bin<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTY1NTc2NS9hcnRpY2xlL2RldGFpbHMvODAwNTg2NDQ=">u-boot v2018.01 启动流程分析<i class="fa fa-external-link-alt"></i></span></li></ul><h2 id=参考-1><a href=#参考-1 class=headerlink title=参考></a>参考</h2><ul><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0plcnJ5R291L2FydGljbGUvZGV0YWlscy83OTAyNzQ3OQ==">S5PV210开发版配置<i class="fa fa-external-link-alt"></i></span></li></ul><h1 id=再续前缘——2022-1-21><a href=#再续前缘——2022-1-21 class=headerlink title=再续前缘——2022.1.21></a>再续前缘——2022.1.21</h1><p>今天已经是在家隔离的第28天了，接着上次在家办公时把uboot基本移植成功后，这两天也把kerel和文件系统都给安排上了，算是完成了这个久违的flag。以上这部分，记录了刚毕业那会对手里拿着的cortex-a8开发版所立的一个flag，想着既然有一个就将最新的uboot和kernel全部跑起来，也是一个锻炼过程，同时如果需要调试内核新的功能也方便，出于这个目的就进行了uboot的移植（记录在上），记得当时spl都没有弄完就不了了之了。这次乘着疫情在家时间比较充足就将其重新进行移植。</p><p>在移植之前给这个工程与开发板起了一个新的名字<code>wdg</code>，其实就是winddoing的简写，主要是为了容易辩识。</p><p>当前状态：</p><ul><li>uboot移植<ul><li>实现uart，时钟，DDR初始化等，最基本功能</li><li>移植LAN9220网卡</li><li>实现tftp加载kernel，及挂载NFS文件系统</li></ul></li><li>kernel移植<ul><li>实现正常启动并进入文件系统</li><li>移植LAN9220网卡驱动</li></ul></li><li>buildroot<ul><li>构建完成可用的最小文件系统</li></ul></li></ul><p>这里主要记录整个调试流程和需要注意的地方，其实也就是我出现错误和比较容易忽略的地方。</p><h2 id=wdg工程环境><a href=#wdg工程环境 class=headerlink title=wdg工程环境></a>wdg工程环境</h2><ul><li>硬件环境：<ul><li>s5pv210开发板（Cortex-A8）</li></ul></li><li>软件环境：<ul><li>开发机：<code>Ubuntu 20.04.3 LTS</code></li><li>交叉编译工具：<code>arm-none-eabi-gcc</code>, sudo apt install gcc-arm-none-eabi</li><li>uboot：<code>v2021.10-rc5</code></li><li>kernel：<code>5.16.0</code></li><li>buildroot: <code>2021.11</code><blockquote><p>uboot、kernel、buildroot均为当时下载<code>master</code>分支代码进行移植操作，目的是为了后续方便更新代码</p></blockquote></li></ul></li></ul><h2 id=基础环境><a href=#基础环境 class=headerlink title=基础环境></a>基础环境</h2><h3 id=编译工具><a href=#编译工具 class=headerlink title=编译工具></a>编译工具</h3><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>sudo apt install gcc-arm-none-eabi</span><br></pre></td></tr></table></figure><blockquote><p>编译应用：arm-none-eabi-gcc –specs&#x3D;nosys.specs $(OTHER_LINK_OPTIONS)</p><p>如：arm-none-eabi-gcc –specs&#x3D;nosys.specs a.c</p></blockquote><h3 id=硬件电路——调试><a href=#硬件电路——调试 class=headerlink title=硬件电路——调试></a>硬件电路——调试</h3><h4 id=串口><a href=#串口 class=headerlink title=串口></a>串口</h4><p>默认使用最边上的串口，为COM1，j7</p><p><img data-src=/images/2022/01/s5pv210_wdg_uart_debug.png alt=s5pv210_wdg_uart_debug></p><h4 id=LED><a href=#LED class=headerlink title=LED></a>LED</h4><p>在开发板上有四个led灯，为了方便调试uboot与spl的启动，将其作为指示灯用</p><p><img data-src=/images/2022/01/s5pv210_wdg_led_debug.png alt=s5pv210_wdg_led_debug></p><p>uboot中接口函数<code>wdg_led_status()</code>,可以直接设置状态值<code>1~15</code></p><h2 id=裸板测试><a href=#裸板测试 class=headerlink title=裸板测试></a>裸板测试</h2><p>裸板测试主要调试uart和led，为spl启动流程调试做准备。</p><p><img data-src=/images/2022/01/s5pv210_boot_diagram.png alt=s5pv210_boot_diagram></p><p><code>BL1</code>区域最大大小为16KByte，因此启动阶段BL1代码大小不能超过16KByte，也就是裸板测试程序不能超过16KByte，（uboot spl阶段大小也不能超过16KByte）</p><p>BL1区域数据格式：<code>Header</code>+<code>Data</code></p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br></pre></td><td class=code><pre><span class=line>   ----+------------------------+-----------&gt;+------------------------------+</span><br><span class=line>    ^  |                        |            |BL1 size unit:byte(User Write)|</span><br><span class=line>    |  |   BL1 Header(16byte)   |            +------------------------------+</span><br><span class=line>    |  |                        |            |Reserved(should be 0)         |</span><br><span class=line>    |  +------------------------+-----+      +------------------------------+</span><br><span class=line>    |  |                        | ^   |      |CheckSum(User write)          |</span><br><span class=line>    |  |                        | |   |      +------------------------------+</span><br><span class=line>    |  |                        | |   |      |Reserved(should be 0)         |</span><br><span class=line>    |  |                        | |   +-----&gt;+------------------------------+</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |      BL1 binary        | |</span><br><span class=line>BL1 size                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        |CheckSum</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    |  |                        | |</span><br><span class=line>    v  |                        | v</span><br><span class=line>   ----+------------------------+----</span><br></pre></td></tr></table></figure><p>裸板测试程序编译生成后，需要根据以上格式进行处理生成新的bin文件，这个bin文件写入SD卡启动时才会被识别运行，否则会触发蜂鸣器报警。</p><p>BL1阶段bin格式处理流程：</p><ol><li>添加<code>16Byte</code>的头部信息</li><li>计算BL1阶段程序bin文件的实际大小，并填入头部第一个word</li><li>计算BL1阶段程序bin文件的校验和，它通过对所有字节求和来计算，并填入头部第三个word</li><li>生成新的BL1阶段执行程序BIN</li></ol><p>将最终生成的BIN写入SD卡的第1个扇区，启动测试。</p><figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>sudo dd if=BIN of=/dev/sdb bs=512 seek=1</span><br></pre></td></tr></table></figure><h2 id=uboot移植-1><a href=#uboot移植-1 class=headerlink title=uboot移植></a>uboot移植</h2><h3 id=添加wdg板级><a href=#添加wdg板级 class=headerlink title=添加wdg板级></a>添加wdg板级</h3><p>为了后续添加各种配置并不影响后续代码的更新，需要添加一份自定义板级，这里主要参考uboot源码中的<code>goni</code>，以其为模板进行拷贝。</p><ul><li><p>添加设备树</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp arch/arm/dts/s5pc1xx-goni.dts arch/arm/dts/s5pc1xx-wdg.dts</span><br></pre></td></tr></table></figure></li><li><p>添加配置文件</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp configs/s5p_goni_defconfig  configs/s5p_wdg_defconfig</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp include/configs/s5p_goni.h  include/configs/s5p_wdg.h</span><br></pre></td></tr></table></figure></li><li><p>添加板级目录</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp board/samsung/goni board/samsung/wdg</span><br></pre></td></tr></table></figure><blockquote><p>拷贝完板级目录后，修改相应的文件名及makefile文件，并且将设备树和配置文件中的可能无用的模块进行<code>删减</code>，后续如果需要可以不断添加</p></blockquote></li></ul><p>注：根据自定义板级名，修改相应的Makefile及Kconfig文件中的相关配置</p><h3 id=添加SPL阶段-1><a href=#添加SPL阶段-1 class=headerlink title=添加SPL阶段></a>添加SPL阶段</h3><p>在s5pv210的启动流程中由于BL1阶段可利用的SRAM空间有限（最大只有16KB），这样就无法直接使用uboot进行启动，这样uboot将分为两部分启动，一部分SPL，主要为初始化DDR（以小的SRAM空间，换大的内存空间）；第二部分uboot，一般意义上的uboot，初始化各种外设，并加载引导kernel启动。</p><blockquote><p>SPL阶段，其实就是BL1阶段，主要的目的就是初始化DDR，将uboot拷贝到DDR中并进入下一阶段。</p></blockquote><p>使能SPL，使uboot编译后生成两部分。</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>diff --git a/arch/arm/mach-s5pc1xx/Kconfig b/arch/arm/mach-s5pc1xx/Kconfig</span><br><span class=line>index b9e620e885..2b973d0633 100644</span><br><span class=line>--- a/arch/arm/mach-s5pc1xx/Kconfig</span><br><span class=line>+++ b/arch/arm/mach-s5pc1xx/Kconfig</span><br><span class=line>@@ -15,6 +15,7 @@ config TARGET_S5P_WDG</span><br><span class=line>        select OF_CONTROL</span><br><span class=line>        select BLK</span><br><span class=line>        select DM_MMC</span><br><span class=line>+       select SUPPORT_SPL</span><br></pre></td></tr></table></figure><p>在配置完成后，直接编译测试，正常情况下可以生成u-boot-spl.bin,但是该bin文件无法直接启动测试，跟裸板程序一样需要进一步处理，也就是加头部信息。</p><p>这部分处理工作在uboot存在有成的工具，但是无法直接使用，需要针对s5pv210进行调整</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br></pre></td><td class=code><pre><span class=line>diff --git a/tools/Makefile b/tools/Makefile</span><br><span class=line>index 4a86321f64..b2f1a75138 100644</span><br><span class=line>--- a/tools/Makefile</span><br><span class=line>+++ b/tools/Makefile</span><br><span class=line>@@ -193,6 +193,7 @@ HOSTLDLIBS_fit_check_sign := $(HOSTLDLIBS_mkimage)</span><br><span class=line></span><br><span class=line> hostprogs-$(CONFIG_EXYNOS5250) += mkexynosspl</span><br><span class=line> hostprogs-$(CONFIG_EXYNOS5420) += mkexynosspl</span><br><span class=line>+hostprogs-$(CONFIG_S5PC110) += mkexynosspl</span><br><span class=line> HOSTCFLAGS_mkexynosspl.o := -pedantic</span><br><span class=line></span><br><span class=line> ifdtool-objs := $(LIBFDT_OBJS) ifdtool.o</span><br><span class=line>diff --git a/tools/mkexynosspl.c b/tools/mkexynosspl.c</span><br><span class=line>index 53122b8614..a9be388e19 100644</span><br><span class=line>--- a/tools/mkexynosspl.c</span><br><span class=line>+++ b/tools/mkexynosspl.c</span><br><span class=line>@@ -11,6 +11,7 @@</span><br><span class=line> #include &lt;string.h&gt;</span><br><span class=line> #include &lt;sys/stat.h&gt;</span><br><span class=line> #include &lt;compiler.h&gt;</span><br><span class=line>+#include &lt;generated/autoconf.h&gt;</span><br><span class=line></span><br><span class=line> #define CHECKSUM_OFFSET                (14*1024-4)</span><br><span class=line> #define FILE_PERM              (S_IRUSR | S_IWUSR | S_IRGRP \</span><br><span class=line>@@ -28,11 +29,21 @@</span><br><span class=line>  * blob [i.e size - sizeof(struct var_size_header) bytes], calculates the</span><br><span class=line>  * checksum and compares it with value read from the header.</span><br><span class=line>  */</span><br><span class=line>+#ifdef CONFIG_ARCH_S5PC1XX</span><br><span class=line>+//BL1 Header (16byte) for s5pv210</span><br><span class=line>+struct var_size_header &#123;</span><br><span class=line>+       uint32_t spl_size;</span><br><span class=line>+       uint32_t reserved;</span><br><span class=line>+       uint32_t spl_checksum;</span><br><span class=line>+       uint32_t reserved1;</span><br><span class=line>+&#125;;</span><br><span class=line>+#else</span><br><span class=line> struct var_size_header &#123;</span><br><span class=line>        uint32_t spl_size;</span><br><span class=line>        uint32_t spl_checksum;</span><br><span class=line>        uint32_t reserved[2];</span><br><span class=line> &#125;;</span><br><span class=line>+#endif</span><br></pre></td></tr></table></figure><p>这样处理后将生成wdg-spl.bin，这个是可以烧录到SD卡进行测试的，这样虽然可以启动，并且蜂鸣器也没有报警，但是不幸的是串口也不会有任何输入打印（可能有些板级完全相同的，这样处理后在<code>spl阶段</code>输出少量打印的吧）。因为时钟与串口可能都没有正常初始化，无法通过输出打印确定spl运行的流程以及卡死的位置。</p><p>在进入这一步后，就需要引入新的调试手段，这里有两种，一种串口输出，直接通过汇编指令往串口的TX地址写数据，使其串口输出；另一种是点亮LED指示灯，同样使用汇编指令点亮LED灯。</p><p>这两种方式在裸板测试阶段，均以测试完成。这里我选择使用点亮LED灯，更直观方便。在uboot中将点亮LED灯，封装成一个接口函数<code>wdg_led_status</code>，入参为<code>1~15</code>数值，LED灯会根据相应的值被一次点亮。</p><p>下一步就是追踪<code>Crotex-a8</code>在SPL中的启动流程，在可能卡住或不确定的地方添加<code>wdg_led_status</code>，判断实际流程是否执行到此处，进行相关代码的调试。</p><p>这里简单记录一下，调试流程，细节东西可以直接看代码。</p><h3 id=uart与ddr初始化><a href=#uart与ddr初始化 class=headerlink title=uart与ddr初始化></a>uart与ddr初始化</h3><p>在spl阶段uart和ddr的初始化是最关键的，这部分调试消耗的时间最长，主要是ddr老初始化不成功。最后直接将uplooking提供的uboot中ddr初始化部分全部移植过来，才完成ddr初始化。当时在这个阶段感觉又进行不下去了，主要是DDR这块不熟悉也没有相关的文档。</p><h3 id=移植LAN9220网卡驱动><a href=#移植LAN9220网卡驱动 class=headerlink title=移植LAN9220网卡驱动></a>移植LAN9220网卡驱动</h3><p>网卡移植比较简单在设备中添加，lan9220网卡设备并配置相关参数，由于该网卡是内部集成PHY，因此相对更简单不需要考虑相关PHY的操作。</p><p>注意点：<code>总线位宽</code>、<code>时钟</code></p><ul><li>总线位宽：lan9220是16bit地址宽度，因此需要配置成16bit，默认好像是32bit。</li><li>时钟：lan9220接在SROM bank3上，因此需要配置相关时钟，这部分也是从旧uboot中移植。</li></ul><h3 id=命令行参数><a href=#命令行参数 class=headerlink title=命令行参数></a>命令行参数</h3><p>命令行参数这部分主要是针对kernel而已，目前为了使用方便主要配置tftp boot与NFS文件系统</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br></pre></td><td class=code><pre><span class=line>#define CONFIG_BOOTCOMMAND  &quot;run tftpboot&quot;</span><br><span class=line></span><br><span class=line>#define CONFIG_RAMDISK_BOOT &quot;root=/dev/ram0 rw $&#123;console&#125;&quot;</span><br><span class=line></span><br><span class=line>#define CONFIG_COMMON_BOOT  &quot;$&#123;console&#125;&quot;</span><br><span class=line></span><br><span class=line>#define CONFIG_MISC_COMMON</span><br><span class=line></span><br><span class=line>#define CONFIG_EXTRA_ENV_SETTINGS                   \</span><br><span class=line>    &quot;tftpboot=&quot; \</span><br><span class=line>        &quot;setenv bootargs root=/dev/nfs rw &quot; \</span><br><span class=line>        &quot;nfsroot=192.168.2.2:/home/wqshao/nfs/rootfs,tcp,nfsvers=3,nolock &quot; \</span><br><span class=line>        &quot;ip=192.168.2.3:192.168.2.2:192.168.2.1:255.255.255.0 ::eth0:off &quot; \</span><br><span class=line>        CONFIG_COMMON_BOOT \</span><br><span class=line>        &quot;;tftp 40000000 s5pv210-wdg.dtb; tftpboot 20008000 zImage; &quot;\</span><br><span class=line>        &quot;fdt addr 40000000; bootz 20008000 - 40000000\0&quot; \</span><br><span class=line>    &quot;ramboot=&quot; \</span><br><span class=line>        &quot;set bootargs &quot; CONFIG_RAMDISK_BOOT \</span><br><span class=line>        &quot;initrd=0x33000000,8M ramdisk=8192 &quot; \</span><br><span class=line>        &quot;;tftp 40000000 s5pv210-wdg.dtb; tftpboot 20008000 zImage; &quot;\</span><br><span class=line>        &quot;fdt addr 40000000; bootz 20008000 - 40000000\0&quot; \</span><br><span class=line>    &quot;mmcboot=&quot; \</span><br><span class=line>        &quot;set bootargs root=/dev/mmcblk$&#123;mmcdev&#125;p$&#123;mmcrootpart&#125; &quot; \</span><br><span class=line>        &quot;rootfstype=$&#123;rootfstype&#125; $&#123;opts&#125; $&#123;lcdinfo&#125; &quot; \</span><br><span class=line>        CONFIG_COMMON_BOOT &quot;; run bootk\0&quot; \</span><br><span class=line>    &quot;boottrace=setenv opts initcall_debug; run bootcmd\0&quot; \</span><br><span class=line>    &quot;bootchart=set opts init=/sbin/bootchartd; run bootcmd\0&quot; \</span><br><span class=line>    &quot;verify=n\0&quot; \</span><br><span class=line>    &quot;rootfstype=ext4\0&quot; \</span><br><span class=line>    &quot;console=console=ttySAC0,115200n8 earlyprintk\0&quot; \</span><br><span class=line>    &quot;loaduimage=ext4load mmc $&#123;mmcdev&#125;:$&#123;mmcbootpart&#125; 0x30007FC0 uImage\0&quot; \</span><br><span class=line>    &quot;mmcdev=0\0&quot; \</span><br><span class=line>    &quot;mmcbootpart=2\0&quot; \</span><br><span class=line>    &quot;mmcrootpart=5\0&quot; \</span><br><span class=line>    &quot;partitions=&quot; PARTS_DEFAULT \</span><br><span class=line>    &quot;opts=always_resume=1\0&quot; \</span><br><span class=line>    &quot;dfu_alt_info=&quot; CONFIG_DFU_ALT &quot;\0&quot;</span><br></pre></td></tr></table></figure><p><strong>注意点</strong>:</p><ul><li>串口打印输出，在进入内核后打印内核调试信息，必须在<code>console</code>项添加<code>earlyprintk</code>，否则严重影响内核调试，在内核卡死的时候不输出任何信息无法定位</li><li>tftpboot需要适应zimage和dtb，在bootz参数后需要添加kernel和dtb加载到内存中的地址</li><li>nfs文件系统，在挂载nfs文件系统时，出现卡住无法挂载的情况，根本原因是uboot中默认支持的nfs协议版本为<code>2</code>,但是开发机中搭建的NFS server支持的nfs协议版本为<code>3</code>和<code>4</code>。由于协议版本不匹配导致无法正常挂载文件系统，因此需要在<code>nfsroot</code>参数后添加<code>nfsvers=3</code></li></ul><h3 id=uboot与kernel的机器码匹配><a href=#uboot与kernel的机器码匹配 class=headerlink title=uboot与kernel的机器码匹配></a>uboot与kernel的机器码匹配</h3><p>在kernel启动中出现以下错误：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line>Error: invalid dtb and unrecognized/unsupported machine ID</span><br><span class=line>  r1=0x00000b2e, r2=0x20000100</span><br><span class=line>  r2[]=05 00 00 00 01 00 41 54 00 00 00 00 00 00 00 00</span><br><span class=line>Available machine support:</span><br><span class=line></span><br><span class=line>ID (hex)        NAME</span><br><span class=line>ffffffff        Generic DT based system</span><br><span class=line>ffffffff        Samsung S5PC110/S5PV210-based board</span><br><span class=line></span><br><span class=line>Please check your kernel config and/or bootloader.</span><br></pre></td></tr></table></figure><blockquote><p>该错误就是uboot传入的与内核中的machine ID不一致无法启动的。</p></blockquote><p>uboot中传递的ID是<code>r1=0x00000b2e</code>，由<code>bi_arch_number</code>字段配置，但是内核不支持，而内核支持的ID是<code>ffffffff</code>, 因此解决方法有两种，一种是修改内核ID为uboot传递的，另一种是修改uboot传递的ID为全f</p><p>这里选择后者，在uboot板级文件中修改<code>bi_arch_number = 0xffffffff</code></p><p>bi_arch_number配置值在uboot中可以通过<code>bdinfo</code>获取</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>wdg # bdinfo</span><br><span class=line>bd address  = 0x3fe93fa0</span><br><span class=line>boot_params = 0x20000100</span><br><span class=line>   ...</span><br><span class=line>arch_number = 0x00000b2e    &lt;ID&gt;</span><br><span class=line>TLB addr    = 0x3fff0000</span><br><span class=line>irq_sp      = 0x3fe930f0</span><br><span class=line>sp start    = 0x3fe930e0</span><br><span class=line>Early malloc usage: 100 / 400</span><br></pre></td></tr></table></figure><h2 id=kernel移植><a href=#kernel移植 class=headerlink title=kernel移植></a>kernel移植</h2><h3 id=添加wdg配置文件><a href=#添加wdg配置文件 class=headerlink title=添加wdg配置文件></a>添加wdg配置文件</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp arch/arm/configs/s5pv210_defconfig arch/arm/configs/s5pv210_wdg_defconfig</span><br></pre></td></tr></table></figure><h3 id=添加wdg设备树><a href=#添加wdg设备树 class=headerlink title=添加wdg设备树></a>添加wdg设备树</h3><p>内核中同样选择<code>smdkv210</code>的设备树配置文件为模板进行配置。</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp arch/arm/boot/dts/s5pv210-smdkv210.dts  arch/arm/boot/dts/s5pv210-wdg.dts</span><br></pre></td></tr></table></figure><p>将<code>s5pv210-wdg.dts</code>中可能多余的配置项删减，并修改相应的Makefile和Kconfig。</p><h3 id=内核配置——默认调试输出串口><a href=#内核配置——默认调试输出串口 class=headerlink title=内核配置——默认调试输出串口></a>内核配置——默认调试输出串口</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line>Kernel hacking  ---&gt;</span><br><span class=line>    arm Debugging  ---&gt;</span><br><span class=line>        [*] Kernel low-level debugging functions (read help!)</span><br><span class=line>              Kernel low-level debugging port (Use Samsung S3C UART 0 for low-level debug)  ---&gt;</span><br><span class=line>        [*] Early printk</span><br></pre></td></tr></table></figure><h3 id=调整时钟><a href=#调整时钟 class=headerlink title=调整时钟></a>调整时钟</h3><p>经过以上步骤编译完成的zImage，在启动时会卡死出错，如下</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br></pre></td><td class=code><pre><span class=line>[    0.000000] S5PV210 clocks: mout_apll = 0, mout_mpll = 0</span><br><span class=line>[    0.000000]  mout_epll = 0, mout_vpll = 0</span><br><span class=line>[    0.000000] Division by zero in kernel.</span><br><span class=line>[    0.000000] CPU: 0 PID: 0 Comm: swapper Not tainted 5.16.0-11061-g6c325cf02a71 #15</span><br><span class=line>[    0.000000] Hardware name: Samsung S5PC110/S5PV210-based board</span><br><span class=line>[    0.000000]  unwind_backtrace from show_stack+0x10/0x14</span><br><span class=line>[    0.000000]  show_stack from Ldiv0+0x8/0x10</span><br><span class=line>[    0.000000]  Ldiv0 from clockevents_config.part.0+0x18/0x74</span><br><span class=line>[    0.000000]  clockevents_config.part.0 from clockevents_config_and_register+0x20/0x2c</span><br><span class=line>[    0.000000]  clockevents_config_and_register from _samsung_pwm_clocksource_init+0x150/0x2a0</span><br><span class=line>[    0.000000]  _samsung_pwm_clocksource_init from samsung_pwm_alloc+0x144/0x190</span><br><span class=line>[    0.000000]  samsung_pwm_alloc from timer_probe+0x74/0xec</span><br><span class=line>[    0.000000]  timer_probe from start_kernel+0x4b4/0x620</span><br><span class=line>[    0.000000]  start_kernel from 0x0</span><br><span class=line>[    0.000000] ------------[ cut here ]------------</span><br><span class=line>[    0.000000] WARNING: CPU: 0 PID: 0 at kernel/time/clockevents.c:38 cev_delta2ns+0x148/0x170</span><br><span class=line>[    0.000000] Modules linked in:</span><br><span class=line>[    0.000000] CPU: 0 PID: 0 Comm: swapper Not tainted 5.16.0-11061-g6c325cf02a71 #15</span><br><span class=line>[    0.000000] Hardware name: Samsung S5PC110/S5PV210-based board</span><br><span class=line>[    0.000000]  unwind_backtrace from show_stack+0x10/0x14</span><br><span class=line>[    0.000000]  show_stack from __warn+0xd4/0xec</span><br><span class=line>[    0.000000]  __warn from warn_slowpath_fmt+0x64/0xc8</span><br><span class=line>[    0.000000]  warn_slowpath_fmt from cev_delta2ns+0x148/0x170</span><br><span class=line>[    0.000000]  cev_delta2ns from clockevents_config.part.0+0x54/0x74</span><br><span class=line>[    0.000000]  clockevents_config.part.0 from clockevents_config_and_register+0x20/0x2c</span><br><span class=line>[    0.000000]  clockevents_config_and_register from _samsung_pwm_clocksource_init+0x150/0x2a0</span><br><span class=line>[    0.000000]  _samsung_pwm_clocksource_init from samsung_pwm_alloc+0x144/0x190</span><br><span class=line>[    0.000000]  samsung_pwm_alloc from timer_probe+0x74/0xec</span><br><span class=line>[    0.000000]  timer_probe from start_kernel+0x4b4/0x620</span><br><span class=line>[    0.000000]  start_kernel from 0x0</span><br></pre></td></tr></table></figure><p>这个错误主要是<code>xxti</code>时钟没有配置，因此需要在设备树中添加<code>xxti</code>的时钟配置</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line>+++ b/arch/arm/boot/dts/s5pv210-wdg.dts</span><br><span class=line>@@ -58,6 +58,10 @@ backlight &#123;</span><br><span class=line>        &#125;;</span><br><span class=line> &#125;;</span><br><span class=line></span><br><span class=line>+&amp;xxti &#123;</span><br><span class=line>+       clock-frequency = &lt;24000000&gt;;</span><br><span class=line>+&#125;;</span><br><span class=line>+</span><br><span class=line> &amp;xusbxti &#123;</span><br><span class=line>        clock-frequency = &lt;24000000&gt;;</span><br><span class=line> &#125;;</span><br></pre></td></tr></table></figure><h3 id=使用Ramdisk文件系统><a href=#使用Ramdisk文件系统 class=headerlink title=使用Ramdisk文件系统></a>使用Ramdisk文件系统</h3><p>到这一步内核基本完成需要挂载文件系统，这里使用最方便的文件系统ramdisk，文件系统格式<code>cpio</code></p><p>内核配置ramdisk文件系统路径：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>General setup  ---&gt;</span><br><span class=line>    [*] Initial RAM filesystem and RAM disk (initramfs/initrd) support</span><br><span class=line>    (/home/xxx/rootfs.cpio) Initramfs source file(s)</span><br></pre></td></tr></table></figure><p>这样在uboot中选择<code>ramboot</code>进行启动，系统就可以正常启动进入文件系统</p><p><code>ramboot</code>启动操作方式：重启系统回车进入uboot命令行中，执行<code>run ramboot</code></p><h3 id=调试LAN9220网卡驱动><a href=#调试LAN9220网卡驱动 class=headerlink title=调试LAN9220网卡驱动></a>调试LAN9220网卡驱动</h3><p>由于ramdisk文件系统的使用没有NFS文件系统方便，因此添加网卡驱动为后续挂载NFS文件系统做准备。</p><p>在设备树中添加lan9220设备，参考<code>Documentation/devicetree/bindings/net/smsc,lan9115.yaml</code></p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line>ethernet@a8000000 &#123;</span><br><span class=line>    compatible = &quot;smsc,lan9115&quot;;</span><br><span class=line>    reg = &lt;0xA8000000 0x10000&gt;;</span><br><span class=line>    phy-mode = &quot;mii&quot;;</span><br><span class=line>    interrupt-parent = &lt;&amp;gph1&gt;;</span><br><span class=line>    interrupts = &lt;1 IRQ_TYPE_LEVEL_LOW&gt;;</span><br><span class=line>    clocks = &lt;&amp;clocks CLK_SROMC&gt;;</span><br><span class=line>    local-mac-address = [00 00 de ad be ef];</span><br><span class=line>    reg-io-width = &lt;2&gt;;</span><br><span class=line>    smsc,force-internal-phy;</span><br><span class=line>    smsc,irq-push-pull;</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p>注意点与uboot中一样，<code>总线位宽</code>与<code>时钟</code>,在内核中时钟可以直接通过添加<code>clocks = &lt;&amp;clocks CLK_SROMC&gt;;</code>开启，如果不添加时钟，网卡驱动进行loop测试时会失败。</p><h3 id=添加NFS文件系统><a href=#添加NFS文件系统 class=headerlink title=添加NFS文件系统></a>添加NFS文件系统</h3><p>NFS文件系统，在内核中需要开启NFS client，启动参考uboot命令行中的tftpboot</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line>File systems  ---&gt;</span><br><span class=line>    [*] Network File Systems  ---&gt;</span><br><span class=line>        &lt;*&gt;   NFS client support</span><br><span class=line>        &lt;*&gt;     NFS client support for NFS version 2</span><br><span class=line>        &lt;*&gt;     NFS client support for NFS version 3</span><br><span class=line>        [ ]       NFS client support for the NFSv3 ACL protocol extension</span><br><span class=line>        &lt; &gt;     NFS client support for NFS version 4</span><br><span class=line>        [ ]     Provide swap over NFS support</span><br><span class=line>        [*]   Root file system on NFS</span><br><span class=line>        [*]   NFS: Disable NFS UDP protocol support</span><br></pre></td></tr></table></figure><h2 id=文件系统构建><a href=#文件系统构建 class=headerlink title=文件系统构建></a>文件系统构建</h2><p>通过buildroot构建最小的文件系统，后续根据实际需求逐步添加。</p><h3 id=添加wdg配置><a href=#添加wdg配置 class=headerlink title=添加wdg配置></a>添加wdg配置</h3><p>在<code>configs</code>目录下搜索存在<code>cortex_a8</code>的配置文件，随便选择一个.&#x2F;mx51evk_defconfig为例，拷贝一份添加自己的配置</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>cp configs/mx51evk_defconfig configs/s5pv210_wdg_defconfig</span><br></pre></td></tr></table></figure><h3 id=调整配置——只编译文件系统><a href=#调整配置——只编译文件系统 class=headerlink title=调整配置——只编译文件系统></a>调整配置——只编译文件系统</h3><ol><li>关闭uboot和kernel的编译配置</li><li>指定包的下载目录为<code>BR2_DL_DIR=&quot;$(TOPDIR)/../downloads&quot;</code>，方便使用单独的库进行保存</li><li>删除多余无用配置项</li><li>配置串口设备名<code>BR2_TARGET_GENERIC_GETTY_PORT=&quot;ttySAC0&quot;</code></li><li>配置ramdisk文件系统格式<code>ROOTFS_CPIO</code></li><li><del>配置shell为bash</del>，后续根据实际需求确定是否修改，改为bash，文件系统比之前大1.2M将近一倍</li></ol><h2 id=参考-2><a href=#参考-2 class=headerlink title=参考></a>参考</h2><ul><li><span class=exturl data-url="aHR0cHM6Ly93aW5kZG9pbmcuY29kaW5nLm5ldC9wL3M1cHYyMTAvZC9kb2NzL2dpdC9yYXcvbWFzdGVyL2RhdGFzaGVldC9TNVBWMjEwX2lST01fQXBwbGljYXRpb25Ob3RlX1ByZWxpbWluYXJ5XzIwMDkxMTI2LnBkZg==">S5PV210_iROM_ApplicationNote_Preliminary_20091126.pdf<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpdWppYTIxMDAvYXJ0aWNsZS9kZXRhaWxzLzg2ODg2NTc=">linux-3.4.2 smsc911x 网卡移植<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpYW9qaWFvaHVhemkvYXJ0aWNsZS9kZXRhaWxzLzgyODUwNTQ/c3BtPTEwMDEuMjAxNC4zMDAxLjU1MDI=">s5pv210 uboot-2012-10移植(五) 之支持LAN9220网卡<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhbnhpYW9odWFhL2FydGljbGUvZGV0YWlscy8xMDU0MjA2Njk=">S5PV210 Linux内核移植 - 天嵌E8<i class="fa fa-external-link-alt"></i></span></li></ul></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/9636.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/9636.html class=post-title-link itemprop=url>【转】python练习项目</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-09-10 23:07:24" itemprop="dateCreated datePublished" datetime=2016-09-10T23:07:24+08:00>2016-09-10</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/Python/" itemprop=url rel=index><span itemprop=name>Python</span></a></span></span> <span id=/post/9636.html class="post-meta-item leancloud_visitors" data-flag-title=【转】python练习项目 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>2.4k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>转载再次，自己实现练习python<br>本书链接 <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9ibG9nLw==">http://aosabook.org/blog/<i class="fa fa-external-link-alt"></i></span><br>目录页：<span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9ibG9nLw==">http://aosabook.org/blog/<i class="fa fa-external-link-alt"></i></span><br>以下是章节目录，每一章都让你热血澎湃，看完介绍你就向往下读。</p><ol><li>A Template Engine （<span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtdGVtcGxhdGUtZW5naW5lLmh0bWwlRUYlQkMlODk=">http://aosabook.org/en/500L/a-template-engine.html）<i class="fa fa-external-link-alt"></i></span><br>MVC模型中的view层如何解析html中的静态变量和简单的语句，如下：</li></ol><p>Welcome, {name}!</p><p>Products:</p><ul>{products}</ul><p>web中的view层不只是html代码，还有支持其他的代码。比如 {products}是一个变量。 同时view层还支持{if} , {for}, {foreach}等等。django，velocity等是如何解析他们的？<br>大牛用不到500行代码告诉你，是如何实现的？ （不是替换，替换需要每次请求都需要解析）</p><ol start=2><li><p>Web Spreadsheet （<span class=exturl data-url=aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML3dlYi1zcHJlYWRzaGVldC5odG1sJUVGJUJDJTg5>http://aosabook.org/en/500L/web-spreadsheet.html）<i class="fa fa-external-link-alt"></i></span><br>web的电子表格如何实现的？ 好像比较简单，但是介绍了 web storage 和 web worker，还是很值得一看的</p></li><li><p>A Web Crawler <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2Etd2ViLWNyYXdsZXItd2l0aC1hc3luY2lvLWNvcm91dGluZXMuaHRtbA==">http://aosabook.org/en/500L/a-web-crawler-with-asyncio-coroutines.html<i class="fa fa-external-link-alt"></i></span><br>不多说，几百行代码实现高效的网络爬虫， 高效！</p></li><li><p>Static Analysis <span class=exturl data-url=aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML3N0YXRpYy1hbmFseXNpcy5odG1s>http://aosabook.org/en/500L/static-analysis.html<i class="fa fa-external-link-alt"></i></span><br>成熟的IDE都有代码检查和代码提示，怎么做的？ 看这章</p></li><li><p>Clustering by Consensus <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2NsdXN0ZXJpbmctYnktY29uc2Vuc3VzLmh0bWw=">http://aosabook.org/en/500L/clustering-by-consensus.html<i class="fa fa-external-link-alt"></i></span><br>分布式系统 paxos原理与实现。不知道paxos说明你没接触过分布式体统，接触过分布式还不懂，说明你只会用分布式系统</p></li><li><p>A Simple Object Modle <span class=exturl data-url=aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2Etc2ltcGxlLW9iamVjdC1tb2RlbC5odG1s>http://aosabook.org/en/500L/a-simple-object-model.html<i class="fa fa-external-link-alt"></i></span><br>Python是面向对象语言，对象，继承，多态，怎么用代码实现的，不到500行代码，实际不到400 行， 666.。。</p></li><li><p>An Archaeology-Inspired Database <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2FuLWFyY2hhZW9sb2d5LWluc3BpcmVkLWRhdGFiYXNlLmh0bWw=">http://aosabook.org/en/500L/an-archaeology-inspired-database.html<i class="fa fa-external-link-alt"></i></span><br>如何用python实现一个数据库，支持 query，index, transaction， 2，3百行代码和对每个函数的讲解。看完你就知道知道数据库原理，太值了</p></li><li><p>Dog Bed Database <span class=exturl data-url=aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2RiZGItZG9nLWJlZC1kYXRhYmFzZS5odG1s>http://aosabook.org/en/500L/dbdb-dog-bed-database.html<i class="fa fa-external-link-alt"></i></span><br>类似上一章，不过这次实现的是key-value的非关系型数据库，详细的讲解和2，3百行代码</p></li><li><p>A 3D Modeller <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtM2QtbW9kZWxsZXIuaHRtbA==">http://aosabook.org/en/500L/a-3d-modeller.html<i class="fa fa-external-link-alt"></i></span><br>用python实现一个3D设计，显示到屏幕，可以交互。不是很懂，但不明觉厉</p></li><li><p>A Python Interpreter Written in Python <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtcHl0aG9uLWludGVycHJldGVyLXdyaXR0ZW4taW4tcHl0aG9uLmh0bWw=">http://aosabook.org/en/500L/a-python-interpreter-written-in-python.html<i class="fa fa-external-link-alt"></i></span><br>手把手教你如何实现python解析器。</p></li><li><p>A Pedometer in the Real World <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtcGVkb21ldGVyLWluLXRoZS1yZWFsLXdvcmxkLmh0bWw=">http://aosabook.org/en/500L/a-pedometer-in-the-real-world.html<i class="fa fa-external-link-alt"></i></span><br>你用过手机应用记录你每天走的步数，然后发送到朋友圈吗？ （没有？ 没关系。）这章告诉你如何实现步数记录，怎么算走一步。手机中有加速记，很容易获得你某一时刻在x,y,z三个方向的加速度，用这些参数，如何计算你走了多少步？ 知道吗？ 不知道，看这章，讲解加实现</p></li><li><p>A Continuous Intergration System <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtY29udGludW91cy1pbnRlZ3JhdGlvbi1zeXN0ZW0uaHRtbA==">http://aosabook.org/en/500L/a-continuous-integration-system.html<i class="fa fa-external-link-alt"></i></span><br>CI System是一个专门用来测试新代码的系统，根据代码提交记录，拿到新的代码，测试，生成报告。这不是关键，关键是 如果test失败，它还会 恢复，然后从失败的那个点在跑，相当于把出错环境重现了。。。</p></li></ol><p>13 A Rejection Sampler <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtcmVqZWN0aW9uLXNhbXBsZXIuaHRtbA==">http://aosabook.org/en/500L/a-rejection-sampler.html<i class="fa fa-external-link-alt"></i></span><br>不是很懂，和机器学习相关，如何 计算你赢得象棋比赛的概率，天气对飞机的影响等类似的问题</p><p>14 A visual programming toolkit <span class=exturl data-url="aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2Jsb2NrY29kZS1hLXZpc3VhbC1wcm9ncmFtbWluZy10b29sa2l0Lmh0bWw=">http://aosabook.org/en/500L/blockcode-a-visual-programming-toolkit.html<i class="fa fa-external-link-alt"></i></span><br>不太明白</p><ol start=15><li>A Flow Shop Scheduler <span class=exturl data-url=aHR0cDovL2Fvc2Fib29rLm9yZy9lbi81MDBML2EtZmxvdy1zaG9wLXNjaGVkdWxlci5odG1s>http://aosabook.org/en/500L/a-flow-shop-scheduler.html<i class="fa fa-external-link-alt"></i></span><br>flowshop调度问题，好像很出名的样子，最优化问题，如何从局部最优解找全局最优解</li></ol><p>16 Optical Character Recognition<br>几百行代码使用人工神经网络实现识别手写字母。。。</p><p>github源码：500lines&#x2F;README.md at master · aosabook&#x2F;500lines · GitHub</p><p>作者：小小搬运工<br>链接：<span class=exturl data-url=aHR0cDovL3d3dy56aGlodS5jb20vcXVlc3Rpb24vMjkzNzI1NzQvYW5zd2VyLzg4NjI0NTA3>http://www.zhihu.com/question/29372574/answer/88624507<i class="fa fa-external-link-alt"></i></span><br>来源：知乎<br>著作权归作者所有，转载请联系作者获得授权。</p></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/51792.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/51792.html class=post-title-link itemprop=url>块设备驱动</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-28 23:07:24" itemprop="dateCreated datePublished" datetime=2016-08-28T23:07:24+08:00>2016-08-28</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>设备驱动</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>驱动</span></a></span></span> <span id=/post/51792.html class="post-meta-item leancloud_visitors" data-flag-title=块设备驱动 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>1.5k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>块设备传输数据的固定长度为一个sector,因此，输入、输出调度器和块设备的驱动必须管理扇区的数据。<strong>虚拟文件系统-&gt;磁盘设备的中间映射层</strong>，它使用一种逻辑单元来管理磁盘数据，这种逻辑单元被称之为“Block”,一个块相当于一个文件系统里面的最小磁盘存储单元。</p><h2 id=块设备><a href=#块设备 class=headerlink title=块设备></a>块设备</h2><ul><li><p>块设备（blockdevice）</p><p>是一种具有一定结构的随机存取设备，对这种设备的读写是按块进行的，他使用缓冲区来存放暂时的数据，待条件成熟后，从缓存一次性写入设备或者从设备一次性读到缓冲区。</p></li></ul><ul><li><p>字符设备（Character device）</p><p>是一个顺序的数据流设备，对这种设备的读写是按字符进行的，而且这些字符是连续地形成一个数据流。他不具备缓冲区，所以对这种设备的读写是实时的。</p></li></ul><h2 id=块设备的驱动框架><a href=#块设备的驱动框架 class=headerlink title=块设备的驱动框架></a>块设备的驱动框架</h2><p><img data-src=/images/block.png alt=块设备驱动框架></p><blockquote><p>块设备的应用在Linux中是一个完整的子系统。</p></blockquote><p>在Linux中，驱动对块设备的输入或输出(I&#x2F;O)操作，都会向块设备发出一个请求，在驱动中用request结构体描述。但对于一些磁盘设备而言请求的速度很慢，这时候内核就提供一种队列的机制把这些I&#x2F;O请求添加到队列中（即：请求队列），在驱动中用request_queue结构体描述。在向块设备提交这些请求前内核会先执行请求的合并和排序预操作，以提高访问的效率，然后再由内核中的I&#x2F;O调度程序子系统来负责提交 I&#x2F;O 请求， 调度程序将磁盘资源分配给系统中所有挂起的块 I&#x2F;O 请求，其工作是管理块设备的请求队列，决定队列中的请求的排列顺序以及什么时候派发请求到设备。</p><p>由通用块层(Generic Block Layer)负责维持一个I&#x2F;O请求在上层文件系统与底层物理磁盘之间的关系。在通用块层中，通常用一个bio结构体来对应一个I&#x2F;O请求。</p><p>Linux提供了一个gendisk数据结构体，用来表示一个独立的磁盘设备或分区，用于对底层物理磁盘进行访问。在gendisk中有一个类似字符设备中file_operations的硬件操作结构指针，是block_device_operations结构体。</p><p>当多个请求提交给块设备时，执行效率依赖于请求的顺序。如果所有的请求是同一个方向（如：写数据），执行效率是最大的。内核在调用块设备驱动程序例程处理请求之前，先收集I&#x2F;O请求并将请求排序，然后，将连续扇区操作的多个请求进行合并以提高执行效率（内核算法会自己做，不用你管），对I&#x2F;O请求排序的算法称为电梯算法（elevator algorithm）。电梯算法在I&#x2F;O调度层完成。内核提供了不同类型的电梯算法.</p><h3 id=电梯算法><a href=#电梯算法 class=headerlink title=电梯算法></a>电梯算法</h3><p>1 noop（实现简单的FIFO，基本的直接合并与排序）,<br>2 anticipatory（延迟I&#x2F;O请求，进行临界区的优化排序），<br>3 Deadline（针对anticipatory缺点进行改善，降低延迟时间）,<br>4 Cfq（均匀分配I&#x2F;O带宽，公平机制）<br>PS：其实IO调度层（包括请求合并排序算法）是不需要用户管的，内核已经做好</p><h3 id=相关数据结构><a href=#相关数据结构 class=headerlink title=相关数据结构></a>相关数据结构</h3><p>block_device: 描述一个分区或整个磁盘对内核的一个块设备实例<br>gendisk: 描述一个通用硬盘（generic hard disk）对象。<br>hd_struct: 描述分区应有的分区信息<br>bio: 描述块数据传送时怎样完成填充或读取块给driver<br>request: 描述向内核请求一个列表准备做队列处理。<br>request_queue: 描述内核申请request资源建立请求链表并填写BIO形成队列。</p><h2 id=驱动的实现><a href=#驱动的实现 class=headerlink title=驱动的实现></a>驱动的实现</h2></div><footer class=post-footer><div class=post-eof></div></footer></article></div><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/47803.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="undefined | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h2 class=post-title itemprop="name headline"><a href=/post/47803.html class=post-title-link itemprop=url>Linux内核中驱动注册的先后顺序</a></h2><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2016-08-24 23:07:24" itemprop="dateCreated datePublished" datetime=2016-08-24T23:07:24+08:00>2016-08-24</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/" itemprop=url rel=index><span itemprop=name>设备驱动</span></a></span> ， <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/kernel/" itemprop=url rel=index><span itemprop=name>kernel</span></a></span></span> <span id=/post/47803.html class="post-meta-item leancloud_visitors" data-flag-title=Linux内核中驱动注册的先后顺序 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>0</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>1 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody></div><footer class=post-footer><div class=post-eof></div></footer></article></div><nav class=pagination><a class="extend prev" rel=prev href="/page/32/"><i class="fa fa-angle-left" aria-label=上一页></i></a><a class=page-number href="/">1</a><span class=space>&hellip;</span><a class=page-number href="/page/32/">32</a><span class="page-number current">33</span><a class=page-number href="/page/34/">34</a><span class=space>&hellip;</span><a class=page-number href="/page/36/">36</a><a class="extend next" rel=next href="/page/34/"><i class="fa fa-angle-right" aria-label=下一页></i></a></nav></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2014 – <span itemprop=copyrightYear>2023</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>winddoing</span></div><div class=wordcount><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-chart-line"></i></span> <span title=站点总字数>1.1m</span></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-coffee"></i></span> <span title=站点阅读时长>16:21</span></span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv><span class=post-meta-item-icon><i class="fa fa-users"></i></span> <span class=site-uv title=总访客量><span id=busuanzi_value_site_uv></span></span></span> <span class=post-meta-item id=busuanzi_container_site_pv><span class=post-meta-item-icon><i class="fa fa-eye"></i></span> <span class=site-pv title=总访问量><span id=busuanzi_value_site_pv></span></span></span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 强力驱动</div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/muse.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src=/js/third-party/tags/pdf.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script><script src=/js/third-party/tags/mermaid.js></script><script src=/js/third-party/fancybox.js></script><script data-pjax async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=leancloud_visitors type=application/json>{"enable":true,"app_id":"Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz","app_key":"tgUTq5bX3fVmn916EMRe65eJ","server_url":null,"security":false}</script><script src=/js/third-party/statistics/lean-analytics.js></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script><script src=/js/third-party/math/mathjax.js></script><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"Winddoing/winddoing.github.io","issue_term":"title","theme":"github-light"}</script><script src=/js/third-party/comments/utterances.js></script></body></html>