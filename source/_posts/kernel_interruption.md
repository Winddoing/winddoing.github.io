---
title: Linux内核--中断
date: 2018-02-26 23:07:24
categories: Linux内核
tags: [中断]
---

中断有两种：

1. 由CPU外部产生。（被动）
2. 由CPU本身在执行程序的时候产生。（主动）

<!--more-->

中断服务程序一般都是在中断请求关闭的条件下执行的，以避免嵌套而使中断控制复杂化。但是，中断是一个随机事件，它随时会到来，如果关中断的时间太长，CPU就不能及时响应其他的中断请求，从而造成中断的丢失。因此为了保证所有的中断都被响应，并且相对公平的执行，引入了中断下半部，主要有`tasklet`，`工作队列`，`软中断`和`线程化irq`


| 条件 | tasklet |  workqueue | softirq |
| :-:  | :---:   |  :-------: | :-----:|
| 运行上下文 | 软中断 | 进程（内核态）| 软中断|
| 是否sleep|  否  | 否 | 否 |
| 是否关中断|  否  | 否 | 否 |
| 是否可重新调度| 是  | 否 | 否 |
| 是否可带参数| 是 | 否 | 否 |
| 谁被触发，谁执行 | 是 | 默认是（进程调度） | 是  |
| 可同时多CPU执行 | 同一个Tasklet在任意时刻只能被一个CPU执行 | 有进程调度决定 | 同一个softirq_action可同时被多个CPU执行 |
| 是否可延时执行 | 否 | 是 | 否 |
| 数据结构 | a |a | a |
| 初始化 | a |a | a |
| 改变运行状态 | a |a | a |
| 使能/停止 | a |a | a |
| 触发 | a |a | a |
| 执行 | a |a | a |
| 创建线程 | a |a | a |
| 结束 | a |a | a |



## Tasklet

## 工作队列

## 软中断

## 线程化irq

## 参考

1. [中断处理“下半部”机制](http://blog.csdn.net/myarrow/article/details/9287169)
