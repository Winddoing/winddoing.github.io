
# 判断网络是否连接

> 让对方知道自己还活着，以确保连接的有效性。

## ping


## 心跳包

在TCP socket心跳机制中，心跳包可以`由服务器发送给客户端`，也可以`由客户端发送给服务器`，不过比较起来，前者开销可能更大。

这里实现的是由客户端给服务器发送心跳包，基本思路是：

1. 服务器为每个客户端保存了IP和计数器count，即map<fd, pair<ip, count>>。服务端主线程采用select实现多路IO复用，监听新连接以及接受数据包（心跳包），子线程用于检测心跳：
  * 如果主线程接收到的是心跳包，将该客户端对应的计数器count清零；
  * 在子线程中，每隔3秒遍历一次所有客户端的计数器count
    - 若 count 小于 5，将 count 计数器加 1；
    - 若 count 等于 5，说明已经15秒未收到该用户心跳包，判定该用户已经掉线；

2. 客户端则只是开辟子线程，定时给服务器发送心跳包（本示例中定时时间为3秒）。


## 参考

* [TCP socket心跳包示例程序](https://blog.csdn.net/lisonglisonglisong/article/details/51327695)
