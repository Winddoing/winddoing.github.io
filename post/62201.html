<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222 media="(prefers-color-scheme: light)"><meta name=theme-color content=#222 media="(prefers-color-scheme: dark)"><meta name=generator content="Hexo 6.2.0"><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preconnect href=https://cdnjs.cloudflare.com crossorigin><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon.ico><link rel=mask-icon href=/images/logo.svg color=#222><meta name=baidu-site-verification content=WIIeufYjj6><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Microsoft+YaHei:300,300italic,400,400italic,700,700italic%7Ccmmi10:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"winddoing.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.12.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content="spinlock的使用场景，为什么使用？ 在spinlock控制临界区中，为什么不能睡眠？如果睡眠会产生什么结果？ spinlock的实现和数据结构，在x86、ARM64、MIPS中的实现方式，不同吗？存在什么差异？ 在发生抢锁时，spinlock和信号量处理的区别？"><meta property=og:type content=article><meta property=og:title content="Linux内核同步机制【spin lock】"><meta property=og:url content=https://winddoing.github.io/post/62201.html><meta property=og:site_name content="Winddoing&#39;s Notes"><meta property=og:description content="spinlock的使用场景，为什么使用？ 在spinlock控制临界区中，为什么不能睡眠？如果睡眠会产生什么结果？ spinlock的实现和数据结构，在x86、ARM64、MIPS中的实现方式，不同吗？存在什么差异？ 在发生抢锁时，spinlock和信号量处理的区别？"><meta property=og:locale content=zh_CN><meta property=article:published_time content=2018-03-29T15:07:24.000Z><meta property=article:modified_time content=2023-12-16T04:58:17.921Z><meta property=article:author content=winddoing><meta property=article:tag content=linux><meta property=article:tag content=sync><meta property=article:tag content=spinlock><meta name=twitter:card content=summary><link rel=canonical href=https://winddoing.github.io/post/62201.html><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://winddoing.github.io/post/62201.html","path":"post/62201.html","title":"Linux内核同步机制【spin lock】"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Linux内核同步机制【spin lock】 | Winddoing's Notes</title><script src=/js/third-party/analytics/baidu-analytics.js></script><script async src=https://hm.baidu.com/hm.js?b96a560ce0a6bfbeaaddc59dc5888b75></script><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href="/" class=brand rel=start><i class=logo-line></i><p class=site-title>Winddoing's Notes</p><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Follow Excellent, Success will Chase you</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel=section><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel=section><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel=section><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#spin-lock%E7%89%B9%E7%82%B9><span class=nav-number>1.</span> <span class=nav-text>spin lock特点</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%9C%BA%E6%99%AF><span class=nav-number>2.</span> <span class=nav-text>场景</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%BF%9B%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87><span class=nav-number>2.1.</span> <span class=nav-text>进程上下文</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%B8%AD%E6%96%AD%E4%B8%8A%E4%B8%8B%E6%96%87><span class=nav-number>2.2.</span> <span class=nav-text>中断上下文</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%80%9A%E7%94%A8%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84><span class=nav-number>3.</span> <span class=nav-text>通用代码结构</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84><span class=nav-number>3.1.</span> <span class=nav-text>数据结构</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8E%A5%E5%8F%A3API><span class=nav-number>3.2.</span> <span class=nav-text>接口API</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B><span class=nav-number>3.3.</span> <span class=nav-text>调用流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#MIPS%E6%9E%B6%E6%9E%84%E7%9A%84%E5%AE%9E%E7%8E%B0><span class=nav-number>4.</span> <span class=nav-text>MIPS架构的实现</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#arch-spinlock-t><span class=nav-number>4.1.</span> <span class=nav-text>arch_spinlock_t</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AE%9E%E7%8E%B0><span class=nav-number>4.2.</span> <span class=nav-text>实现</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#arch-spin-lock><span class=nav-number>4.2.1.</span> <span class=nav-text>arch_spin_lock</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#arch-spin-trylock><span class=nav-number>4.2.2.</span> <span class=nav-text>arch_spin_trylock</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%8F%8D%E6%B1%87%E7%BC%96arch-spin-lock><span class=nav-number>4.2.3.</span> <span class=nav-text>反汇编arch_spin_lock</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#Q-amp-A><span class=nav-number>5.</span> <span class=nav-text>Q&amp;A</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%85%B3%E9%97%AD%E6%8A%A2%E5%8D%A0%EF%BC%9F><span class=nav-number>5.1.</span> <span class=nav-text>为什么要关闭抢占？</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E7%9D%A1%E7%9C%A0%EF%BC%9F><span class=nav-number>5.2.</span> <span class=nav-text>为什么不能睡眠？</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#spinlock%E9%98%B6%E6%AE%B5%EF%BC%8C%E6%9D%A5%E4%B8%AD%E6%96%AD%EF%BC%9F><span class=nav-number>5.3.</span> <span class=nav-text>spinlock阶段，来中断？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8F%82%E8%80%83><span class=nav-number>6.</span> <span class=nav-text>参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=winddoing src=/images/Winddoing.jpg><p class=site-author-name itemprop=name>winddoing</p><div class=site-description itemprop=description>失败缘于忽视细处，成功始于重视小事</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href="/archives/"><span class=site-state-item-count>358</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class=site-state-item-count>112</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class=site-state-item-count>284</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL1dpbmRkb2luZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing"><i class="fab fa-github fa-fw"></i>GitHub</span></span> <span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly9naXRlZS5jb20vd2luZGRvaW5n title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing"><i class="fab fa-codiepie fa-fw"></i>Gitee</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy85NTY3MzYxL3dpbmRkb2luZw==" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9hcHAudHJhdmlzLWNpLmNvbS9naXRodWIvV2luZGRvaW5nL3dpbmRkb2luZy5naXRodWIuaW8=" title="Travis CI → https:&#x2F;&#x2F;app.travis-ci.com&#x2F;github&#x2F;Winddoing&#x2F;winddoing.github.io"><i class="fas fa-terminal fa-fw"></i>Travis CI</span></span></div><div class="cc-license site-overview-item animated" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg alt="Creative Commons"></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="link fa-fw"></i> Links</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cHM6Ly93aW5kZG9pbmcuZ2l0Ym9vay5pby9lbWJlZGRlZF9saW51eF9ub3Rlcy8=" title=https:&#x2F;&#x2F;winddoing.gitbook.io&#x2F;embedded_linux_notes&#x2F;>嵌入式相关</span></li><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2RyZWFtcQ==" title=http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq>CSDN</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cDovL3d3dy53b3dvdGVjaC5uZXQv title=http:&#x2F;&#x2F;www.wowotech.net&#x2F;>蜗窝科技</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpb25neGlhbnpl title=https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze>xiongxianze</span></li></ul></div><div id=days></div><script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("02/26/2014 15:00:00");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
}
show_date_time();
</script></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang=zh-CN><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/62201.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Linux内核同步机制【spin lock】 | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h1 class=post-title itemprop="name headline">Linux内核同步机制【spin lock】</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2018-03-29 23:07:24" itemprop="dateCreated datePublished" datetime=2018-03-29T23:07:24+08:00>2018-03-29</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/Linux%E5%86%85%E6%A0%B8/" itemprop=url rel=index><span itemprop=name>Linux内核</span></a></span></span> <span id=/post/62201.html class="post-meta-item leancloud_visitors" data-flag-title="Linux内核同步机制【spin lock】" title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-item title=阅读次数 id=busuanzi_container_page_pv><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span id=busuanzi_value_page_pv></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>7.8k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>7 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><ol><li>spinlock的使用场景，为什么使用？</li><li>在spinlock控制临界区中，为什么不能睡眠？如果睡眠会产生什么结果？</li><li>spinlock的实现和数据结构，在x86、ARM64、MIPS中的实现方式，不同吗？存在什么差异？</li><li>在发生抢锁时，spinlock和信号量处理的区别？</li></ol><span id=more></span><p>内核版本：linux 4.4.93</p><h2 id=spin-lock特点><a href=#spin-lock特点 class=headerlink title="spin lock特点"></a>spin lock特点</h2><ul><li><p><code>spin lock</code>是一种死等的锁机制。当前的执行thread会不断的重新尝试直到获取锁进入临界区。</p><blockquote><p>当发生访问资源冲突的时候，可以有两个选择：一个是死等，一个是挂起当前进程，调度其他进程执行。</p></blockquote></li><li><p>只允许一个thread进入。semaphore可以允许多个thread进入，spin lock不行，一次只能有一个thread获取锁并进入临界区，其他的thread都是在门口不断的尝试。</p></li><li><p>执行时间短。</p><blockquote><p>由于spin lock死等这种特性，因此它使用在那些代码不是非常复杂的临界区（当然也不能太简单，否则使用原子操作或者其他适用简单场景的同步机制就OK了），如果临界区执行时间太长，那么不断在临界区门口“死等”的那些thread是多么的浪费CPU啊（当然，现代CPU的设计都会考虑同步原语的实现，例如ARM提供了WFE和SEV这样的类似指令，避免CPU进入busy loop的悲惨境地）</p></blockquote></li><li><p>可以在中断上下文执行。由于不睡眠，因此spin lock可以在中断上下文中适用。</p></li></ul><h2 id=场景><a href=#场景 class=headerlink title=场景></a>场景</h2><p>spin lock，其保护的资源可能来自多个CPU CORE上的<code>进程上下文</code>和<code>中断上下文</code>的中的访问</p><ul><li>进程上下文包括：用户进程通过系统调用访问，内核线程直接访问，来自workqueue中work function的访问（本质上也是内核线程）。</li><li>中断上下文包括：HW interrupt context（中断handler）、软中断上下文（soft<br>irq，当然由于各种原因，该softirq被推迟到softirqd的内核线程中执行的时候就不属于这个场景了，属于进程上下文那个分类了）、timer的callback函数（本质上也是softirq）、tasklet（本质上也是softirq）。</li></ul><p>先看最简单的单CPU上的进程上下文的访问。如果一个全局的资源被多个进程上下文访问，这时候，内核如何交错执行呢？对于那些没有打开preemptive选项的内核，所有的系统调用都是串行化执行的，因此不存在资源争抢的问题。</p><p>如果内核线程也访问这个全局资源呢？本质上内核线程也是进程，类似普通进程，只不过普通进程时而在用户态运行、时而通过系统调用陷入内核执行，而内核线程永远都是在内核态运行，但是，结果是一样的，对于non-preemptive的linux kernel，只要在内核态，就不会发生进程调度<br>因此，这种场景下，共享数据根本不需要保护（没有并发，谈何保护呢）。</p><blockquote><p>单核CPU中， 如果系统默认关闭抢占时，spin lock不起任何作用，因为不存在真正并发的条件，不需要进行同步。如果打开内核抢占，其同步机制主要时通过关闭抢占实现</p></blockquote><h3 id=进程上下文><a href=#进程上下文 class=headerlink title=进程上下文></a>进程上下文</h3><p>当打开premptive选项后，事情变得复杂了，我们考虑下面的场景：</p><ul><li>进程A在某个系统调用过程中访问了共享资源R</li><li>进程B在某个系统调用过程中也访问了共享资源R</li></ul><p><strong>1.会不会造成冲突呢？</strong></p><p>假设在A访问共享资源R的过程中发生了中断，中断唤醒了沉睡中的，优先级更高的B，在中断返回现场的时候，发生进程切换，B启动执行，并通过系统调用访问了R，如果没有锁保护，则会出现两个thread进入临界区，导致程序执行不正确。</p><p><strong>2.使用spin lock：</strong></p><p>A在进入临界区之前获取了spin lock，同样的，在A访问共享资源R的过程中发生了中断，中断唤醒了沉睡中的，优先级更高的B，B在访问临界区之前仍然会试图获取spin lock，这时候由于A进程持有spin lock而导致B进程进入了永久的spin……怎么破？linux的kernel很简单，在A进程获取spin lock的时候，禁止本CPU上的抢占（上面的永久spin的场合仅仅在本CPU的进程抢占本CPU的当前进程这样的场景中发生）。</p><p>如果是多核CPU，A和B运行在不同的CPU上，那么情况会简单一些：A进程虽然持有spin lock而导致B进程进入spin状态，不过由于运行在不同的CPU上，A进程会持续执行并会很快释放spin lock，解除B进程的spin状态。</p><h3 id=中断上下文><a href=#中断上下文 class=headerlink title=中断上下文></a>中断上下文</h3><ul><li>运行在CPU0上的进程A在某个系统调用过程中访问了共享资源R</li><li>运行在CPU1上的进程B在某个系统调用过程中也访问了共享资源R</li><li>外设P的中断handler中也会访问共享资源R</li></ul><p>在这样的场景下，使用spin lock可以保护访问共享资源R的临界区吗？我们假设CPU0上的进程A持有spin lock进入临界区，这时候，外设P发生了中断事件，并且调度到了CPU1上执行，看起来没有什么问题，执行在CPU1上的handler会稍微等待一会CPU0上的进程A，等它立刻临界区就会释放spin lock的.</p><p>但是，如果外设P的中断事件被调度到了CPU0上执行会怎么样？CPU0上的进程A在持有spin lock的状态下被中断上下文抢占，而抢占它的CPU0上的handler在进入临界区之前仍然会试图获取spin lock，悲剧发生了，CPU0上的P外设的中断handler永远的进入spin状态，这时候，CPU1上的进程B也不可避免在试图持有spin lock的时候失败而导致进入spin状态。<br>为了解决这样的问题，linux kernel采用了这样的办法：如果涉及到中断上下文的访问，spin lock需要和禁止本CPU上的中断联合使用。</p><p>linux kernel中提供了丰富的bottom half的机制，虽然同属中断上下文，不过还是稍有不同。我们可以把上面的场景简单修改一下：外设P不是中断handler中访问共享资源R，而是在的bottom half中访问。使用spin lock+禁止本地中断当然是可以达到保护共享资源的效果，但是使用牛刀来杀鸡似乎有点小题大做，这时候disable bottom half就OK了。</p><p>最后，我们讨论一下中断上下文之间的竞争。同一种中断handler之间在uni core和multi core上都不会并行执行，这是linux kernel的特性。如果不同中断handler需要使用spin lock保护共享资源，对于新的内核（不区分fast handler和slow handler），所有handler都是关闭中断的，因此使用spin lock不需要关闭中断的配合。<br>bottom half又分成softirq和tasklet，同一种softirq会在不同的CPU上并发执行，因此如果某个驱动中的sofirq的handler中会访问某个全局变量，对该全局变量是需要使用spin lock保护的，不用配合disable CPU中断或者bottom half。<br>tasklet更简单，因为同一种tasklet不会多个CPU上并发，具体我就不分析了，大家自行思考吧。</p><h2 id=通用代码结构><a href=#通用代码结构 class=headerlink title=通用代码结构></a>通用代码结构</h2><h3 id=数据结构><a href=#数据结构 class=headerlink title=数据结构></a>数据结构</h3><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>typedef</span> <span class=class><span class=keyword>struct</span> <span class=title>spinlock</span> &#123;</span></span><br><span class=line>	<span class=class><span class=keyword>union</span> &#123;</span></span><br><span class=line>		<span class=class><span class=keyword>struct</span> <span class=title>raw_spinlock</span> <span class=title>rlock</span>;</span></span><br><span class=line>	&#125;;</span><br><span class=line>&#125; <span class=type>spinlock_t</span>;</span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=class><span class=keyword>struct</span> <span class=title>raw_spinlock</span> &#123;</span></span><br><span class=line>    <span class=type>arch_spinlock_t</span> raw_lock;</span><br><span class=line>&#125; <span class=type>raw_spinlock_t</span>;</span><br></pre></td></tr></table></figure><blockquote><p>file: include&#x2F;linux&#x2F;spinlock_types.h</p></blockquote><p>通过<code>arch_spinlock_t</code>结构体定义不同arch下spin lock的实现结构。</p><h3 id=接口API><a href=#接口API class=headerlink title=接口API></a>接口API</h3><p>| 接口类型 | spinlock定义 | raw_spinlock的定义 |<br>| :—————: | :—————: | :—————: |<br>|定义spin lock并初始化 | DEFINE_SPINLOCK | DEFINE_RAW_SPINLOCK |<br>|动态初始化spin lock | spin_lock_init | raw_spin_lock_init |<br>|获取指定的spin lock | spin_lock | raw_spin_lock |<br>|获取指定的spin lock同时disable本CPU中断 |spin_lock_irq |raw_spin_lock_irq |<br>|保存本CPU当前的irq状态, disable本CPU中断并获取指定的spin lock |spin_lock_irqsave |raw_spin_lock_irqsave |<br>|获取指定的spin lock同时disable本CPU的bottom half |spin_lock_bh |raw_spin_lock_bh |<br>|释放指定的spin lock |spin_unlock |raw_spin_unlock |<br>|释放指定的spin lock同时enable本CPU中断 |spin_unlock_irq |raw_spin_unock_irq |<br>|释放指定的spin lock同时恢复本CPU的中断状态 |spin_unlock_irqstore |raw_spin_unlock_irqstore |<br>|获取指定的spin lock同时enable本CPU的bottom half |spin_unlock_bh |raw_spin_unlock_bh |<br>|尝试去获取spin lock，如果失败，不会spin，而是返回非零值 |spin_trylock |raw_spin_trylock |<br>|判断spin lock是否是locked, 如果其他的thread已经获取了该lock, 那么返回非零值，否则返回0 |spin_is_locked | raw_spin_is_locked |</p><h3 id=调用流程><a href=#调用流程 class=headerlink title=调用流程></a>调用流程</h3><p>spin lock:</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line>spin_lock()</span><br><span class=line>	\-&gt;raw_spin_lock()</span><br><span class=line>		\-&gt;__raw_spin_lock</span><br><span class=line>			&#123;</span><br><span class=line>				preempt_disable(); //关闭内核抢占</span><br><span class=line>				spin_acquire(&amp;lock-&gt;dep_map, 0, 0, _RET_IP_); //获取锁</span><br><span class=line>				LOCK_CONTENDED(lock, do_raw_spin_trylock, do_raw_spin_lock);//上锁</span><br><span class=line>			&#125;</span><br><span class=line>			-----------------------------  arch</span><br><span class=line>			-&gt; arch_spin_lock()</span><br><span class=line>			-&gt; arch_spin_trylock()</span><br></pre></td></tr></table></figure><h2 id=MIPS架构的实现><a href=#MIPS架构的实现 class=headerlink title=MIPS架构的实现></a>MIPS架构的实现</h2><h3 id=arch-spinlock-t><a href=#arch-spinlock-t class=headerlink title=arch_spinlock_t></a>arch_spinlock_t</h3><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>typedef</span> <span class=class><span class=keyword>union</span> &#123;</span></span><br><span class=line>	<span class=comment>/*</span></span><br><span class=line><span class=comment>	 * bits  0..15 : serving_now</span></span><br><span class=line><span class=comment>	 * bits 16..31 : ticket</span></span><br><span class=line><span class=comment>	 */</span></span><br><span class=line>	u32 lock;</span><br><span class=line>	<span class=class><span class=keyword>struct</span> &#123;</span></span><br><span class=line><span class=meta>#<span class=keyword>ifdef</span> __BIG_ENDIAN</span></span><br><span class=line>		u16 ticket;</span><br><span class=line>		u16 serving_now;</span><br><span class=line><span class=meta>#<span class=keyword>else</span></span></span><br><span class=line>		u16 serving_now;</span><br><span class=line>		u16 ticket;</span><br><span class=line><span class=meta>#<span class=keyword>endif</span></span></span><br><span class=line>	&#125; h;</span><br><span class=line>&#125; <span class=type>arch_spinlock_t</span>;</span><br></pre></td></tr></table></figure><blockquote><p>file: arch&#x2F;mips&#x2F;include&#x2F;asm&#x2F;spinlock_types.h</p></blockquote><h3 id=实现><a href=#实现 class=headerlink title=实现></a>实现</h3><h4 id=arch-spin-lock><a href=#arch-spin-lock class=headerlink title=arch_spin_lock></a>arch_spin_lock</h4><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br></pre></td><td class=code><pre><span class=line><span class=type>static</span> <span class=keyword>inline</span> <span class=type>void</span> <span class="title function_">arch_spin_lock</span><span class=params>(<span class=type>arch_spinlock_t</span> *lock)</span></span><br><span class=line>&#123;</span><br><span class=line>    <span class=type>int</span> my_ticket;</span><br><span class=line>    <span class=type>int</span> tmp;</span><br><span class=line>    <span class=type>int</span> inc = <span class=number>0x10000</span>;</span><br><span class=line></span><br><span class=line>     __asm__ __volatile__ (</span><br><span class=line>		<span class=string>&quot;   .set push       # arch_spin_lock    \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   .set noreorder                  \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;                           \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;1: ll  %[ticket], %[ticket_ptr]        \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   addu    %[my_ticket], %[ticket], %[inc]     \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   sc  %[my_ticket], %[ticket_ptr]     \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   beqz    %[my_ticket], 1b            \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;    srl    %[my_ticket], %[ticket], 16     \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   andi    %[ticket], %[ticket], 0xffff        \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   bne %[ticket], %[my_ticket], 4f     \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;    subu   %[ticket], %[my_ticket], %[ticket]  \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;2: .insn                       \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   .subsection 2                   \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;4: andi    %[ticket], %[ticket], 0xffff        \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   sll %[ticket], 5                \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;                           \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;6: bnez    %[ticket], 6b               \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;    subu   %[ticket], 1                \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;                           \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   lhu %[ticket], %[serving_now_ptr]       \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   beq %[ticket], %[my_ticket], 2b     \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;    subu   %[ticket], %[my_ticket], %[ticket]  \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   b   4b                  \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;    subu   %[ticket], %[ticket], 1         \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   .previous                   \n&quot;</span></span><br><span class=line> 		<span class=string>&quot;   .set pop                    \n&quot;</span></span><br><span class=line> 		: [ticket_ptr] <span class=string>&quot;+&quot;</span> GCC_OFF_SMALL_ASM() (lock-&gt;lock),</span><br><span class=line> 		  [serving_now_ptr] <span class=string>&quot;+m&quot;</span> (lock-&gt;h.serving_now),</span><br><span class=line> 		  [ticket] <span class=string>&quot;=&amp;r&quot;</span> (tmp),</span><br><span class=line> 		  [my_ticket] <span class=string>&quot;=&amp;r&quot;</span> (my_ticket)</span><br><span class=line> 		: [inc] <span class=string>&quot;r&quot;</span> (inc));</span><br><span class=line></span><br><span class=line>    smp_llsc_mb();</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>file: arch&#x2F;mips&#x2F;include&#x2F;asm&#x2F;spinlock.h</p></blockquote><p><strong>算法：<a href=/downloads/kernel/spinlock/mcs.pdf>Ticket lock: A fair lock</a></strong></p><h4 id=arch-spin-trylock><a href=#arch-spin-trylock class=headerlink title=arch_spin_trylock></a>arch_spin_trylock</h4><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br></pre></td><td class=code><pre><span class=line><span class=type>static</span> <span class=keyword>inline</span> <span class=type>unsigned</span> <span class=type>int</span> <span class="title function_">arch_spin_trylock</span><span class=params>(<span class=type>arch_spinlock_t</span> *lock)</span></span><br><span class=line>&#123;</span><br><span class=line>    <span class=type>int</span> tmp, tmp2, tmp3;</span><br><span class=line>    <span class=type>int</span> inc = <span class=number>0x10000</span>;</span><br><span class=line></span><br><span class=line>    __asm__ __volatile__ (</span><br><span class=line>		<span class=string>&quot;   .set push       # arch_spin_trylock \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   .set noreorder                  \n&quot;</span></span><br><span class=line>		<span class=string>&quot;                           \n&quot;</span></span><br><span class=line>		<span class=string>&quot;1: ll  %[ticket], %[ticket_ptr]        \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   srl %[my_ticket], %[ticket], 16     \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   andi    %[now_serving], %[ticket], 0xffff   \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   bne %[my_ticket], %[now_serving], 3f    \n&quot;</span></span><br><span class=line>		<span class=string>&quot;    addu   %[ticket], %[ticket], %[inc]        \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   sc  %[ticket], %[ticket_ptr]        \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   beqz    %[ticket], 1b               \n&quot;</span></span><br><span class=line>		<span class=string>&quot;    li %[ticket], 1                \n&quot;</span></span><br><span class=line>		<span class=string>&quot;2: .insn                       \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   .subsection 2                   \n&quot;</span></span><br><span class=line>		<span class=string>&quot;3: b   2b                  \n&quot;</span></span><br><span class=line>		<span class=string>&quot;    li %[ticket], 0                \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   .previous                   \n&quot;</span></span><br><span class=line>		<span class=string>&quot;   .set pop                    \n&quot;</span></span><br><span class=line>		: [ticket_ptr] <span class=string>&quot;+&quot;</span> GCC_OFF_SMALL_ASM() (lock-&gt;lock),</span><br><span class=line>		  [ticket] <span class=string>&quot;=&amp;r&quot;</span> (tmp),</span><br><span class=line>		  [my_ticket] <span class=string>&quot;=&amp;r&quot;</span> (tmp2),</span><br><span class=line>		  [now_serving] <span class=string>&quot;=&amp;r&quot;</span> (tmp3)</span><br><span class=line>		: [inc] <span class=string>&quot;r&quot;</span> (inc));</span><br><span class=line></span><br><span class=line>     smp_llsc_mb();</span><br><span class=line></span><br><span class=line>     <span class=keyword>return</span> tmp;</span><br><span class=line> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>file: arch&#x2F;mips&#x2F;include&#x2F;asm&#x2F;spinlock.h</p></blockquote><h4 id=反汇编arch-spin-lock><a href=#反汇编arch-spin-lock class=headerlink title=反汇编arch_spin_lock></a>反汇编arch_spin_lock</h4><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre></td><td class=code><pre><span class=line>&lt;lg_local_lock&gt;:</span><br><span class=line>   ...</span><br><span class=line></span><br><span class=line>   3c030001    lui v1,0x1</span><br><span class=line>   c0440000    ll  a0,0(v0)</span><br><span class=line>   00832821    addu    a1,a0,v1</span><br><span class=line>   e0450000    sc  a1,0(v0)</span><br><span class=line>   10a0fffc    beqz    a1,80071228 &lt;lg_local_lock+0x40&gt;</span><br><span class=line>   00042c02    srl a1,a0,0x10</span><br><span class=line>   14850120    bne a0,a1,800716c4 &lt;lg_double_unlock+0x88&gt;</span><br><span class=line>   00a42023    subu    a0,a1,a0</span><br><span class=line></span><br><span class=line>   0000000f    sync			//smp_llsc_mb();</span><br><span class=line>   ...</span><br></pre></td></tr></table></figure><blockquote><p>指令：ll和sc</p><blockquote><p>ll: 指令的功能是从内存中读取一个字，以实现接下来的 RMW（Read-Modify-Write） 操作</p></blockquote><blockquote><p>sc: 指令的功能是向内存中写入一个字，以完成前面的 RMW 操作</p></blockquote></blockquote><h2 id=Q-amp-A><a href=#Q-amp-A class=headerlink title=Q&amp;A></a>Q&amp;A</h2><h3 id=为什么要关闭抢占？><a href=#为什么要关闭抢占？ class=headerlink title=为什么要关闭抢占？></a>为什么要关闭抢占？</h3><p>如果不禁止内核抢断(或者不禁止中断)，可能会有以下的情况发生（假设进程B比进程A具有更高的优先级）：</p><ul><li>进程A获得spinlock lock</li><li>进程B运行(抢占进程A)</li><li>进程B获取spinlock lock</li></ul><p>由于进程B比进程A优先级高，所以进程B在进程A之前运行，而进程B需要进程A释放lock之后才能运行，于是，死锁</p><h3 id=为什么不能睡眠？><a href=#为什么不能睡眠？ class=headerlink title=为什么不能睡眠？></a>为什么不能睡眠？</h3><p>spinlock中的代码不能有睡眠（schedule()之类的放弃CPU的代码），因为此时内核抢占已经关闭，如果让出CPU正好调度到的另一个进程也需要这个锁，整个系统将形成死锁。</p><h3 id=spinlock阶段，来中断？><a href=#spinlock阶段，来中断？ class=headerlink title=spinlock阶段，来中断？></a>spinlock阶段，来中断？</h3><ol><li>进程A获取spinlcok锁，访问资源R</li><li>中断响应后，在中断处理程序中，也去获取spinlock锁，并访问资源R</li></ol><p>如果在进程A没有释放spinlock锁时，如果触发中断后，进程A和中断怎么处理？？</p><blockquote><p>此时不能使用spin_lock,应该使用spin_lock_irq</p></blockquote><h2 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h2><ol><li><span class=exturl data-url=aHR0cDovL3d3dy53b3dvdGVjaC5uZXQva2VybmVsX3N5bmNocm9uaXphdGlvbi9zcGlubG9jay5odG1s>Linux内核同步机制之（四）：spin lock<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly93d3cuaWJtLmNvbS9kZXZlbG9wZXJ3b3Jrcy9jbi9saW51eC9sLWNuLXNwaW5sb2NrX21pcHMvaW5kZXguaHRtbA==">Linux 的 Spinlock 在 MIPS 多核处理器中的设计与实现<i class="fa fa-external-link-alt"></i></span></li></ol></div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者：</strong>winddoing</li><li class=post-copyright-link><strong>本文链接：</strong> <a href=https://winddoing.github.io/post/62201.html title="Linux内核同步机制【spin lock】">https://winddoing.github.io/post/62201.html</a></li><li class=post-copyright-license><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <span class=exturl data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class=post-tags><a href="/tags/linux/" rel=tag><i class="fa fa-tag"></i> linux</a> <a href="/tags/sync/" rel=tag><i class="fa fa-tag"></i> sync</a> <a href="/tags/spinlock/" rel=tag><i class="fa fa-tag"></i> spinlock</a></div><div class=post-nav><div class=post-nav-item><a href=/post/42863.html rel=prev title=面试总结><i class="fa fa-chevron-left"></i> 面试总结</a></div><div class=post-nav-item><a href=/post/3438.html rel=next title=Cgroup框架的实现>Cgroup框架的实现 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2014 – <span itemprop=copyrightYear>2023</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>winddoing</span></div><div class=wordcount><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-chart-line"></i></span> <span title=站点总字数>1.1m</span></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-coffee"></i></span> <span title=站点阅读时长>16:21</span></span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv><span class=post-meta-item-icon><i class="fa fa-users"></i></span> <span class=site-uv title=总访客量><span id=busuanzi_value_site_uv></span></span></span> <span class=post-meta-item id=busuanzi_container_site_pv><span class=post-meta-item-icon><i class="fa fa-eye"></i></span> <span class=site-pv title=总访问量><span id=busuanzi_value_site_pv></span></span></span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 强力驱动</div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/muse.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src=/js/third-party/tags/pdf.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script><script src=/js/third-party/tags/mermaid.js></script><script src=/js/third-party/fancybox.js></script><script data-pjax async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=leancloud_visitors type=application/json>{"enable":true,"app_id":"Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz","app_key":"tgUTq5bX3fVmn916EMRe65eJ","server_url":null,"security":false}</script><script src=/js/third-party/statistics/lean-analytics.js></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script><script src=/js/third-party/math/mathjax.js></script><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"Winddoing/winddoing.github.io","issue_term":"title","theme":"github-light"}</script><script src=/js/third-party/comments/utterances.js></script></body></html>