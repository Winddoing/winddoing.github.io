<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222 media="(prefers-color-scheme: light)"><meta name=theme-color content=#222 media="(prefers-color-scheme: dark)"><meta name=generator content="Hexo 6.2.0"><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preconnect href=https://cdnjs.cloudflare.com crossorigin><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon.ico><link rel=mask-icon href=/images/logo.svg color=#222><meta name=baidu-site-verification content=WIIeufYjj6><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Microsoft+YaHei:300,300italic,400,400italic,700,700italic%7Ccmmi10:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"winddoing.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.12.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content=Linux进程一共有6种状态，分别是：R、S、D、T、Z、X><meta property=og:type content=article><meta property=og:title content=Linux中进程的状态><meta property=og:url content=https://winddoing.github.io/post/a4fafb29.html><meta property=og:site_name content="Winddoing&#39;s Notes"><meta property=og:description content=Linux进程一共有6种状态，分别是：R、S、D、T、Z、X><meta property=og:locale content=zh_CN><meta property=og:image content=https://winddoing.github.io/images/2022/08/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE.png><meta property=article:published_time content=2022-08-15T03:14:00.000Z><meta property=article:modified_time content=2023-12-16T04:58:17.937Z><meta property=article:author content=winddoing><meta property=article:tag content=linux><meta property=article:tag content=进程><meta name=twitter:card content=summary><meta name=twitter:image content=https://winddoing.github.io/images/2022/08/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE.png><link rel=canonical href=https://winddoing.github.io/post/a4fafb29.html><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://winddoing.github.io/post/a4fafb29.html","path":"post/a4fafb29.html","title":"Linux中进程的状态"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Linux中进程的状态 | Winddoing's Notes</title><script src=/js/third-party/analytics/baidu-analytics.js></script><script async src=https://hm.baidu.com/hm.js?b96a560ce0a6bfbeaaddc59dc5888b75></script><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href="/" class=brand rel=start><i class=logo-line></i><p class=site-title>Winddoing's Notes</p><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Follow Excellent, Success will Chase you</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel=section><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel=section><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel=section><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E5%80%BC><span class=nav-number>1.</span> <span class=nav-text>进程状态值</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#R-%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E6%88%96%E5%A4%84%E4%BA%8E%E5%B0%B1%E7%BB%AA%E7%8A%B6%E6%80%81%EF%BC%88Running%EF%BC%89%E2%80%94%E2%80%94-TASK-RUNNING><span class=nav-number>1.1.</span> <span class=nav-text>R:正在运行或处于就绪状态（Running）—— TASK_RUNNING</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#S-%E5%8F%AF%E4%B8%AD%E6%96%AD%E7%9A%84%E7%9D%A1%E7%9C%A0%E7%8A%B6%E6%80%81%EF%BC%88Sleeping-%E2%80%94%E2%80%94-TASK-INTERRUPTIBLE><span class=nav-number>1.2.</span> <span class=nav-text>S:可中断的睡眠状态（Sleeping) —— TASK_INTERRUPTIBLE</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#D-%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E7%9A%84%E7%9D%A1%E7%9C%A0%E7%8A%B6%E6%80%81%EF%BC%88Disk-sleep%EF%BC%89%E2%80%94%E2%80%94-TASK-UNINTERRUPTIBLE><span class=nav-number>1.3.</span> <span class=nav-text>D:不可中断的睡眠状态（Disk sleep）—— TASK_UNINTERRUPTIBLE</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#vfork><span class=nav-number>1.3.1.</span> <span class=nav-text>vfork</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#T-%E6%9A%82%E5%81%9C%E6%88%96%E8%B7%9F%E8%B8%AA%E7%8A%B6%E6%80%81%EF%BC%88stopped%EF%BC%89%E2%80%94%E2%80%94-TASK-STOPPED-x2F-TASK-TRACED><span class=nav-number>1.4.</span> <span class=nav-text>T:暂停或跟踪状态（stopped）—— TASK_STOPPED&#x2F;TASK_TRACED</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#Z-%E5%83%B5%E5%B0%B8%E7%8A%B6%E6%80%81%EF%BC%88Zombies%EF%BC%89%E2%80%94%E2%80%94-TASK-DEAD-EXIT-ZOMBIE><span class=nav-number>1.5.</span> <span class=nav-text>Z:僵尸状态（Zombies）—— TASK_DEAD-EXIT_ZOMBIE</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%88%B6%E4%BD%9C%E4%B8%80%E4%B8%AA%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B><span class=nav-number>1.5.1.</span> <span class=nav-text>制作一个僵尸进程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#X-%E9%80%80%E5%87%BA%E7%8A%B6%E6%80%81%EF%BC%88dead%EF%BC%89%E2%80%94%E2%80%94-TASK-DEAD-EXIT-DEAD><span class=nav-number>1.6.</span> <span class=nav-text>X:退出状态（dead）—— TASK_DEAD-EXIT_DEAD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81><span class=nav-number>2.</span> <span class=nav-text>进程的初始状态</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E5%8F%98%E8%BF%81><span class=nav-number>3.</span> <span class=nav-text>进程状态变迁</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2><span class=nav-number>3.1.</span> <span class=nav-text>状态转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81><span class=nav-number>4.</span> <span class=nav-text>查看进程状态</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#STAT%E7%8A%B6%E6%80%81%E4%BD%8D><span class=nav-number>4.1.</span> <span class=nav-text>STAT状态位</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%85%B6%E4%BB%96><span class=nav-number>5.</span> <span class=nav-text>其他</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B><span class=nav-number>5.1.</span> <span class=nav-text>孤儿进程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8F%82%E8%80%83><span class=nav-number>6.</span> <span class=nav-text>参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=winddoing src=/images/Winddoing.jpg><p class=site-author-name itemprop=name>winddoing</p><div class=site-description itemprop=description>失败缘于忽视细处，成功始于重视小事</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href="/archives/"><span class=site-state-item-count>358</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class=site-state-item-count>112</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class=site-state-item-count>284</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL1dpbmRkb2luZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing"><i class="fab fa-github fa-fw"></i>GitHub</span></span> <span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly9naXRlZS5jb20vd2luZGRvaW5n title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing"><i class="fab fa-codiepie fa-fw"></i>Gitee</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy85NTY3MzYxL3dpbmRkb2luZw==" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9hcHAudHJhdmlzLWNpLmNvbS9naXRodWIvV2luZGRvaW5nL3dpbmRkb2luZy5naXRodWIuaW8=" title="Travis CI → https:&#x2F;&#x2F;app.travis-ci.com&#x2F;github&#x2F;Winddoing&#x2F;winddoing.github.io"><i class="fas fa-terminal fa-fw"></i>Travis CI</span></span></div><div class="cc-license site-overview-item animated" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg alt="Creative Commons"></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="link fa-fw"></i> Links</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cHM6Ly93aW5kZG9pbmcuZ2l0Ym9vay5pby9lbWJlZGRlZF9saW51eF9ub3Rlcy8=" title=https:&#x2F;&#x2F;winddoing.gitbook.io&#x2F;embedded_linux_notes&#x2F;>嵌入式相关</span></li><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2RyZWFtcQ==" title=http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq>CSDN</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cDovL3d3dy53b3dvdGVjaC5uZXQv title=http:&#x2F;&#x2F;www.wowotech.net&#x2F;>蜗窝科技</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpb25neGlhbnpl title=https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze>xiongxianze</span></li></ul></div><div id=days></div><script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("02/26/2014 15:00:00");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
}
show_date_time();
</script></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang=zh-CN><link itemprop=mainEntityOfPage href=https://winddoing.github.io/post/a4fafb29.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/Winddoing.jpg><meta itemprop=name content=winddoing></span> <span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Winddoing's Notes"><meta itemprop=description content=失败缘于忽视细处，成功始于重视小事></span> <span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="Linux中进程的状态 | Winddoing's Notes"><meta itemprop=description></span><header class=post-header><h1 class=post-title itemprop="name headline">Linux中进程的状态</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span> <span class=post-meta-item-text>发表于</span><time title="创建时间：2022-08-15 11:14:00" itemprop="dateCreated datePublished" datetime=2022-08-15T11:14:00+08:00>2022-08-15</time></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i></span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href="/categories/%E8%BF%9B%E7%A8%8B/" itemprop=url rel=index><span itemprop=name>进程</span></a></span></span> <span id=/post/a4fafb29.html class="post-meta-item leancloud_visitors" data-flag-title=Linux中进程的状态 title=阅读次数><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span class=leancloud-visitors-count></span></span> <span class=post-meta-item title=阅读次数 id=busuanzi_container_page_pv><span class=post-meta-item-icon><i class="far fa-eye"></i></span> <span class=post-meta-item-text>阅读次数：</span> <span id=busuanzi_value_page_pv></span></span> <span class=post-meta-break></span> <span class=post-meta-item title=本文字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span> <span class=post-meta-item-text>本文字数：</span> <span>4.9k</span></span> <span class=post-meta-item title=阅读时长><span class=post-meta-item-icon><i class="far fa-clock"></i></span> <span class=post-meta-item-text>阅读时长 &asymp;</span> <span>4 分钟</span></span></div></div></header><div class=post-body itemprop=articleBody><p>Linux进程一共有<code>6</code>种状态，分别是：<code>R</code>、<code>S</code>、<code>D</code>、<code>T</code>、<code>Z</code>、<code>X</code></p><span id=more></span><h2 id=进程状态值><a href=#进程状态值 class=headerlink title=进程状态值></a>进程状态值</h2><h3 id=R-正在运行或处于就绪状态（Running）——-TASK-RUNNING><a href=#R-正在运行或处于就绪状态（Running）——-TASK-RUNNING class=headerlink title="R:正在运行或处于就绪状态（Running）—— TASK_RUNNING"></a>R:正在运行或处于就绪状态（Running）—— TASK_RUNNING</h3><p><code>R状态</code>，表示该进程（任务）可以被CPU执行，但是不一定被CPU正在执行中，因为系统中同一时刻可能存在多个进程在可运行状态。</p><p>所有R状态的进程，都在<code>运行队列</code>中，由于一个CPU核关联了一个运行队列，因此一个进程只能出现在一个运行队列中。而何时被所属CPU执行取决于调度器。</p><h3 id=S-可中断的睡眠状态（Sleeping-——-TASK-INTERRUPTIBLE><a href=#S-可中断的睡眠状态（Sleeping-——-TASK-INTERRUPTIBLE class=headerlink title="S:可中断的睡眠状态（Sleeping) —— TASK_INTERRUPTIBLE"></a>S:可中断的睡眠状态（Sleeping) —— TASK_INTERRUPTIBLE</h3><p><code>S状态</code>，表示该进程由于等待某一事件（比如socket连接，等待信号量），而被挂起。</p><p>所有S状态的进行，将被放入对应事件的<code>等待队列</code>（等待队列可能存在很多,因为CPU是有限的，因此系统中的大多数进程处于睡眠状态，被放入相应的等待队列）中，当这些事件发生（由外部中断触发或其他进程触发）时，对应的等待队列中的一个或多个进程将被唤醒。</p><h3 id=D-不可中断的睡眠状态（Disk-sleep）——-TASK-UNINTERRUPTIBLE><a href=#D-不可中断的睡眠状态（Disk-sleep）——-TASK-UNINTERRUPTIBLE class=headerlink title="D:不可中断的睡眠状态（Disk sleep）—— TASK_UNINTERRUPTIBLE"></a>D:不可中断的睡眠状态（Disk sleep）—— TASK_UNINTERRUPTIBLE</h3><p>与<code>S状态</code>类似，进程处于睡眠状态，但是此时进程是<code>不可中断的</code>。</p><p><code>不可中断</code>：指的是该进程不响应异步信号，而不是CPU不响应外部信号。比如有些进程处于<code>D状态</code>时，我们无法通过kill -9将其杀死，也就是在ps中看到的进程状态几乎没有<code>D状态</code>。</p><p><code>D状态</code>（TASK_UNINTERRUPTIBLE）存在的意义： 内核中某些处理流程是不能被打断的，比如进程（任务）对某些硬件进行操作时（比如：I&#x2F;O读写操作等），可能需要使用TASK_UNINTERRUPTIBLE状态对进程进行保护，避免进程与外设交互的过程别打断，造成外设陷入不可控状态。</p><h4 id=vfork><a href=#vfork class=headerlink title=vfork></a>vfork</h4><p>linux系统中也存在容易捕捉的<code>TASK_UNINTERRUPTIBLE</code>状态。执行vfork系统调用后，父进程将进入TASK_UNINTERRUPTIBLE状态，直到子进程调用exit或exec（参见《神奇的vfork》）</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>	<span class=keyword>if</span> (!vfork()) sleep(<span class=number>100</span>);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>$ ps aux | grep &quot;a\.out&quot;</span><br><span class=line>xx    396037  0.0  0.0   2364   508 pts/1    D+   17:10   0:00 ./a.out</span><br><span class=line>xx    396038  0.0  0.0   2364   508 pts/1    S+   17:10   0:00 ./a.out</span><br></pre></td></tr></table></figure><h3 id=T-暂停或跟踪状态（stopped）——-TASK-STOPPED-x2F-TASK-TRACED><a href=#T-暂停或跟踪状态（stopped）——-TASK-STOPPED-x2F-TASK-TRACED class=headerlink title="T:暂停或跟踪状态（stopped）—— TASK_STOPPED&#x2F;TASK_TRACED"></a>T:暂停或跟踪状态（stopped）—— TASK_STOPPED&#x2F;TASK_TRACED</h3><p>向进程发送一个<code>SIGSTOP</code>信号，它就会因响应该信号而进入<code>TASK_STOPPED</code>状态（除非该进程本身处于<code>TASK_UNINTERRUPTIBLE</code>状态而不响应信号）。（SIGSTOP与SIGKILL信号一样，是强制的。不允许用户进程通过signal系列的系统调用重新设置对应的信号处理函数。）</p><p>向进程发送一个<code>SIGCONT</code>信号，可以让其从<code>TASK_STOPPED</code>状态恢复到<code>TASK_RUNNING</code>状态。</p><p>当进程正在被跟踪时，它处于<code>TASK_TRACED</code>这个特殊的状态。“正在被跟踪”指的是进程暂停下来，等待跟踪它的进程对它进行操作。比如在gdb中对被跟踪的进程下一个断点，进程在断点处停下来的时候就处于TASK_TRACED状态。而在其他时候，被跟踪的进程还是处于前面提到的那些状态。</p><p>对于进程本身来说，<code>TASK_STOPPED</code>和<code>TASK_TRACED</code>状态很类似，都是表示进程暂停下来。而<code>TASK_TRACED</code>状态相当于在<code>TASK_STOPPED</code>之上多了一层保护，处于<code>TASK_TRACED</code>状态的进程不能响应SIGCONT信号而被唤醒。只能等到调试进程通过<code>ptrace</code>系统调用执行PTRACE_CONT、PTRACE_DETACH等操作（通过ptrace系统调用的参数指定操作），或调试进程退出，被调试的进程才能恢复<code>TASK_RUNNING</code>状态。</p><h3 id=Z-僵尸状态（Zombies）——-TASK-DEAD-EXIT-ZOMBIE><a href=#Z-僵尸状态（Zombies）——-TASK-DEAD-EXIT-ZOMBIE class=headerlink title="Z:僵尸状态（Zombies）—— TASK_DEAD-EXIT_ZOMBIE"></a>Z:僵尸状态（Zombies）—— TASK_DEAD-EXIT_ZOMBIE</h3><p>进程在退出的过程中，处于<code>TASK_DEAD</code>状态。</p><p>在这个退出过程中，进程占有的所有资源将被回收，除了task_struct结构（以及少数资源）以外。于是进程就只剩下task_struct这么个空壳，故称为<code>僵尸</code>。</p><p>之所以保留task_struct，是因为task_struct里面保存了进程的<code>退出码</code>、以及一些统计信息。而其父进程很可能会关心这些信息。比如在shell中，$?变量就保存了最后一个退出的前台进程的退出码，而这个退出码往往被作为if语句的判断条件。</p><p>当然，内核也可以将这些信息保存在别的地方，而将task_struct结构释放掉，以节省一些空间。但是使用task_struct结构更为方便，因为在内核中已经建立了从pid到task_struct查找关系，还有进程间的父子关系。释放掉task_struct，则需要建立一些新的数据结构，以便让父进程找到它的子进程的退出信息。</p><p>父进程可以通过wait系列的系统调用（如wait4、waitid）来等待某个或某些子进程的退出，并获取它的退出信息。然后wait系列的系统调用会顺便将子进程的尸体（task_struct）也释放掉。</p><p>子进程在退出的过程中，内核会给其父进程发送一个信号，通知父进程来“收尸”。这个信号默认是<code>SIGCHLD</code>，但是在通过clone系统调用创建子进程时，可以设置这个信号。</p><p>只要父进程不退出，这个僵尸状态的子进程就一直存在。那么如果父进程退出了呢，谁又来给子进程“收尸”？</p><ul><li>当进程退出的时候，会将它的所有子进程都托管给别的进程（使之成为别的进程的子进程）。托管给谁呢？可能是退出进程所在进程组的下一个进程（如果存在的话），或者是1号进程。所以每个进程、每时每刻都有父进程存在。除非它是1号进程。</li></ul><blockquote><p><code>1号进程</code>（init进程）的作用：</p><ol><li>执行系统初始化脚本，创建一系列进程</li><li>在一个死循环中等待子进程的退出事件，并通过调用waitid系统调用来完成“收尸”工作。<br>init进程不会被暂停、也不会被杀死（这是由内核来保证的）。它在等待子进程退出的过程中处于TASK_INTERRUPTIBLE状态，“收尸”过程中则处于TASK_RUNNING状态。</li></ol></blockquote><h4 id=制作一个僵尸进程><a href=#制作一个僵尸进程 class=headerlink title=制作一个僵尸进程></a>制作一个僵尸进程</h4><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>include</span> <span class=string>&lt;stdio.h&gt;</span></span></span><br><span class=line></span><br><span class=line><span class=type>void</span> <span class="title function_">main</span><span class=params>()</span></span><br><span class=line>&#123;</span><br><span class=line>	<span class=keyword>if</span> (fork())</span><br><span class=line>		<span class=keyword>while</span>(<span class=number>1</span>) sleep(<span class=number>100</span>);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>$ ps aux | grep &quot;a\.out&quot;</span><br><span class=line>xx    399198  0.0  0.0   2364   508 pts/1    S    17:35   0:00 ./a.out</span><br><span class=line>xx    399201  0.0  0.0      0     0 pts/1    Z    17:35   0:00 [a.out] &lt;defunct&gt;</span><br></pre></td></tr></table></figure><p>杀死僵尸进程时，必须杀死其父进程，让父进程回收僵尸进程。</p><h3 id=X-退出状态（dead）——-TASK-DEAD-EXIT-DEAD><a href=#X-退出状态（dead）——-TASK-DEAD-EXIT-DEAD class=headerlink title="X:退出状态（dead）—— TASK_DEAD-EXIT_DEAD"></a>X:退出状态（dead）—— TASK_DEAD-EXIT_DEAD</h3><p>进程在退出过程中也可能不会保留它的task_struct。比如这个进程是多线程程序中被detach过的进程</p><p>此时，进程将被置于<code>EXIT_DEAD</code>退出状态，这意味着接下来的代码立即就会将该进程彻底释放。所以EXIT_DEAD状态是非常短暂的，几乎不可能通过ps命令捕捉到。</p><h2 id=进程的初始状态><a href=#进程的初始状态 class=headerlink title=进程的初始状态></a>进程的初始状态</h2><p>进程是通过<code>fork</code>系列的系统调用（fork、clone、vfork）来创建的，内核（或内核模块）也可以通过<code>kernel_thread</code>函数创建内核进程。这些创建子进程的函数本质上都完成了相同的功能——将调用进程复制一份，得到子进程。（可以通过选项参数来决定各种资源是共享、还是私有）</p><p>那么既然调用进程处于<code>TASK_RUNNING</code>状态（否则，它若不是正在运行，又怎么进行调用？），则子进程默认也处于<code>TASK_RUNNING</code>状态。</p><p>另外，在系统调用调用clone和内核函数kernel_thread也接受CLONE_STOPPED选项，从而将子进程的初始状态置为 TASK_STOPPED。</p><h2 id=进程状态变迁><a href=#进程状态变迁 class=headerlink title=进程状态变迁></a>进程状态变迁</h2><p>原则：进程状态的变迁却只有两个方向</p><ul><li><strong>从<code>TASK_RUNNING</code>状态变为<code>非TASK_RUNNING</code>状态</strong></li><li><strong>从<code>非TASK_RUNNING</code>状态变为<code>TASK_RUNNING</code>状态</strong></li></ul><p>也就是说，如果给一个<code>TASK_INTERRUPTIBLE</code>状态的进程发送SIGKILL信号，这个进程将先被唤醒（进入<code>TASK_RUNNING</code>状态），然后再响应SIGKILL信号而退出（变为<code>TASK_DEAD</code>状态）; 并不会从<code>TASK_INTERRUPTIBLE</code>状态直接退出。</p><p>进程从<code>非TASK_RUNNING</code>状态变为<code>TASK_RUNNING</code>状态，是由别的进程（也可能是中断处理程序）执行唤醒操作来实现的。执行唤醒的进程设置被唤醒进程的状态为TASK_RUNNING，然后将其task_struct结构加入到某个CPU的可执行队列中。于是被唤醒的进程将有机会被调度执行。</p><p>而进程从<code>TASK_RUNNING</code>状态变为<code>非TASK_RUNNING</code>状态，则有两种途径：</p><ul><li>响应信号而进入TASK_STOPED状态、或TASK_DEAD状态；</li><li>执行系统调用主动进入TASK_INTERRUPTIBLE状态（如nanosleep系统调用）、或TASK_DEAD状态（如exit系统调用）；或由于执行系统调用需要的资源得不到满足，而进入TASK_INTERRUPTIBLE状态或TASK_UNINTERRUPTIBLE状态（如select系统调用）</li></ul><h3 id=状态转换><a href=#状态转换 class=headerlink title=状态转换></a>状态转换</h3><p><img data-src=/images/2022/08/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2%E5%9B%BE.png alt=进程状态转换图></p><h2 id=查看进程状态><a href=#查看进程状态 class=headerlink title=查看进程状态></a>查看进程状态</h2><p>我们可以通过<code>ps</code>命令查看系统中各个进程的状态</p><ul><li>在busybox中可以使用以下命令参数：<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>ps -o comm,pid,ppid,pgid,vsz,sid,stat,rss</span><br></pre></td></tr></table></figure></li><li>在正常系统中可以使用：<figure class="highlight shell"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>ps -elf</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br></pre></td><td class=code><pre><span class=line># ps -o comm,pid,ppid,pgid,vsz,sid,stat,rss</span><br><span class=line>COMMAND          PID   PPID  PGID  VSZ  SID   STAT RSS</span><br><span class=line>init                 1     0     1 2792     1 S     456</span><br><span class=line>kthreadd             2     0     0    0     0 SW      0</span><br><span class=line>rcu_gp               3     2     0    0     0 IW&lt;     0</span><br><span class=line>rcu_par_gp           4     2     0    0     0 IW&lt;     0</span><br><span class=line>kworker/u4:0-ev      7     2     0    0     0 IW      0</span><br><span class=line>mm_percpu_wq         8     2     0    0     0 IW&lt;     0</span><br><span class=line>ksoftirqd/0          9     2     0    0     0 SW      0</span><br><span class=line>rcu_sched           10     2     0    0     0 IW      0</span><br><span class=line>migration/0         11     2     0    0     0 SW      0</span><br><span class=line>kworker/0:1-eve     12     2     0    0     0 IW      0</span><br><span class=line>cpuhp/0             13     2     0    0     0 SW      0</span><br><span class=line>cpuhp/1             14     2     0    0     0 SW      0</span><br><span class=line>migration/1         15     2     0    0     0 SW      0</span><br><span class=line>ksoftirqd/1         16     2     0    0     0 SW      0</span><br><span class=line>kdevtmpfs           19     2     0    0     0 SW      0</span><br><span class=line>netns               20     2     0    0     0 IW&lt;     0</span><br><span class=line>khungtaskd          21     2     0    0     0 SW      0</span><br><span class=line>oom_reaper          22     2     0    0     0 SW      0</span><br><span class=line>writeback           23     2     0    0     0 IW&lt;     0</span><br></pre></td></tr></table></figure><h3 id=STAT状态位><a href=#STAT状态位 class=headerlink title=STAT状态位></a>STAT状态位</h3><table><thead><tr><th align=center>STAT</th><th align=left>描述</th></tr></thead><tbody><tr><td align=center><code>I</code></td><td align=left>空闲内核线程（idle）</td></tr><tr><td align=center><code>R</code></td><td align=left>运行或可运行（在运行队列上）</td></tr><tr><td align=center><code>S</code></td><td align=left>可中断睡眠（等待事件完成）</td></tr><tr><td align=center><code>D</code></td><td align=left>不可中断睡眠（通常是IO）</td></tr><tr><td align=center><code>T</code></td><td align=left>由job控制信号停止</td></tr><tr><td align=center><code>Z</code></td><td align=left>僵尸进程，终止但未被其父进程收割</td></tr><tr><td align=center><code>X</code></td><td align=left>进程死了（永远不应该被看到）</td></tr><tr><td align=center><code>W</code></td><td align=left>分页（自 2.6.xx 内核起无效）</td></tr><tr><td align=center><code>t</code></td><td align=left>在跟踪（tracing）期间被调试器停止</td></tr><tr><td align=center><code>&lt;</code></td><td align=left>高优先级</td></tr><tr><td align=center><code>N</code></td><td align=left>低优先级</td></tr><tr><td align=center><code>L </code></td><td align=left>将页面锁定到内存中（用于实时和自定义IO）</td></tr><tr><td align=center><code>s</code></td><td align=left>会话负责</td></tr><tr><td align=center><code>|</code></td><td align=left>多线程（使用 CLONE_THREAD，就像 NPTL pthreads 一样）</td></tr><tr><td align=center><code>+</code></td><td align=left>在前台进程组中</td></tr></tbody></table><h2 id=其他><a href=#其他 class=headerlink title=其他></a>其他</h2><h3 id=孤儿进程><a href=#孤儿进程 class=headerlink title=孤儿进程></a>孤儿进程</h3><p>所谓孤儿进程，顾名思义，跟现实中的孤儿类似，当一个进程的父进程结束时，但是他自己还没有结束，那么该进程就变为孤儿进程。</p><p>孤儿进程会被init进程（1号进程）的进程收养，当然在子进程结束时也会由init进程完成对它的状态收集工作，因此一般来说，孤儿进程并不会有什么危害。</p><h2 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h2><ol><li><span class=exturl data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ5NjEzNTU3L2FydGljbGUvZGV0YWlscy8xMjAyOTQ5MDg=">Linux中进程的六种状态<i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veWZjZXNoaS9wLzY4MDAwNjkuaHRtbCM6fjp0ZXh0PVRBU0tfU1RPLE5JTkclRTclOEElQjYlRTYlODAlODElRUYlQkMlODklRTMlODAlODI=">进程资源和进程状态 TASK_RUNNING TASK_INTERRUPTIBLE TASK_UNINTERRUPTIBLE <i class="fa fa-external-link-alt"></i></span></li><li><span class=exturl data-url=aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vcHJvZ3JhbW1lci10bGgvcC8xMTU5MzMzMC5odG1s>Linux进程状态(ps stat)详解<i class="fa fa-external-link-alt"></i></span></li></ol></div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者：</strong>winddoing</li><li class=post-copyright-link><strong>本文链接：</strong> <a href=https://winddoing.github.io/post/a4fafb29.html title=Linux中进程的状态>https://winddoing.github.io/post/a4fafb29.html</a></li><li class=post-copyright-license><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <span class=exturl data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class=post-tags><a href="/tags/linux/" rel=tag><i class="fa fa-tag"></i> linux</a> <a href="/tags/%E8%BF%9B%E7%A8%8B/" rel=tag><i class="fa fa-tag"></i> 进程</a></div><div class=post-nav><div class=post-nav-item><a href=/post/2711c03c.html rel=prev title=音频编码格式><i class="fa fa-chevron-left"></i> 音频编码格式</a></div><div class=post-nav-item><a href=/post/c90e9769.html rel=next title=linux系统下修改uboot环境变量>linux系统下修改uboot环境变量 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2014 – <span itemprop=copyrightYear>2023</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>winddoing</span></div><div class=wordcount><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-chart-line"></i></span> <span title=站点总字数>1.1m</span></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-coffee"></i></span> <span title=站点阅读时长>16:21</span></span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv><span class=post-meta-item-icon><i class="fa fa-users"></i></span> <span class=site-uv title=总访客量><span id=busuanzi_value_site_uv></span></span></span> <span class=post-meta-item id=busuanzi_container_site_pv><span class=post-meta-item-icon><i class="fa fa-eye"></i></span> <span class=site-pv title=总访问量><span id=busuanzi_value_site_pv></span></span></span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 强力驱动</div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/muse.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src=/js/third-party/tags/pdf.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script><script src=/js/third-party/tags/mermaid.js></script><script src=/js/third-party/fancybox.js></script><script data-pjax async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=leancloud_visitors type=application/json>{"enable":true,"app_id":"Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz","app_key":"tgUTq5bX3fVmn916EMRe65eJ","server_url":null,"security":false}</script><script src=/js/third-party/statistics/lean-analytics.js></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script><script src=/js/third-party/math/mathjax.js></script><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"Winddoing/winddoing.github.io","issue_term":"title","theme":"github-light"}</script><script src=/js/third-party/comments/utterances.js></script></body></html>