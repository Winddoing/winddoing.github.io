<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222 media="(prefers-color-scheme: light)"><meta name=theme-color content=#222 media="(prefers-color-scheme: dark)"><meta name=generator content="Hexo 6.2.0"><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preconnect href=https://cdnjs.cloudflare.com crossorigin><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/favicon.ico><link rel=mask-icon href=/images/logo.svg color=#222><meta name=baidu-site-verification content=WIIeufYjj6><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Microsoft+YaHei:300,300italic,400,400italic,700,700italic%7Ccmmi10:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"winddoing.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.12.1","exturl":true,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content="Redis源码分析 下载源码12$ git clone https:&#x2F;&#x2F;github.com&#x2F;antirez&#x2F;redis.git$ git checkout -b 4.0 4.0.11 编译&amp;运行123make.&#x2F;redis-server.&#x2F;redis-cli 文件目录程序入口main函数与相关文件的关系和作用： 123456dict.c:1151:int main(int"><meta property=og:type content=website><meta property=og:title content=Redis><meta property=og:url content=https://winddoing.github.io/books/redis/index.html><meta property=og:site_name content="Winddoing&#39;s Notes"><meta property=og:description content="Redis源码分析 下载源码12$ git clone https:&#x2F;&#x2F;github.com&#x2F;antirez&#x2F;redis.git$ git checkout -b 4.0 4.0.11 编译&amp;运行123make.&#x2F;redis-server.&#x2F;redis-cli 文件目录程序入口main函数与相关文件的关系和作用： 123456dict.c:1151:int main(int"><meta property=og:locale content=zh_CN><meta property=og:image content=https://winddoing.github.io/images/2018/09/redis_adlist.png><meta property=og:image content=https://winddoing.github.io/images/2018/09/redis_adlist_struct.png><meta property=article:published_time content=2018-08-26T00:07:24.000Z><meta property=article:modified_time content=2023-12-16T04:58:17.941Z><meta property=article:author content=winddoing><meta property=article:tag content=winddoing,嵌入式,Linux,kernel,shell,C语言,网络,mips,arm,arm64,虚拟化><meta name=twitter:card content=summary><meta name=twitter:image content=https://winddoing.github.io/images/2018/09/redis_adlist.png><link rel=canonical href="https://winddoing.github.io/books/redis/"><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":false,"lang":"zh-CN","comments":"","permalink":"https://winddoing.github.io/books/redis/index.html","path":"books/redis/index.html","title":"Redis"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Redis | Winddoing's Notes</title><script src=/js/third-party/analytics/baidu-analytics.js></script><script async src=https://hm.baidu.com/hm.js?b96a560ce0a6bfbeaaddc59dc5888b75></script><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href="/" class=brand rel=start><i class=logo-line></i><p class=site-title>Winddoing's Notes</p><i class=logo-line></i></a><p class=site-subtitle itemprop=description>Follow Excellent, Success will Chase you</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel=section><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel=section><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel=section><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81><span class=nav-number>1.</span> <span class=nav-text>下载源码</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%96%E8%AF%91-amp-%E8%BF%90%E8%A1%8C><span class=nav-number>2.</span> <span class=nav-text>编译&amp;运行</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95><span class=nav-number>3.</span> <span class=nav-text>文件目录</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#Makefile><span class=nav-number>4.</span> <span class=nav-text>Makefile</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6><span class=nav-number>4.1.</span> <span class=nav-text>可执行文件</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#redis-server><span class=nav-number>4.2.</span> <span class=nav-text>redis-server</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#redis-cli><span class=nav-number>4.3.</span> <span class=nav-text>redis-cli</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#redis-benchmark><span class=nav-number>4.4.</span> <span class=nav-text>redis-benchmark</span></a></li></ol></li><li class="nav-item nav-level-2"><a class=nav-link href=#Server><span class=nav-number>5.</span> <span class=nav-text>Server</span></a></li><li class="nav-item nav-level-2"><a class=nav-link href=#Client><span class=nav-number>6.</span> <span class=nav-text>Client</span></a></li></ol><li class="nav-item nav-level-1"><a class=nav-link href=#Redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0><span class=nav-number></span> <span class=nav-text>Redis设计与实现</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2><span class=nav-number>1.</span> <span class=nav-text>第二章 简单动态字符串</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#SDS><span class=nav-number>1.1.</span> <span class=nav-text>SDS</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4><span class=nav-number>1.1.1.</span> <span class=nav-text>存储空间</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#SDS-API><span class=nav-number>1.1.2.</span> <span class=nav-text>SDS API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#Test-Code><span class=nav-number>1.2.</span> <span class=nav-text>Test Code</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#List><span class=nav-number>1.3.</span> <span class=nav-text>List</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Redis%E9%93%BE%E8%A1%A8%E5%AE%9E%E7%8E%B0%E7%89%B9%E6%80%A7><span class=nav-number>1.3.1.</span> <span class=nav-text>Redis链表实现特性</span></a></li></ol></li></ol></li></ol></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=winddoing src=/images/Winddoing.jpg><p class=site-author-name itemprop=name>winddoing</p><div class=site-description itemprop=description>失败缘于忽视细处，成功始于重视小事</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href="/archives/"><span class=site-state-item-count>358</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class=site-state-item-count>112</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class=site-state-item-count>284</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9naXRodWIuY29tL1dpbmRkb2luZw==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Winddoing"><i class="fab fa-github fa-fw"></i>GitHub</span></span> <span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly9naXRlZS5jb20vd2luZGRvaW5n title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;winddoing"><i class="fab fa-codiepie fa-fw"></i>Gitee</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy85NTY3MzYxL3dpbmRkb2luZw==" title="StackOverflow → https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;9567361&#x2F;winddoing"><i class="fab fa-stack-overflow fa-fw"></i>StackOverflow</span></span> <span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly9hcHAudHJhdmlzLWNpLmNvbS9naXRodWIvV2luZGRvaW5nL3dpbmRkb2luZy5naXRodWIuaW8=" title="Travis CI → https:&#x2F;&#x2F;app.travis-ci.com&#x2F;github&#x2F;Winddoing&#x2F;winddoing.github.io"><i class="fas fa-terminal fa-fw"></i>Travis CI</span></span></div><div class="cc-license site-overview-item animated" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg alt="Creative Commons"></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="link fa-fw"></i> Links</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cHM6Ly93aW5kZG9pbmcuZ2l0Ym9vay5pby9lbWJlZGRlZF9saW51eF9ub3Rlcy8=" title=https:&#x2F;&#x2F;winddoing.gitbook.io&#x2F;embedded_linux_notes&#x2F;>嵌入式相关</span></li><li class=links-of-blogroll-item><span class=exturl data-url="aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2RyZWFtcQ==" title=http:&#x2F;&#x2F;blog.csdn.net&#x2F;sdreamq>CSDN</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cDovL3d3dy53b3dvdGVjaC5uZXQv title=http:&#x2F;&#x2F;www.wowotech.net&#x2F;>蜗窝科技</span></li><li class=links-of-blogroll-item><span class=exturl data-url=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpb25neGlhbnpl title=https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiongxianze>xiongxianze</span></li></ul></div><div id=days></div><script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("02/26/2014 15:00:00");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
    if (i<10)
    {i="0" + i};
    return i;
}
show_date_time();
</script></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner page posts-expand"><div class=post-block lang=zh-CN><header class=post-header><h1 class=post-title itemprop="name headline">Redis</h1><div class=post-meta-container><ul class=breadcrumb><li><a href="/books/">BOOKS</a></li><li>REDIS</li></ul></div></header><div class=post-body><blockquote class=blockquote-center><p>Redis源码分析</p></blockquote><h2 id=下载源码><a href=#下载源码 class=headerlink title=下载源码></a>下载源码</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line>$ git clone https://github.com/antirez/redis.git</span><br><span class=line>$ git checkout -b 4.0 4.0.11</span><br></pre></td></tr></table></figure><h2 id=编译-amp-运行><a href=#编译-amp-运行 class=headerlink title=编译&amp;运行></a>编译&amp;运行</h2><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><span class=line>make</span><br><span class=line>./redis-server</span><br><span class=line>./redis-cli</span><br></pre></td></tr></table></figure><h2 id=文件目录><a href=#文件目录 class=headerlink title=文件目录></a>文件目录</h2><p>程序入口<code>main</code>函数与相关文件的关系和作用：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>dict.c:1151:int main(int argc, char **argv)   //字典和哈希表的实现</span><br><span class=line>redis-benchmark.c:648:int main(int argc, const char **argv)   //Redis性能测试工具</span><br><span class=line>redis-cli.c:2849:int main(int argc, char **argv)  //Redis的Client入口</span><br><span class=line>sds.c:1282:int main(void)   //Redis字符串实现</span><br><span class=line>server.c:3709:int main(int argc, char **argv)  //Redis的Server入口</span><br><span class=line>siphash.c:350:int main(void)    //非加密的64位哈希算法的实现</span><br></pre></td></tr></table></figure><blockquote><p>dir:src</p></blockquote><p>这里主要从<code>Server</code>和<code>Client</code>这两个入口进行简单分析：</p><h2 id=Makefile><a href=#Makefile class=headerlink title=Makefile></a>Makefile</h2><p>从Makefile文件中可以得到，Redis最终编译完成后，生成的可执行文件和其所依赖的相关源码文件，方便认识Radis源码的基本结构。</p><h3 id=可执行文件><a href=#可执行文件 class=headerlink title=可执行文件></a>可执行文件</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre></td><td class=code><pre><span class=line>REDIS_SERVER_NAME=redis-server</span><br><span class=line>REDIS_SENTINEL_NAME=redis-sentinel</span><br><span class=line>REDIS_CLI_NAME=redis-cli</span><br><span class=line>REDIS_BENCHMARK_NAME=redis-benchmark</span><br><span class=line>REDIS_CHECK_RDB_NAME=redis-check-rdb</span><br><span class=line>REDIS_CHECK_AOF_NAME=redis-check-aof</span><br></pre></td></tr></table></figure><table><thead><tr><th align=center>文件</th><th align=left>作用</th></tr></thead><tbody><tr><td align=center>redis-server</td><td align=left>Server端</td></tr><tr><td align=center>redis-sentinel</td><td align=left>分布式</td></tr><tr><td align=center>redis-cli</td><td align=left>Client端</td></tr><tr><td align=center>redis-benchmark</td><td align=left>性能测试工具</td></tr><tr><td align=center>redis-check-rdb</td><td align=left></td></tr><tr><td align=center>redis-check-aof</td><td align=left></td></tr></tbody></table><h3 id=redis-server><a href=#redis-server class=headerlink title=redis-server></a>redis-server</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>REDIS_SERVER_OBJ=adlist.o quicklist.o ae.o anet.o dict.o server.o sds.o zmalloc.o lzf_c.o lzf_d.o pqsort.o zipmap.o sha1.o ziplist.o release.o networking.o util.o object.o db.o replication.o rdb.o t_string.o t_list.o t_set.o t_zset.o t_hash.o config.o aof.o pubsub.o multi.o debug.o sort.o intset.o syncio.o cluster.o crc16.o endianconv.o slowlog.o scripting.o bio.o rio.o rand.o memtest.o crc64.o bitops.o sentinel.o notify.o setproctitle.o blocked.o hyperloglog.o latency.o sparkline.o redis-check-rdb.o redis-check-aof.o geo.o lazyfree.o module.o evict.o expire.o geohash.o geohash_helper.o childinfo.o defrag.o siphash.o rax.o</span><br></pre></td></tr></table></figure><h3 id=redis-cli><a href=#redis-cli class=headerlink title=redis-cli></a>redis-cli</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>REDIS_CLI_OBJ=anet.o adlist.o redis-cli.o zmalloc.o release.o anet.o ae.o crc64.o</span><br></pre></td></tr></table></figure><h3 id=redis-benchmark><a href=#redis-benchmark class=headerlink title=redis-benchmark></a>redis-benchmark</h3><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><span class=line>REDIS_BENCHMARK_OBJ=ae.o anet.o redis-benchmark.o adlist.o zmalloc.o redis-benchmark.o</span><br></pre></td></tr></table></figure><h2 id=Server><a href=#Server class=headerlink title=Server></a>Server</h2><p>模式：<code>sentinel</code> 、<code>cluster</code></p><ul><li>cluster : 集群模式</li><li>sentinel : 哨兵模式</li></ul><p>事件驱动：<code>ae</code></p><h2 id=Client><a href=#Client class=headerlink title=Client></a>Client</h2><h1 id=Redis设计与实现><a href=#Redis设计与实现 class=headerlink title=Redis设计与实现></a>Redis设计与实现</h1><h2 id=第二章-简单动态字符串><a href=#第二章-简单动态字符串 class=headerlink title="第二章 简单动态字符串"></a>第二章 简单动态字符串</h2><p>Redis没有直接使用C语言中的字符串，而是自己构建了SDS这样的一种简单动态字符串，并且将他作为Redis中字符串的默认的表示，个人认为，Redis并未完全抛弃C语言字符串，只不过是在C语言字符串的基础上，通过封装其他的属性，构造出一个更加高效的字符串的封装结构，<code>记录长度</code>、<code>分配内存大小（除去‘\0’）</code>、<code>标志位（低三位表示类型，其余五位未使用）</code>、以及<code>字符数组</code>。</p><h3 id=SDS><a href=#SDS class=headerlink title=SDS></a>SDS</h3><p>字符串是Redis中最基本的数据，Redis使用key作为存取value的唯一标示符，而key的通俗理解就是字符串。</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>typedef</span> <span class=type>char</span> *sds;</span><br><span class=line></span><br><span class=line><span class=comment>/* Note: sdshdr5 is never used, we just access the flags byte directly.</span></span><br><span class=line><span class=comment> * However is here to document the layout of type 5 SDS strings. */</span></span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>attribute__</span> ((__<span class=title>packed__</span>)) <span class=title>sdshdr5</span> &#123;</span></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> flags; <span class=comment>/* 3 lsb of type, and 5 msb of string length */</span></span><br><span class=line>    <span class=type>char</span> buf[];</span><br><span class=line>&#125;;</span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>attribute__</span> ((__<span class=title>packed__</span>)) <span class=title>sdshdr8</span> &#123;</span></span><br><span class=line>    <span class=type>uint8_t</span> len; <span class=comment>/* used */</span></span><br><span class=line>    <span class=type>uint8_t</span> alloc; <span class=comment>/* excluding the header and null terminator */</span></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> flags; <span class=comment>/* 3 lsb of type, 5 unused bits */</span></span><br><span class=line>    <span class=type>char</span> buf[];</span><br><span class=line>&#125;;</span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>attribute__</span> ((__<span class=title>packed__</span>)) <span class=title>sdshdr16</span> &#123;</span></span><br><span class=line>    <span class=type>uint16_t</span> len; <span class=comment>/* used */</span></span><br><span class=line>    <span class=type>uint16_t</span> alloc; <span class=comment>/* excluding the header and null terminator */</span></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> flags; <span class=comment>/* 3 lsb of type, 5 unused bits */</span></span><br><span class=line>    <span class=type>char</span> buf[];</span><br><span class=line>&#125;;</span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>attribute__</span> ((__<span class=title>packed__</span>)) <span class=title>sdshdr32</span> &#123;</span></span><br><span class=line>    <span class=type>uint32_t</span> len; <span class=comment>/* used */</span></span><br><span class=line>    <span class=type>uint32_t</span> alloc; <span class=comment>/* excluding the header and null terminator */</span></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> flags; <span class=comment>/* 3 lsb of type, 5 unused bits */</span></span><br><span class=line>    <span class=type>char</span> buf[];</span><br><span class=line>&#125;;</span><br><span class=line><span class=class><span class=keyword>struct</span> __<span class=title>attribute__</span> ((__<span class=title>packed__</span>)) <span class=title>sdshdr64</span> &#123;</span></span><br><span class=line>    <span class=type>uint64_t</span> len; <span class=comment>/* used */</span></span><br><span class=line>    <span class=type>uint64_t</span> alloc; <span class=comment>/* excluding the header and null terminator */</span></span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> flags; <span class=comment>/* 3 lsb of type, 5 unused bits */</span></span><br><span class=line>    <span class=type>char</span> buf[];</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>多种结构的sds结构体的定义，个人理解是为了不同长度的字符串所使用，可以更好的利用内存空间。</p></blockquote><ul><li>len： 字符串长度</li><li>alloc：申请的内存大小</li><li>flags：标记结构体类型</li><li>buf： 字符串的首地址</li></ul><p>flags类型：</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_5  0</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_8  1</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_16 2</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_32 3</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_64 4</span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_MASK 7</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> SDS_TYPE_BITS 3</span></span><br></pre></td></tr></table></figure><h4 id=存储空间><a href=#存储空间 class=headerlink title=存储空间></a>存储空间</h4><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>+-----+-------+-------+--------------------------------------------+</span><br><span class=line>| len | alloc | flags |                                         |\0|</span><br><span class=line>+-----+-------+-------+--------------------------------------------+</span><br><span class=line>       header                               data</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br></pre></td><td class=code><pre><span class=line>sds <span class="title function_">sdsnewlen</span><span class=params>(<span class=type>const</span> <span class=type>void</span> *init, <span class=type>size_t</span> initlen)</span> &#123;</span><br><span class=line>    <span class=type>void</span> *sh;</span><br><span class=line>    sds s;</span><br><span class=line>    <span class=type>char</span> type = sdsReqType(initlen);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;===&gt; func: %s, line: %d, file: %s, type=%d, initlen=%d\n&quot;</span>, __func__, __LINE__, __FILE__, type, initlen);</span><br><span class=line>    <span class=comment>/* Empty strings are usually created in order to append. Use type 8</span></span><br><span class=line><span class=comment>     * since type 5 is not good at this. */</span></span><br><span class=line>    <span class=keyword>if</span> (type == SDS_TYPE_5 &amp;&amp; initlen == <span class=number>0</span>) type = SDS_TYPE_8;</span><br><span class=line>    <span class=type>int</span> hdrlen = sdsHdrSize(type);</span><br><span class=line>    <span class=built_in>printf</span>(<span class=string>&quot;===&gt; func: %s, line: %d, file: %s, type=%d, initlen=%d, hdrlen=%d\n&quot;</span>, __func__, __LINE__, __FILE__, type, initlen, hdrlen);</span><br><span class=line>    <span class=type>unsigned</span> <span class=type>char</span> *fp; <span class=comment>/* flags pointer. */</span></span><br><span class=line></span><br><span class=line>    sh = s_malloc(hdrlen+initlen+<span class=number>1</span>);</span><br><span class=line>    <span class=keyword>if</span> (!init)</span><br><span class=line>        <span class=built_in>memset</span>(sh, <span class=number>0</span>, hdrlen+initlen+<span class=number>1</span>);</span><br><span class=line>    <span class=keyword>if</span> (sh == <span class=literal>NULL</span>) <span class=keyword>return</span> <span class=literal>NULL</span>;</span><br><span class=line>    s = (<span class=type>char</span>*)sh+hdrlen;</span><br><span class=line>    fp = ((<span class=type>unsigned</span> <span class=type>char</span>*)s)<span class=number>-1</span>;</span><br><span class=line>    <span class=keyword>switch</span>(type) &#123;</span><br><span class=line>        <span class=keyword>case</span> SDS_TYPE_5: &#123;</span><br><span class=line>            *fp = type | (initlen &lt;&lt; SDS_TYPE_BITS);</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>case</span> SDS_TYPE_8: &#123;</span><br><span class=line>            SDS_HDR_VAR(<span class=number>8</span>,s);</span><br><span class=line>            sh-&gt;len = initlen;</span><br><span class=line>            sh-&gt;alloc = initlen;</span><br><span class=line>            *fp = type;</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>case</span> SDS_TYPE_16: &#123;</span><br><span class=line>            SDS_HDR_VAR(<span class=number>16</span>,s);</span><br><span class=line>            sh-&gt;len = initlen;</span><br><span class=line>            sh-&gt;alloc = initlen;</span><br><span class=line>            *fp = type;</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>case</span> SDS_TYPE_32: &#123;</span><br><span class=line>            SDS_HDR_VAR(<span class=number>32</span>,s);</span><br><span class=line>            sh-&gt;len = initlen;</span><br><span class=line>            sh-&gt;alloc = initlen;</span><br><span class=line>            *fp = type;</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        &#125;</span><br><span class=line>        <span class=keyword>case</span> SDS_TYPE_64: &#123;</span><br><span class=line>            SDS_HDR_VAR(<span class=number>64</span>,s);</span><br><span class=line>            sh-&gt;len = initlen;</span><br><span class=line>            sh-&gt;alloc = initlen;</span><br><span class=line>            *fp = type;</span><br><span class=line>            <span class=keyword>break</span>;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>    <span class=keyword>if</span> (initlen &amp;&amp; init)</span><br><span class=line>        <span class=built_in>memcpy</span>(s, init, initlen);</span><br><span class=line>    s[initlen] = <span class=string>&#x27;\0&#x27;</span>;</span><br><span class=line>    <span class=keyword>return</span> s;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h4 id=SDS-API><a href=#SDS-API class=headerlink title="SDS API"></a>SDS API</h4><table><thead><tr><th align=center>函数</th><th align=left>作用</th><th align=left>时间复杂度</th></tr></thead><tbody><tr><td align=center>sdsnew</td><td align=left>创建一个包含给定C字符串的SDS</td><td align=left>O(N), N为给定C字符串的长度</td></tr><tr><td align=center>sdsempty</td><td align=left>创建一个不包含任何内容的空SDS</td><td align=left>O(1)</td></tr><tr><td align=center>sdsfree</td><td align=left>释放给定的SDS</td><td align=left>O(N)， N为释放SDS的长度</td></tr><tr><td align=center>sdslen</td><td align=left>返回SDS已使用看见字节数</td><td align=left>O(1), SDS中的len属性</td></tr><tr><td align=center>sdsdup</td><td align=left>创建一个给定SDS的副本（copy）</td><td align=left>O(N), N为给定SDS的长度</td></tr><tr><td align=center>sdsupdatelen</td><td align=left>更新SDS的长度</td><td align=left>O(N)</td></tr><tr><td align=center>sdsclear</td><td align=left>清空SDS保存的字符串内容</td><td align=left>O(1)</td></tr></tbody></table><h3 id=Test-Code><a href=#Test-Code class=headerlink title="Test Code"></a>Test Code</h3><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre></td><td class=code><pre><span class=line><span class=meta>#<span class=keyword>ifndef</span> __TESTHELP_H</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> __TESTHELP_H</span></span><br><span class=line></span><br><span class=line><span class=type>int</span> __failed_tests = <span class=number>0</span>;</span><br><span class=line><span class=type>int</span> __test_num = <span class=number>0</span>;</span><br><span class=line><span class=meta>#<span class=keyword>define</span> test_cond(descr,_c) do &#123; \</span></span><br><span class=line><span class=meta>    __test_num++; printf(<span class=string>&quot;%d - %s: &quot;</span>, __test_num, descr); \</span></span><br><span class=line><span class=meta>    <span class=keyword>if</span>(_c) printf(<span class=string>&quot;PASSED\n&quot;</span>); <span class=keyword>else</span> &#123;printf(<span class=string>&quot;FAILED\n&quot;</span>); __failed_tests++;&#125; \</span></span><br><span class=line><span class=meta>&#125; while(0);</span></span><br><span class=line><span class=meta>#<span class=keyword>define</span> test_report() do &#123; \</span></span><br><span class=line><span class=meta>    printf(<span class=string>&quot;%d tests, %d passed, %d failed\n&quot;</span>, __test_num, \</span></span><br><span class=line><span class=meta>                    __test_num-__failed_tests, __failed_tests); \</span></span><br><span class=line><span class=meta>    <span class=keyword>if</span> (__failed_tests) &#123; \</span></span><br><span class=line><span class=meta>        printf(<span class=string>&quot;=== WARNING === We have failed tests here...\n&quot;</span>); \</span></span><br><span class=line><span class=meta>        exit(1); \</span></span><br><span class=line><span class=meta>    &#125; \</span></span><br><span class=line><span class=meta>&#125; while(0);</span></span><br><span class=line><span class=meta>#<span class=keyword>endif</span></span></span><br></pre></td></tr></table></figure><h3 id=List><a href=#List class=headerlink title=List></a>List</h3><p>Redis使用链表作为链表键的底层实现。</p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line><span class=comment>/* Node, List, and Iterator are the only data structures used currently. */</span></span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=class><span class=keyword>struct</span> <span class=title>listNode</span> &#123;</span>                                                   </span><br><span class=line>    <span class=class><span class=keyword>struct</span> <span class=title>listNode</span> *<span class=title>prev</span>;</span>                                                  </span><br><span class=line>    <span class=class><span class=keyword>struct</span> <span class=title>listNode</span> *<span class=title>next</span>;</span>                                                  </span><br><span class=line>    <span class=type>void</span> *value;                                                            </span><br><span class=line>&#125; listNode;                                                                 </span><br><span class=line></span><br><span class=line><span class=keyword>typedef</span> <span class=class><span class=keyword>struct</span> <span class=title>listIter</span> &#123;</span>                                                   </span><br><span class=line>    listNode *next;                                                         </span><br><span class=line>    <span class=type>int</span> direction;                                                          </span><br><span class=line>&#125; listIter;                                                                 </span><br></pre></td></tr></table></figure><blockquote><p>adlist.h</p></blockquote><p>多个<code>listNode</code>可以通过<code>prev</code>和<code>next</code>指针组成双端链表。</p><p><img data-src=/images/2018/09/redis_adlist.png alt=redis_adlist></p><figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>typedef</span> <span class=class><span class=keyword>struct</span> <span class=title>list</span> &#123;</span>                                                       </span><br><span class=line>    listNode *head;                                                         </span><br><span class=line>    listNode *tail;                                                         </span><br><span class=line>    <span class=type>void</span> *(*dup)(<span class=type>void</span> *ptr);                                                </span><br><span class=line>    <span class=type>void</span> (*<span class=built_in>free</span>)(<span class=type>void</span> *ptr);                                                </span><br><span class=line>    <span class=type>int</span> (*match)(<span class=type>void</span> *ptr, <span class=type>void</span> *key);                                     </span><br><span class=line>    <span class=type>unsigned</span> <span class=type>long</span> len;                                                      </span><br><span class=line>&#125; <span class=built_in>list</span>;  </span><br></pre></td></tr></table></figure><ul><li><code>dup</code>: 用于复制链表节点所保存的值。</li><li><code>free</code>： 用于释放链表节点所保存的值。</li><li><code>match</code>：用于对比链表节点所保存的值与另一个输入值是否相等。</li></ul><p><img data-src=/images/2018/09/redis_adlist_struct.png alt=redis_adlist_struct></p><ul><li><h4 id=Redis链表实现特性><a href=#Redis链表实现特性 class=headerlink title=Redis链表实现特性></a>Redis链表实现特性</h4></li></ul><ul><li><code>双端</code>：链表节点带有prev和next指针，获取某个节点的前端节点和后端节点的复杂度都为O(1)</li><li><code>无环</code>：表头节点的prev指针和表尾节点的next指针都指向NULL，对链表的访问以NULL为终点。</li><li><code>多态</code>：链表节点使用<code>void *</code>指针保存节点值，并且可以通过list结构的dup、free、match三个属性对节点值设置类型特定函数，链表可以保存各种不同类型的值。</li></ul></div></div><ul class=breadcrumb><li><a href="/books/">BOOKS</a></li><li>REDIS</li></ul></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2014 – <span itemprop=copyrightYear>2023</span> <span class=with-love><i class="fa fa-heart"></i></span> <span class=author itemprop=copyrightHolder>winddoing</span></div><div class=wordcount><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-chart-line"></i></span> <span title=站点总字数>1.1m</span></span> <span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-coffee"></i></span> <span title=站点阅读时长>16:21</span></span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv><span class=post-meta-item-icon><i class="fa fa-users"></i></span> <span class=site-uv title=总访客量><span id=busuanzi_value_site_uv></span></span></span> <span class=post-meta-item id=busuanzi_container_site_pv><span class=post-meta-item-icon><i class="fa fa-eye"></i></span> <span class=site-pv title=总访问量><span id=busuanzi_value_site_pv></span></span></span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span> 强力驱动</div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/muse.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src=/js/third-party/tags/pdf.js></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script><script src=/js/third-party/tags/mermaid.js></script><script src=/js/third-party/fancybox.js></script><script data-pjax async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script class=next-config data-name=leancloud_visitors type=application/json>{"enable":true,"app_id":"Q8qpjA3fOO7FEUBqcmcQFptF-gzGzoHsz","app_key":"tgUTq5bX3fVmn916EMRe65eJ","server_url":null,"security":false}</script><script src=/js/third-party/statistics/lean-analytics.js></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script><script src=/js/third-party/math/mathjax.js></script><script class=next-config data-name=utterances type=application/json>{"enable":true,"repo":"Winddoing/winddoing.github.io","issue_term":"title","theme":"github-light"}</script><script src=/js/third-party/comments/utterances.js></script></body></html>